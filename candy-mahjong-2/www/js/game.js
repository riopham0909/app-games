!function(){var t={};window.G=t,window.gameG=t,t.BuildEnvironment={production:!1},void 0===t&&(t={}),t.ExtLoader=function(){Phaser.Loader.call(this,game),game.state.onStateChange.add(this.reset,this),this.imagesToRemoveOnStateChange=[],this.loadedUrls={}},t.ExtLoader.prototype=Object.create(Phaser.Loader.prototype),t.ExtLoader.prototype.reset=function(t,e){this.imagesToRemoveOnStateChange.forEach((function(t){this.cache.removeImage(t)}),this),this.imagesToRemoveOnStateChange=[],Phaser.Loader.prototype.reset.call(this,t,e)},t.ExtLoader.prototype.addToFileList=function(t,e,i,s,a,n){if(void 0===a&&(a=!1),void 0===e||""===e)return this;if(null==i){if(!n)return this;i=e+n}var o={type:t,key:e,path:this.path,url:i,syncPoint:this._withSyncPointDepth>0,data:null,loading:!1,loaded:!1,error:!1};if(s)for(var r in s)o[r]=s[r];var h=this.getAssetIndex(t,e);if(a&&h>-1){var l=this._fileList[h];l.loading||l.loaded?(this._fileList.push(o),this._totalFileCount++):this._fileList[h]=o}else-1===h&&(this._fileList.push(o),this._totalFileCount++);return this.loadFile(this._fileList.shift()),this},t.ExtLoader.prototype.asyncComplete=function(t,e){void 0===e&&(e=""),t.loaded=!0,t.error=!!e,e&&(t.errorMessage=e)},t.ExtLoader.prototype.fileComplete=function(t,e){switch(t.type){case"packfile":var i=JSON.parse(e.responseText);t.data=i||{};break;case"image":this.cache.addImage(t.key,t.url,t.data);break;case"spritesheet":this.cache.addSpriteSheet(t.key,t.url,t.data,t.frameWidth,t.frameHeight,t.frameMax,t.margin,t.spacing);break;case"textureatlas":if(null==t.atlasURL)this.cache.addTextureAtlas(t.key,t.url,t.data,t.atlasData,t.format);else if(!1,t.format==Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY||t.format==Phaser.Loader.TEXTURE_ATLAS_JSON_HASH||t.format==Phaser.Loader.TEXTURE_ATLAS_JSON_PYXEL)this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.jsonLoadComplete);else{if(t.format!=Phaser.Loader.TEXTURE_ATLAS_XML_STARLING)throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+t.format);this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.xmlLoadComplete)}break;case"bitmapfont":t.atlasURL?(!1,this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",(function(t,e){var i;try{i=JSON.parse(e.responseText)}catch(t){}i?(t.atlasType="json",this.jsonLoadComplete(t,e)):(t.atlasType="xml",this.xmlLoadComplete(t,e))}))):this.cache.addBitmapFont(t.key,t.url,t.data,t.atlasData,t.atlasType,t.xSpacing,t.ySpacing);break;case"video":if(t.asBlob)try{t.data=e.response}catch(e){throw new Error("Phaser.Loader. Unable to parse video file as Blob: "+t.key)}this.cache.addVideo(t.key,t.url,t.data,t.asBlob);break;case"audio":this.game.sound.usingWebAudio?(t.data=e.response,this.cache.addSound(t.key,t.url,t.data,!0,!1),t.autoDecode&&this.game.sound.decode(t.key)):this.cache.addSound(t.key,t.url,t.data,!1,!0);break;case"text":t.data=e.responseText,this.cache.addText(t.key,t.url,t.data);break;case"shader":t.data=e.responseText,this.cache.addShader(t.key,t.url,t.data);break;case"physics":i=JSON.parse(e.responseText);this.cache.addPhysicsData(t.key,t.url,i,t.format);break;case"script":t.data=document.createElement("script"),t.data.language="javascript",t.data.type="text/javascript",t.data.defer=!1,t.data.text=e.responseText,document.head.appendChild(t.data),t.callback&&(t.data=t.callback.call(t.callbackContext,t.key,e.responseText));break;case"binary":t.callback?t.data=t.callback.call(t.callbackContext,t.key,e.response):t.data=e.response,this.cache.addBinary(t.key,t.data)}this.onFileComplete.dispatch(0,t.key,!t.error)}
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */;var e=e||function(t){"use strict";if(!(void 0===t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,i=function(){return t.URL||t.webkitURL||t},s=e.createElementNS("http://www.w3.org/1999/xhtml","a"),a="download"in s,n=/constructor/i.test(t.HTMLElement)||t.safari,o=/CriOS\/[\d]+/.test(navigator.userAgent),r=function(e){(t.setImmediate||t.setTimeout)((function(){throw e}),0)},h=function(t){setTimeout((function(){"string"==typeof t?i().revokeObjectURL(t):t.remove()}),4e4)},l=function(t,e,i){for(var s=(e=[].concat(e)).length;s--;){var a=t["on"+e[s]];if("function"==typeof a)try{a.call(t,i||t)}catch(t){r(t)}}},c=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},d=function(e,r,d){d||(e=c(e));var p,u=this,g="application/octet-stream"===e.type,f=function(){l(u,"writestart progress write writeend".split(" "))};if(u.readyState=u.INIT,a)return p=i().createObjectURL(e),void setTimeout((function(){s.href=p,s.download=r,function(t){var e=new MouseEvent("click");t.dispatchEvent(e)}(s),f(),h(p),u.readyState=u.DONE}));!function(){if((o||g&&n)&&t.FileReader){var s=new FileReader;return s.onloadend=function(){var e=o?s.result:s.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(e,"_blank")||(t.location.href=e),e=void 0,u.readyState=u.DONE,f()},s.readAsDataURL(e),void(u.readyState=u.INIT)}(p||(p=i().createObjectURL(e)),g)?t.location.href=p:t.open(p,"_blank")||(t.location.href=p);u.readyState=u.DONE,f(),h(p)}()},p=d.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,i){return e=e||t.name||"download",i||(t=c(t)),navigator.msSaveOrOpenBlob(t,e)}:(p.abort=function(){},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,function(t,e,i){return new d(t,e||t.name||"download",i)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=e:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",(function(){return e})),void 0===t&&(t={}),t.Button=function(e,i,s,a,n){Phaser.Button.call(this,game,t.l(e),t.l(i),null),this.state=game.state.getCurrentState(),t.changeTexture(this,s),this.anchor.setTo(.5),this.sfx=t.sfx.pop,this.active=!0,this.onClick=new Phaser.Signal,a&&this.onClick.add(a,n||this),this.onInputDown.add(this.click,this),this.terms=[],this.IMMEDIATE=!1,this.scaleOnClick=!0,this.targetAlphaTermsNotFulfilled=.5,this.targetAlpha=1,this.refractorPeriod=400,this.scaleChange=.1,this.pulsing=!1},t.Button.prototype=Object.create(Phaser.Button.prototype),t.Button.constructor=t.Button,t.Button.prototype.update=function(){this.checkTerms()?this.targetAlpha=1:this.targetAlpha=this.targetAlphaTermsNotFulfilled,this.alpha=t.lerp(this.alpha,this.targetAlpha,.2,.05),this.updateChildren()},t.Button.prototype.pulse=function(t){this.pulsing=!0,this.pulsingTween=game.add.tween(this.scale).to({x:t||1.1,y:t||1.1},500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},t.Button.prototype.stopPulse=function(t){this.pulsingTween&&this.pulsingTween.stop(),this.scale.setTo(t||1),this.pulsing=!1},t.Button.prototype.click=function(){if(this.active&&this.checkTerms()){this.active=!1,this.onClick.dispatch(),this.sfx&&this.sfx.play();var t=this.scale.x,e=this.scale.y;this.IMMEDIATE?this.active=!0:this.pulsing||!this.scaleOnClick?game.time.events.add(this.refractorPeriod,(function(){this.active=!0}),this):game.add.tween(this.scale).to({x:t+this.scaleChange,y:e+this.scaleChange},Math.floor(.5*this.refractorPeriod),Phaser.Easing.Quadratic.Out,!0).onComplete.add((function(){game.add.tween(this.scale).to({x:t,y:e},Math.floor(.5*this.refractorPeriod),Phaser.Easing.Quadratic.Out,!0).onComplete.add((function(){this.active=!0}),this)}),this)}},t.Button.prototype.checkTerms=function(){for(var t=0;t<this.terms.length;t++)if(!this.terms[t][0].call(this.terms[t][1]))return!1;return!0},t.Button.prototype.addTerm=function(t,e){this.terms.push([t,e])},t.Button.prototype.addImageLabel=function(t){this.label=game.make.image(0,0,"ssheet",t),this.label.anchor.setTo(.5),this.addChild(this.label)},t.Button.prototype.addTextLabel=function(e,i,s){var a=1/t.Loader.currentConfigMulti;this.label=new t.OneLineText(-7,-6,e,i,s||Math.floor(this.height*a*.7),this.width*a*.9,.5,.5),this.addChild(this.label)},t.Button.prototype.addTextLabelMultiline=function(e,i){var s=1/t.Loader.currentConfigMulti;this.label=new t.MultiLineText(0,0,e,i,Math.floor(this.height*s*.5),this.width*s*.8,this.height*s*.7,"center",.5,.5),this.addChild(this.label)},t.Button.prototype.addGTextLabel=function(e,i){this.label=new t.Text(0,0,e,i,.5,.9*this.width,.9*this.height,!0,"center"),this.addChild(this.label)},t.Button.prototype.stopTweens=function(){t.stopTweens(this)},t.Button.prototype.changeTexture=function(e){t.changeTexture(this,e)},t.Button.prototype.add=function(t){return this.addChild(t)},t.Button.prototype.updateChildren=function(){for(var t=this.children.length;t--;)this.children[t].update()},void 0===t&&(t={}),t.FrameAnimation=function(e,i,s,a,n){Phaser.Image.call(this,game,t.l(e),t.l(i)),this.anchor.setTo(.5),this.frameNamePrefix=s,this.animFramesLen=this.getAnimationLength(this.frameNamePrefix),this.timerEvery=a?60/a:1,this.animDir=1,t.changeTexture(this,this.frameNamePrefix+"_0"),this.currentTimer=0,this.currentIndex=0,this.onFinish=new Phaser.Signal,this.active=n||!1},t.FrameAnimation.prototype=Object.create(Phaser.Image.prototype),t.FrameAnimation.prototype.play=function(e,i,s){return this.currentTimer=0,this.currentIndex=s||0,this.active=!0,this.loop=e-1||0,this.animDir=1,this.bounce=i||!1,t.changeTexture(this,this.frameNamePrefix+"_"+this.currentIndex),this},t.FrameAnimation.prototype.update=function(){if(this.active&&(this.currentTimer+=t.deltaTime,this.currentTimer>=this.timerEvery)){if(this.currentTimer=this.currentTimer-this.timerEvery,this.currentIndex+=this.animDir,this.bounce){if(this.currentIndex==this.animFramesLen||0==this.currentIndex){if(0==this.loop&&0==this.currentIndex)return this.onFinish.dispatch(),this.active=!1;this.loop>0&&0==this.currentIndex&&this.loop--,this.currentIndex==this.animFramesLen&&(this.currentIndex=this.animFramesLen-1),this.animDir*=-1}}else if(this.currentIndex==this.animFramesLen){if(0==this.loop)return this.onFinish.dispatch(),this.active=!1;this.loop>0&&this.loop--,this.currentIndex=0}t.changeTexture(this,this.frameNamePrefix+"_"+this.currentIndex)}},t.FrameAnimation.prototype.getAnimationLength=function(e){if(t.FrameAnimation.CacheAnimLength[e])return t.FrameAnimation.CacheAnimLength[e];for(var i=0,s=0;s<1e3&&t.isImageInCache(e+"_"+s);s++)i++;return t.FrameAnimation.CacheAnimLength[e]=i,i},t.FrameAnimation.CacheAnimLength={},t.gift={},t.gift.getGift=function(e){e=e||"normals";var i=t.json.settings.gifts[e],s=i.boosterMaxNr||t.json.settings.gifts.boosterMaxNr,a=i.boosterChance||t.json.settings.gifts.boosterChance,n=[];i.list.forEach((function(e){("coin"==e[0]||-1!==e[0].indexOf("booster")&&t.saveState.isBoosterUnlocked(parseInt(e[0][8]))&&t.saveState.getBoosterAmount(parseInt(e[0][8]))<s)&&n.push(e)})),Phaser.ArrayUtils.shuffle(n);for(var o=Math.random()<a,r=0;r<n.length;r++){var h=n[r];if(-1===h[0].indexOf("booster"))return h.slice();if(o)return h.slice()}return["coin",50]},t.gift.getLabelString=function(e){return e[1]+" @"+t.json.settings.gifts.icons[e[0]]+"@"},t.gift.applyGift=function(e){"coin"==e[0]?t.saveState.changeCoins(e[1]):t.saveState.changeBoosterAmount(parseInt(e[0][8]),e[1])},t.gift.getIcon=function(e){return t.json.settings.gifts.icons[e[0]]},void 0===t&&(t={}),t.GridArray=function(t,e,i,s){"number"==typeof t?this.createGrid.apply(this,arguments):"string"==typeof t?(this.data=JSON.parse(arguments[0]),this.width=this.data.length,this.height=this.data[0].length):Array.isArray(t)&&(a=arguments[0],this.data=arguments[0],this.width=this.data.length,this.height=this.data[0].length)},t.GridArray.prototype={createGrid:function(t,e,i){this.data=[],this.width=t,this.height=e;for(var s=0;s<t;s++){this.data[s]=[];for(var a=0;a<e;a++)this.data[s][a]=i}},set:function(t,e,i){return this.isInGrid(t,e)?this.data[t][e]=i:(this.dbg,!1)},get:function(t,e){return this.isInGrid(t,e)?this.data[t][e]:(this.dbg,!1)},swapValues:function(t,e,i,s){if(!this.isInGrid(t,e)||!this.isInGrid(i,s))return this.dbg,!1;var a=this.data[t][e];this.data[t][e]=this.data[i][s],this.data[i][s]=a},isInGrid:function(t,e){return!(t<0||t>=this.width||e<0||e>=this.height)},find:function(t,e){for(var i=0;i<this.width;i++)for(var s=0;s<this.height;s++){if(t.call(e,this.data[i][s],i,s,this.data))return this.data[i][s]}return!1},filter:function(t,e){for(var i=[],s=0;s<this.width;s++)for(var a=0;a<this.height;a++){t.call(e,this.data[s][a],s,a,this.data)&&i.push(this.data[s][a])}return i},loop:function(t,e){for(var i=0;i<this.width;i++)for(var s=0;s<this.height;s++)t.call(e,this.data[i][s],i,s,this.data)},clear:function(t){this.loop((function(e,i,s,a){a[i][s]=t||!1}))},findPattern:function(t,e){var i=!1,s=t.length;return this.loop((function(a,n,o,r){if(a==e&&!i){for(var h=0;h<s;h+=2){if(!this.get(n+t[h],o+t[h+1]))return;if(this.get(n+t[h],o+t[h+1])!==e)return}i=[];for(var l=0;l<s;l+=2)i.push(n+t[l],o+t[l+1])}}),this),i},count:function(){for(var t=0,e=0;e<this.width;e++)for(var i=0;i<this.height;i++)this.data[e][i]&&t++;return t},getAllElements:function(){for(var t=[],e=0;e<this.width;e++)for(var i=0;i<this.height;i++)this.data[e][i]&&t.push(this.data[e][i]);return t}},t.Image=function(e,i,s,a,n){Phaser.Image.call(this,game,t.l(e),t.l(i),null),this.state=game.state.getCurrentState(),this.changeTexture(s),a&&("number"==typeof a?this.anchor.setTo(a):this.anchor.setTo(a[0],a[1])),n?(n.add||n.addChild).call(n,this):null!==n&&game.world.add(this)},t.Image.prototype=Object.create(Phaser.Image.prototype),t.Image.prototype.stopTweens=function(){t.stopTweens(this)},t.Image.prototype.changeTexture=function(e){t.changeTexture(this,e)},Phaser.Image.prototype.changeTexture=function(e){t.changeTexture(this,e)},t.Image.prototype.add=function(t){return this.addChild(t)},t.LabelGroupT=function(e,i,s,a,n,o,r){Phaser.Group.call(this,game),this.str=e,this.tagArray=t.LabelParser.changeIntoTagArray(e),this.x=i,this.y=s,this.textStyle=a,this.fontSize=parseInt(a.fontSize),this.distanceBetween=r||0,"number"==typeof n?this.anchorX=this.anchorY=n:(this.anchorX=n[0],this.anchorY=n[1]),this.maxWidth=o||0,this.processTagArray()},t.LabelGroupT.prototype=Object.create(Phaser.Group.prototype),t.LabelGroupT.prototype.processTagArray=function(){for(var e=0;e<this.tagArray.length;e++){if("img"==this.tagArray[e].type)(i=t.makeImage(0,0,this.tagArray[e].content,0,this)).tagScale=this.tagArray[e].scale;else if("separator"==this.tagArray[e].type){var i;(i=t.makeImage(0,0,null,0,this)).SEPARATOR=!0,i.SEP_LENGTH=this.tagArray[e].length}else this.add(new t.Text(0,0,this.tagArray[e].content,this.textStyle))}this.refresh()},t.LabelGroupT.prototype.refresh=function(){if(this.applySizeAndAnchor(),this.maxWidth>0&&this.getWholeWidth()>this.maxWidth)for(;this.getWholeWidth()>this.maxWidth;)this.distanceBetween=Math.floor(.9*this.distanceBetween),this.fontSize=Math.floor(.9*this.fontSize),this.applySizeAndAnchor();this.spreadElements()},t.LabelGroupT.prototype.applySizeAndAnchor=function(){this.children.forEach((function(t){t.anchor.setTo(this.anchorX,this.anchorY),t.fontSize?(t.fontSize=this.fontSize,t.updateTransform()):(t.height=this.fontSize*(t.tagScale||1),t.scale.x=t.scale.y),t.SEPARATOR&&(t.width=this.fontSize*t.SEP_LENGTH)}),this)},t.LabelGroupT.prototype.getWholeWidth=function(){var t=(this.children.length-1)*this.distanceBetween,e=0;return this.children.forEach((function(t){e+=t.width})),t+e},t.LabelGroupT.prototype.spreadElements=function(){var t=this.getWholeWidth()*this.anchorX*-1;this.children.forEach((function(e,i,s){e.left=0==i?t:s[i-1].right+this.distanceBetween}),this)},t.LabelParser={specialChars:["$","@","%","^"],changeIntoTagArray:function(t,e){for(var i=[],s=0;t.length>0&&!(s++>20);){var a=this.findFirstSpecialChar(t);if(-1===a){i.push(t);break}a[0]>0&&(i.push(t.slice(0,a[0])),t=t.slice(a[0])),t=this.cutOffTag(t,i,a[1])}var n=[];for(s=0;s<i.length;s++)n.push(this.processTag(i[s],e));return this.mergeTextTagsInArray(n)},mergeTextTagsInArray:function(t){for(var e=[],i=null,s=0;s<t.length;s++)"text"!==t[s].type?(null!==i&&(e.push(this.mergeTextTags(t,i,s)),i=null),e.push(t[s])):null==i&&(i=s);return null!==i&&e.push(this.mergeTextTags(t,i,s)),e},mergeTextTags:function(t,e,i){for(var s={type:"text",content:[]};e<i;e++)s.content.push(t[e].content);return s.content=s.content.join(" "),s},processTag:function(e,i){if("@"==e[0]){var s=1;return"*"==e[1]&&e.indexOf("*",2)&&(s=parseFloat(e.slice(e.indexOf("*")+1,e.indexOf("*",2))),e=e.slice(e.indexOf("*",2))),{type:"img",content:e.slice(1,-1),scale:s}}return"%"==e[0]?{type:"text",content:i[e.slice(1,-1)]}:"$"==e[0]?{type:"text",content:t.txt(e.slice(1,-1))}:"^"==e[0]?{type:"text",content:e.slice(1,-1)}:this.isStringJustSpaces(e)?{type:"separator",content:e,length:e.length}:{type:"text",content:e}},isStringJustSpaces:function(t){for(var e=0;e<t.length;e++)if(" "!==t[e])return!1;return!0},cutOffTag:function(t,e,i){var s=t.indexOf(i),a=t.indexOf(i,s+1);return e.push(t.slice(s,a+1)),t.slice(0,s)+t.slice(a+1)},findFirstSpecialChar:function(t){var e=1/0,i=!1;return this.specialChars.forEach((function(s){var a=t.indexOf(s);a>-1&&e>a&&(i=s,e=Math.min(a,e))})),e===1/0?-1:[e,i]},createLabel:function(e,i,s,a,n,o,r,h,l,c){this.changeIntoTagArray(e,i);return new t.LabelGroup(s,a,o,l,r,h,c)}},t.LabelGroup=function(e,i,s,a,n,o,r,h){Phaser.Group.call(this,game),this.fontData=game.cache.getBitmapFont(a).font,this.fontBaseSize=this.fontData.size,this.fontSpaceOffset=this.fontData.chars[32].xOffset+this.fontData.chars[32].xAdvance,this.str=e,this.tagArray=t.LabelParser.changeIntoTagArray(e),this.x=void 0===i?0:t.l(i),this.y=void 0===s?0:t.l(s),this.font=a,this.fontSize=void 0===n?t.l(30):t.l(n),this.distanceBetween=0,this.anchorX=void 0===o?.5:o,this.anchorY=void 0===r?.5:r,this.maxWidth=h||0,this.processTagArray()},t.LabelGroup.prototype=Object.create(Phaser.Group.prototype),t.LabelGroup.prototype.processTagArray=function(){for(var e=0;e<this.tagArray.length;e++){if("img"==this.tagArray[e].type)(i=t.makeImage(0,0,this.tagArray[e].content,0,this)).tagScale=this.tagArray[e].scale;else if("separator"==this.tagArray[e].type){var i;(i=t.makeImage(0,0,null,0,this)).SEPARATOR=!0,i.SEP_LENGTH=this.tagArray[e].length}else this.add(game.add.bitmapText(0,0,this.font,this.tagArray[e].content,this.fontSize))}this.refresh()},t.LabelGroup.prototype.refresh=function(){if(this.applySizeAndAnchor(),this.maxWidth>0&&this.getWholeWidth()>this.maxWidth)for(;this.getWholeWidth()>this.maxWidth;)this.distanceBetween*=.9,this.fontSize*=.9,this.applySizeAndAnchor();this.spreadElements()},t.LabelGroup.prototype.applySizeAndAnchor=function(){this.children.forEach((function(t){t.anchor.setTo(this.anchorX,this.anchorY),t.fontSize?(t.fontSize=this.fontSize,t.updateText()):(t.height=this.fontSize*(t.tagScale||1),t.scale.x=t.scale.y),t.SEPARATOR&&(t.width=this.fontSize/this.fontBaseSize*this.fontSpaceOffset*t.SEP_LENGTH)}),this)},t.LabelGroup.prototype.getWholeWidth=function(){var t=(this.children.length-1)*this.distanceBetween,e=0;return this.children.forEach((function(t){e+=t.width})),t+e},t.LabelGroup.prototype.spreadElements=function(){var t=this.getWholeWidth()*this.anchorX*-1;this.children.forEach((function(e,i,s){e.left=0==i?t:s[i-1].right+this.distanceBetween}),this)},t.LineEditor=function(){Phaser.Group.call(this,game),this.gfx=game.add.graphics(),this.gfx.fixedToCamera=!0,this.points={x:[],y:[]},this.currentIndex=null,this.pointerStart=new Phaser.Point(0,0),this.interpolation="linearInterpolation",game.input.onDown.add((function(t){this.currentIndex=this.findCurrentIndex(t),null!==this.currentIndex&&(this.pointerStart.x=t.x,this.pointerStart.y=t.y)}),this),game.input.onUp.add((function(t){this.currentIndex=null}),this),this.keys=game.input.keyboard.addKeys({Z:Phaser.Keyboard.Z,X:Phaser.Keyboard.X,C:Phaser.Keyboard.C,A:Phaser.Keyboard.A,S:Phaser.Keyboard.S,D:Phaser.Keyboard.D}),this.keys.Z.onDown.add((function(){this.interpolation="catmullRomInterpolation"}),this),this.keys.X.onDown.add((function(){this.interpolation="bezierInterpolation"}),this),this.keys.C.onDown.add((function(){this.interpolation="linearInterpolation"}),this),this.keys.A.onDown.add((function(){var t=game.input.activePointer;this.points.x.push(t.x),this.points.y.push(t.y)}),this),this.keys.S.onDown.add((function(){this.currentIndex&&(this.points.x.splice(this.currentIndex,1),this.points.y.splice(this.currentIndex,1))}),this),this.keys.D.onDown.add((function(){this.points.x.pop(),this.points.y.pop()}),this)},t.LineEditor.prototype=Object.create(Phaser.Group.prototype),t.LineEditor.prototype.update=function(){if(this.currentIndex){var t=game.input.activePointer,e=this.pointerStart.x-t.x,i=this.pointerStart.y-t.y;this.pointerStart.x=t.x,this.pointerStart.y=t.y,this.points.x[this.currentIndex]-=e,this.points.y[this.currentIndex]-=i}this.redraw()},t.LineEditor.prototype.findCurrentIndex=function(t){for(var e=null,i=1/0,s=0;s<this.points.x.length;s++){var a=game.math.distance(t.x,t.y,this.points.x[s],this.points.y[s]);a<i&&(e=s,i=a)}return e},t.LineEditor.prototype.redraw=function(){this.gfx.clear(),this.drawLine(),this.drawPoints()},t.LineEditor.prototype.drawPoints=function(){this.gfx.lineStyle(2,255,1),this.gfx.beginFill(255,.5);for(var t=0;t<this.points.x.length;t++)this.gfx.drawCircle(this.points.x[t],this.points.y[t],10)},t.LineEditor.prototype.drawLine=function(){if(0!=this.points.x.length){this.gfx.lineStyle(2,16711680,1),this.gfx.moveTo(this.points.x[0],this.points.y[0]);for(var t=0;t<1;t+=.001){var e=game.math[this.interpolation](this.points.x,t),i=game.math[this.interpolation](this.points.y,t);this.gfx.lineTo(e,i)}}},void 0===t&&(t={}),t.Loader={currentConfig:"hd",currentConfigMulti:1,loadingScreenActive:!1,lang:!1,passConfigs:function(t){this.configs=t},setConfig:function(t){this.currentConfig=t,this.currentConfigMulti=this.configs[t]},killLoadingScreen:function(){t.imgRotate&&(t.whiteOverlay.destroy(),t.imgRotate.fadeOut=!0,t.imgRotate=!1,this.loadingScreenActive=!1)},loadPOSTImage:function(t){void 0!==t&&(game.cache.checkImageKey(t)||(this.makeLoadingScreen(),game.load.image(t,"assets/"+this.currentConfig+"/imagesPOST/"+t)))},loadBootAssets:function(e){e&&(this.lang=e.toUpperCase()),t.ASSETS.images.forEach((function(t){this.checkIfLoad(t,!0)&&game.load.image(this.removeExt(this.cutOffPrefixes(t)),"assets/"+this.currentConfig+"/images/"+t)}),this),t.ASSETS.spritesheets.forEach((function(t){this.checkIfLoad(t,!0)&&game.load.atlasJSONHash(this.cutOffPrefixes(t),"assets/"+this.currentConfig+"/spritesheets/"+t+".png","assets/"+this.currentConfig+"/spritesheets/"+t+".json")}),this),game.load.onLoadComplete.addOnce((function(){this.createSpritesheetMap(!0)}),this)},loadAssets:function(e){e&&(this.lang=e.toUpperCase()),game.load.onLoadComplete.addOnce(this.processAssets,this),this.loadSFX(t.ASSETS.sfx),this.loadImages(t.ASSETS.images),this.loadSpritesheets(t.ASSETS.spritesheets),this.loadJson(t.ASSETS.json),this.loadFonts(t.ASSETS.fonts)},processAssets:function(){this.processJson(t.ASSETS.json),this.processSFX(t.ASSETS.sfx),this.createSpritesheetMap()},createSpritesheetMap:function(e){t.spritesheetMap||(t.spritesheetMap={});for(var i=0,s=t.ASSETS.spritesheets.length;i<s;i++)if(this.checkIfLoad(t.ASSETS.spritesheets[i],e)){var a=this.cutOffPrefixes(t.ASSETS.spritesheets[i]);if(game.cache.checkImageKey(a))for(var n=game.cache.getFrameData(a),o=0;o<n._frames.length;o++){var r=n._frames[o];t.spritesheetMap[r.name],t.spritesheetMap[r.name]=a}}},loadSFX:function(t){t.forEach((function(t){game.load.audio(this.removeExt(t),"assets/sfx/"+t)}),this)},loadFonts:function(t){for(var e in t){if(!this.checkIfLoad(e))return;game.load.bitmapFont(this.cutOffPrefixes(e),"assets/"+this.currentConfig+"/fonts/"+t[e].frame,"assets/"+this.currentConfig+"/fonts/"+t[e].data)}},loadImages:function(t){t.forEach((function(t){this.checkIfLoad(t)&&game.load.image(this.removeExt(this.cutOffPrefixes(t)),"assets/"+this.currentConfig+"/images/"+t)}),this)},loadJson:function(t){t.forEach((function(t){game.load.json(this.removeExt(t),"assets/json/"+t)}),this)},loadSpritesheets:function(t){t.forEach((function(t){this.checkIfLoad(t)&&game.load.atlasJSONHash(this.cutOffPrefixes(t),"assets/"+this.currentConfig+"/spritesheets/"+t+".png","assets/"+this.currentConfig+"/spritesheets/"+t+".json")}),this)},checkIfLoad:function(t,e){return(!e||-1!=t.indexOf("BOOT-"))&&(!(!e&&-1!==t.indexOf("BOOT-"))&&((-1===t.indexOf("MOBILE-")||!game.device.desktop)&&(!(-1!==t.indexOf("DESKTOP-")&&!game.device.desktop)&&(!this.lang||!t.match(/^[A-Z]{2}\-/)||0==t.indexOf(this.lang+"-")))))},cutOffPrefixes:function(t){return t=(t=(t=(t=t.replace(/^[A-Z]{2}\-/,"")).replace("BOOT-","")).replace("MOBILE-","")).replace("DESKTOP-","")},removeExt:function(t){return t.slice(0,t.lastIndexOf("."))},processJson:function(e){t.json={},e.forEach((function(e){e=this.removeExt(e),t.json[e]=game.cache.getJSON(e)}),this)},processSFX:function(e){t.sfx={},game.sfx=t.sfx;var i={};e.forEach((function(e){e=this.removeExt(e),t.sfx[e]=game.add.audio(e);var s=e.lastIndexOf("_");if(-1!==s&&!isNaN(e.slice(s+1))){parseInt(e.slice(s+1));var a=e.slice(0,s);i[a]||(i[a]=[]),i[a].push(t.sfx[e])}}),this),Object.keys(i).forEach((function(e){t.sfx[e]={sfxArray:i[e],play:function(t,e,i){game.rnd.pick(this.sfxArray).play("",0,t,e,i)}}}))}},t.MultiLineText=function(e,i,s,a,n,o,r,h,l,c){if(e=t.l(e),i=t.l(i),n=t.l(n),o=t.l(o),r=t.l(r),this.maxUserWidth=o,this.maxUserHeight=r,Phaser.BitmapText.call(this,game,e,i,s,"",n),this.splitText(a,o),this.align=h||"center",r)for(;this.height>r&&(this.fontSize-=2,this.splitText(a,o),this.updateText(),!(this.fontSize<5)););this.anchor.setTo(l,c),this.cacheAsBitmap=!0},t.MultiLineText.prototype=Object.create(Phaser.BitmapText.prototype),t.MultiLineText.prototype.constructor=t.MultiLineText,t.MultiLineText.prototype.splitText=function(t,e){for(var i=t,s=[],a=0,n=0;i.length>0;)if(a=n,-1==(n=i.indexOf(" ",n+1))?this.setText(i):this.setText(i.substring(0,n)),this.updateText(),this.width>e){if(0==a&&-1==n){s.push(i),i="",n=0;continue}if(0==a){s.push(i.substring(0,n)),i=i.substring(n+1),n=0;continue}s.push(i.substring(0,a)),i=i.substring(a+1),n=0}else-1==n&&(s.push(i),i="");this.setText(s.join("\n"))},t.MultiLineText.prototype.popUpAnimation=function(){this.cacheAsBitmap=!1;for(var t=this.children.length,e=[],i=0;i<t;i++)e[i]=i;e=Phaser.ArrayUtils.shuffle(e),delay_index=0,this.activeTweens=0,this.children.forEach((function(t){0==t.anchor.x&&(t.x=t.x+.5*t.width,t.y=t.y+t.height,t.anchor.setTo(.5,1));var i=t.scale.x;t.scale.setTo(0,0),this.activeTweens++;var s=game.add.tween(t.scale).to({x:1.5*i,y:1.5*i},200,Phaser.Easing.Quadratic.In,!1,25*e[delay_index]).to({x:i,y:i},200,Phaser.Easing.Sinusoidal.In);s.onComplete.add((function(){this.activeTweens--,0==this.activeTweens&&this.alive&&(this.cacheAsBitmap=!0)}),this),s.start(),delay_index++}),this)},t.OneLineText=function(e,i,s,a,n,o,r,h){if(Phaser.BitmapText.call(this,game,t.l(e),t.l(i),s,a,t.l(n),t.l(o)),o)for(;this.width>t.l(o)&&(this.fontSize-=2,this.updateText(),!(this.fontSize<5)););this.orgFontSize=t.l(n),this.maxUserWidth=t.l(o),this.skipCaching=t.skipOneLineTextCaching||!1,this.hAnchor=r,this.vAnchor=h,this.anchor.setTo(this.hAnchor,this.vAnchor),this.updateText(),this.insertCoin(this.fontSize),this.skipCaching||(this.cacheAsBitmap=!0,this.updateCache())},t.OneLineText.prototype=Object.create(Phaser.BitmapText.prototype),t.OneLineText.prototype.constructor=t.OneLineText,t.OneLineText.prototype.insertCoin=function(e){-1!=this.text.indexOf("$$")&&this.children.forEach((function(i,s,a){if(i.name&&"$"==i.name&&i.visible&&s+1<=a.length-1&&"$"==a[s].name){var n=i,o=a[s+1];n.visible=!1,o.visible=!1,coin=t.makeImage(n.x+.05*e,n.y-.05*e,"coin"),coin.width=e,coin.height=e,n.parent.addChild(coin)}}))},t.OneLineText.prototype.setText=function(t){Phaser.BitmapText.prototype.setText.call(this,t.toString());var e=this.scale.x,i=this.scale.y,s=this.alpha,a=this.angle;if(this.alpha=1,this.scale.setTo(1),this.maxUserWidth){this.fontSize=this.orgFontSize,this.updateText();for(;this.width>this.maxUserWidth&&(this.fontSize-=1,this.updateText(),!(this.fontSize<5)););}!this.skipCaching&&this.cacheAsBitmap&&this.updateCache(),this.scale.setTo(e,i),this.alpha=s,this.angle=a},t.OneLineText.prototype.popUpAnimation=function(){this.cacheAsBitmap=!1;for(var t=this.children.length,e=[],i=0;i<t;i++)e[i]=i;e=Phaser.ArrayUtils.shuffle(e),delay_index=0,this.activeTweens=0,this.children.forEach((function(t){0==t.anchor.x&&(t.x=t.x+.5*t.width,t.y=t.y+t.height,t.anchor.setTo(.5,1));var i=t.scale.x;t.scale.setTo(0,0),this.activeTweens++;var s=game.add.tween(t.scale).to({x:1.5*i,y:1.5*i},200,Phaser.Easing.Quadratic.In,!1,25*e[delay_index]).to({x:i,y:i},200,Phaser.Easing.Sinusoidal.In);s.onComplete.add((function(){this.activeTweens--,0==this.activeTweens&&this.alive&&!this.skipCaching&&(this.cacheAsBitmap=!0)}),this),s.start(),delay_index++}),this)},t.OneLineText.prototype.scaleOut=function(t,e){this.cacheAsBitmap=!1,this.activeTweens=0,this.children.forEach((function(t,e){0==t.anchor.x&&(t.x=t.x+.5*t.width,t.y=t.y+.5*t.height,t.anchor.setTo(.5,.5)),this.activeTweens++,t.scale.setTo(t.scale.x,t.scale.y);var i=game.add.tween(t.scale).to({x:0,y:0},400,Phaser.Easing.Cubic.In,!1,20*e);i.onComplete.add((function(){this.activeTweens--,0==this.activeTweens&&this.destroy()}),this),i.start()}),this)},t.OneLineCounter=function(e,i,s,a,n,o,r,h,l,c){t.OneLineText.call(this,e,i,s,"",n,o,r,h),this.amount=a,this.amountDisplayed=a,this.amountMaxInterval=5,this.amountMaxNegInterval=-5,this.absoluteDisplay=!1,this.fixedToDecimal=0,this.stepCurrent=0,this.step=0,this.preText=l||"",this.postText=c||"",this.setText(this.preText+a+this.postText)},t.OneLineCounter.prototype=Object.create(t.OneLineText.prototype),t.OneLineCounter.prototype.update=function(){if(this.lerp)this.lerpUpdate();else if(this.amountDisplayed!=this.amount&&this.stepCurrent--<=0&&(this.stepCurrent=this.step,this.amountDisplayed!=this.amount)){var t=this.amount-this.amountDisplayed;this.amountDisplayed+=game.math.clamp(t,this.amountMaxNegInterval,this.amountMaxInterval);var e=this.amountDisplayed;this.absoluteDisplay&&(e=Math.abs(e)),0!=this.fixedTo&&(e=e.toFixed(this.fixedToDecimal)),this.setText(this.preText+e+this.postText)}},t.OneLineCounter.prototype.changeAmount=function(t){this.amount=t},t.OneLineCounter.prototype.increaseAmount=function(t){this.amount+=t},t.OneLineCounter.prototype.changeIntervals=function(t,e){void 0===e?(this.amountMaxInterval=t,this.amountMaxNegInterval=-t):(this.amountMaxInterval=t,this.amountMaxNegInterval=e)},t.OneLineCounter.prototype.lerpUpdate=function(){this.amountDisplayed!=this.amount&&this.stepCurrent--<=0&&(this.stepCurrent=this.step,this.amountDisplayed=Math.round(t.lerp(this.amountDisplayed,this.amount,.5,.6)),this.setText(this.amountDisplayed.toString()))},t.PartCacher=function(){Phaser.Group.call(this,game),this.active=!1,this.every=1,this.rt=game.add.renderTexture(10,10),this.frameCounter=0,this.framesToRecord=null},t.PartCacher.prototype=Object.create(Phaser.Group.prototype),t.PartCacher.prototype.update=function(){if(this.active){if(this.stepForward(),!this.checkChildren())return this.active=!1,void this.removeAll(!0,!0);this.frameCounter%this.frameRate==0&&(this.saveFrame(),this.frameNr++,null!==this.framesToRecord&&(this.framesToRecord--,0==this.framesToRecord&&(this.active=!1))),this.frameCounter++}},t.PartCacher.prototype.stepForward=function(){for(var t=this.children.length;t--;)this.children[t].update()},t.PartCacher.prototype.start=function(t,e,i){this.fileName=t,this.frameNr=0,this.frameRate=60/e,this.active=!0,this.frameCounter=0,this.framesToRecord=i||null},t.PartCacher.prototype.saveFrame=function(){var t=this.getBounds(),i=Math.max(this.x-t.x,t.x+t.width-this.x,400),s=Math.max(this.y-t.y,t.y+t.height-this.y,400);this.rt.resize(2*i,2*s,!0),this.rt.renderXY(this,i,s,!0);var a=this.rt.getCanvas(),n=this.fileName+"_"+this.frameNr;a.toBlob((function(t){e(t,n)}))},t.PartCacher.prototype.checkChildren=function(){var t=this.children.filter((function(t){return!t.alive||0===t.alpha||0==t.scale.x||0==t.scale.y}));return this.children.length!==t.length},t.PoolGroup=function(e,i,s,a){if(Phaser.Group.call(this,game),this._deadArray=[],this._elementConstructor=e,this._argumentsArray=i||[],this._argumentsArray.unshift(null),s&&t.sb(s).add(this.init,this),a)for(var n=0;n<a;n++)element=new(Function.prototype.bind.apply(this._elementConstructor,this._argumentsArray)),this.add(element),element.events.onKilled.add(this._onElementKilled,this),element.kill()},t.PoolGroup.prototype=Object.create(Phaser.Group.prototype),t.PoolGroup.prototype.getFreeElement=function(){var t;return this._deadArray.length>0?t=this._deadArray.pop():(t=new(Function.prototype.bind.apply(this._elementConstructor,this._argumentsArray))).events.onKilled.add(this._onElementKilled,this),this.add(t),t},t.PoolGroup.prototype._onElementKilled=function(t){this===t.parent&&(this._deadArray.push(t),this.removeChild(t))},t.PoolGroup.prototype.init=function(){var t=this.getFreeElement();return t.init.apply(t,arguments),t},t.PoolGroup.prototype.initBatch=function(t){for(var e=0;e<t;e++)this.init.apply(this,[].slice.call(arguments,1))},t.PreloaderBar=function(){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.softgamesBtn=game.add.button(0,200,"sg_logo",(function(){SG_Hooks.triggerMoreGames()}),this),this.softgamesBtn.anchor.setTo(.5,.5),this.add(this.softgamesBtn),this.gfx=game.add.graphics(),this.add(this.gfx),this.drawProgress(0),t.sb("onScreenResize").add(this.onResize,this),this.onResize(),game.load.onFileComplete.add(this.drawProgress,this)},t.PreloaderBar.prototype=Object.create(Phaser.Group.prototype),t.PreloaderBar.prototype.onResize=function(){this.cameraOffset.x=.5*game.width,this.cameraOffset.y=.4*game.height},t.PreloaderBar.prototype.drawProgress=function(t){this.gfx.clear(),this.gfx.lineStyle(2,16777215,1),this.gfx.beginFill(0,1),this.gfx.drawRect(-150,0,300,50),this.gfx.beginFill(16777215,1),this.gfx.drawRect(-145,5,t/100*290,40)},t.ProgressBar=function(e,i,s,a,n,o,r){t.Image.call(this,e,i,s+"_empty",0,null),o=void 0===o?0:o,r=void 0===r?0:o,this.fill=t.makeImage(o,r,s+"_full",0,this),this.fillFullWidth=this.fill.width,this.fillOverlay=t.makeImage(o,r,s+"_full_overlay",this.fill,this),this.fillOverlay.alpha=0,this.fill.cropRect=new Phaser.Rectangle(0,0,0,this.fill.height),this.fill.updateCrop(),this.currentValue=a,this.prevCurrentValue=a,this.targetValue=a,this.maxValue=n,this.lerpValue=.05,this.updateBarCrop(),this.onTargetReached=new Phaser.Signal,this.onBarFilled=new Phaser.Signal},t.ProgressBar.prototype=Object.create(t.Image.prototype),t.ProgressBar.prototype.update=function(){this.currentValue!==this.targetValue&&(this.currentValue=t.lerp(this.currentValue,this.targetValue,this.lerpValue,.005*this.maxValue),this.currentValue===this.targetValue&&this.onTargetReached.dispatch()),this.currentValue!==this.prevCurrentValue&&(this.updateBarCrop(),this.currentValue===this.maxValue&&(game.add.tween(this.fillOverlay).to({alpha:1},300,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0),this.onBarFilled.dispatch(),this.label&&game.add.tween(this.label).to({alpha:0},600,Phaser.Easing.Sinusoidal.InOut,!0)),this.label&&Math.floor(this.currentValue)!==Math.floor(this.prevCurrentValue)&&this.label.updateValue(Math.floor(this.currentValue))),this.prevCurrentValue=this.currentValue},t.ProgressBar.prototype.updateBarCrop=function(){var t=this.fill.cropRect.width,e=Math.round(this.fillFullWidth*(this.currentValue/this.maxValue));t!==e&&(this.fill.cropRect.width=e,this.fill.updateCrop())},t.ProgressBar.prototype.changeCurrentValue=function(t,e){this.targetValue=game.math.clamp(t,0,this.maxValue),this.lerpValue=e||this.lerpValue},t.ProgressBar.prototype.increaseCurrentValue=function(t){this.changeCurrentValue(this.targetValue+(t||1))},t.ProgressBar.prototype.decreaseCurrentValue=function(t){this.changeCurrentValue(this.targetValue-(t||1))},t.ProgressBar.prototype.changeValues=function(t,e){this.currentValue=t,this.prevCurrentValue=t,this.targetValue=t,this.maxValue=e,this.label&&this.label.changeValues(t,e),this.updateBarCrop()},t.ProgressBar.prototype.addLabel=function(e,i){this.label=new t.ProgressBar.Label(t.rl(.5*this.width),t.rl(.5*this.height),this.currentValue,this.maxValue,Math.floor(.6*t.rl(this.height)),t.rl(.7*this.width),e,i),this.add(this.label)},t.ProgressBar.Label=function(e,i,s,a,n,o,r,h){t.OneLineText.call(this,e,i,"font","",n,o,.5,.5),this.labelType=r||0,this.labelType1Text=t.txt("%AMOUNT% left"),this.currentValue=s,this.maxValue=a,this.animationOnIncrease=h||!1,this.updateValue(this.currentValue,!0)},t.ProgressBar.Label.prototype=Object.create(t.OneLineText.prototype),t.ProgressBar.Label.prototype.updateValue=function(e,i){(i||Math.min(e,this.maxValue)!==this.currentValue)&&(this.currentValue=e,this.updateLabelText(),!i&&this.animationOnIncrease&&(t.stopTweens(this),this.scale.setTo(1),game.add.tween(this.scale).to({x:1.2,y:1.2},200,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0)))},t.ProgressBar.Label.prototype.changeValues=function(t,e){this.currentValue=t,this.maxValue=e,this.alpha=this.currentValue<this.maxValue?1:0,this.updateLabelText()},t.ProgressBar.Label.prototype.updateLabelText=function(){0==this.labelType?this.setText(this.currentValue+"/"+this.maxValue):this.setText(this.labelType1Text.replace("%AMOUNT%",this.maxValue-this.currentValue))},void 0===t&&(t={}),t.SignalBox=function(){Phaser.Signal.prototype.addPermanent||(Phaser.Signal.prototype.addPermanent=function(){var t=this.add.apply(this,arguments);return t._PERMANENT=!0,t},Phaser.Signal.prototype.removeNonPermanent=function(){if(this._bindings)for(var t=this._bindings.length;t--;)this._bindings[t]._PERMANENT||(this._bindings[t]._destroy(),this._bindings.splice(t,1))});var t={};function e(){Object.keys(t).forEach((function(e){t[e].removeNonPermanent()}))}function i(i){return game.state.onStateChange.add(e,this),t[i]||(t[i]=new Phaser.Signal),t[i]}return i.signals=t,i.clearNonPermanent=e,i.clearAll=function(){Object.keys(t).forEach((function(e){t[e].removeAll()}))},i}(),t.Slider=function(t,e,i,s){Phaser.Graphics.call(this,game,t,e),this.sliderWidth=i,this.pos=s,this.beginFill(0,1),this.drawRect(0,-2,this.sliderWidth,4),this.circleGfx=this.addChild(game.make.graphics(i*s,0)),this.circleGfx.clear(),this.circleGfx.lineStyle(1,0,1),this.circleGfx.beginFill(10066329,1),this.circleGfx.drawCircle(0,0,32),this.circleGfx.sliderWidth=i,this.circleGfx.inputEnabled=!0,this.circleGfx.input.useHandCursor=!0,this.circleGfx.input.draggable=!0,this.circleGfx.input.setDragLock(!0,!1)},t.Slider.prototype=Object.create(Phaser.Graphics.prototype),t.Slider.prototype.update=function(){this.circleGfx.x=game.math.clamp(this.circleGfx.x,0,this.sliderWidth),this.pos=this.circleGfx.x/this.sliderWidth},t.SliderPanel=function(e,i,s,a,n,o){Phaser.Group.call(this,game),this.sliderWidth=t.l(s),this.sliderHeight=t.l(a),this.x=e+-.5*this.sliderWidth,this.y=i+-.5*this.sliderHeight,this.gfxMask=game.add.graphics(),this.gfxMask.beginFill(0,1),this.gfxMask.drawRect(0,0,s,a),this.clickableObjects=[],this.config=o,this.applyConfig(this.config),this.addContent(n),this.add(this.gfxMask),this.contentGroup.mask=this.gfxMask,this.slideY=0,this.inputSprite=t.makeImage(0,0,null,0,this),this.inputSprite.inputEnabled=!0,this.inputSprite.hitArea=new Phaser.Rectangle(0,0,s,a),this.inputSpriteDown=!1,this.inputData={x:null,y:null,velX:0,velY:0,xStart:null,yStart:null,startFrameStamp:null,clickDistanceWindow:10,clickTimeWindow:10},this.inputSprite.events.onInputDown.add((function(t){var e=game.input.activePointer;this.inputSpriteDown=!0,this.inputData.x=this.inputData.xStart=e.worldX,this.inputData.y=this.inputData.yStart=e.worldY,this.inputData.startFrameStamp=this.frameCounter}),this),this.inputSprite.events.onInputUp.add((function(){var t=game.input.activePointer;this.inputSpriteDown=!1;var e=game.math.distance(this.inputData.xStart,this.inputData.yStart,t.worldX,t.worldY),i=this.frameCounter-this.inputData.startFrameStamp;e<=this.inputData.clickDistanceWindow&&i<=this.inputData.clickTimeWindow&&(this.propagateClick(t.x,t.y),this.inputData.velX=0,this.inputData.velY=0)}),this),this.frameCounter=0},t.SliderPanel.prototype=Object.create(Phaser.Group.prototype),t.SliderPanel.prototype.applyConfig=function(t){this.horizontal=t.horizontal||!1,this.horizontalLerp=t.horizontalLerp||!1,this.vertical=t.vertical||!0,this.verticalLerp=t.verticalLerp},t.SliderPanel.prototype.addContent=function(t){this.changeInputSettings(t),this.contentGroup=t,this.add(t),this.contentGroup.x=0,this.contentGroupMinY=-this.contentGroup.height+this.sliderHeight,this.contentGroupMaxY=0,this.contentGroupMinX=this.sliderWidth-this.contentGroup.width,this.contentGroupMaxX=0},t.SliderPanel.prototype.changeInputSettings=function(t){for(var e=t.children.length;e--;){var i=t.children[e];i.inputEnabled&&(this.clickableObjects.push(i),i.inputEnabled=!1),i.children.length>0&&this.changeInputSettings(i)}},t.SliderPanel.prototype.update=function(){if(this.frameCounter++,this.inputSpriteDown&&game.input.activePointer.isDown){var t=this.inputData.x-game.input.activePointer.worldX,e=this.inputData.y-game.input.activePointer.worldY;this.inputData.x=game.input.activePointer.worldX,this.inputData.y=game.input.activePointer.worldY,this.inputData.velX=.8*t+.2*this.inputData.velX,this.inputData.velY=.8*e+.2*this.inputData.velY,this.horizontal&&(this.contentGroup.x-=this.inputData.velX),this.vertical&&(this.contentGroup.y-=this.inputData.velY)}else this.horizontal&&(this.contentGroup.x-=this.inputData.velX,this.inputData.velX*=.95,Math.abs(this.inputData.velX)<1&&(this.inputData.velX=0)),this.vertical&&(this.contentGroup.y-=this.inputData.velY,this.inputData.velY*=.95,Math.abs(this.inputData.velY)<1&&(this.inputData.velY=0));this.vertical&&this.boundRestrict("y",this.verticalLerp,this.contentGroupMinY,this.contentGroupMaxY),this.horizontal&&this.boundRestrict("x",this.horizontalLerp,this.contentGroupMinX,this.contentGroupMaxX),this.boundRestrict()},t.SliderPanel.prototype.propagateClick=function(t,e){for(var i=0;i<this.clickableObjects.length;i++)if(this.clickableObjects[i].visible&&this.clickableObjects[i].getBounds().contains(t,e)){this.clickableObjects[i].onInputDown.dispatch();break}},t.SliderPanel.prototype.boundRestrict=function(e,i,s,a){i?(this.contentGroup[e]>a&&(this.contentGroup[e]=t.lerp(this.contentGroup[e],a,.5),this.contentGroup[e]<a+1&&(this.contentGroup[e]=a)),this.contentGroup[e]<s&&(this.contentGroup[e]=t.lerp(this.contentGroup[e],s,.2),this.contentGroup[e]>s-1&&(this.contentGroup[e]=s))):this.contentGroup[e]=game.math.clamp(this.contentGroup[e],s,a)},t.StrObjGroup=function(t,e,i){Phaser.Group.call(this,game),this.x=t||0,this.y=e||0,this.importObj="string"==typeof i?JSON.parse(i):i,this.parseImportObj(this.importObj)},t.StrObjGroup.prototype=Object.create(Phaser.Group.prototype),t.StrObjGroup.prototype.parseImportObj=function(e){for(var i=0;i<e.length;i++){var s=e[i],a=t.makeImage(s.x,s.y,s.frame,s.anchor,this);a.scale.setTo(s.scale[0],s.scale[1]),a.angle=s.angle}},t.Text=function(e,i,s,a,n,o,r,h,l){"object"!=typeof a&&(a=JSON.parse(JSON.stringify(t.Text.styles[a]))),this.userMaxWidth=o||1/0,this.userMaxHeight=r||1/0,h&&(a.wordWrap=!0,a.wordWrapWidth=o,a.align=l||"left"),Phaser.Text.call(this,game,e,i,s,a),a.lineSpacing&&(this.lineSpacing=a.lineSpacing),n&&("number"==typeof n?this.anchor.setTo(n):this.anchor.setTo(n[0],n[1])),this.width=Math.min(this.width,this.userMaxWidth),this.height=Math.min(this.height,this.userMaxHeight)},t.Text.prototype=Object.create(Phaser.Text.prototype),t.Text.styles={},t.Text.addStyle=function(e,i){t.Text.styles[e]=i},t.Text.prototype.setText=function(t){Phaser.Text.prototype.setText.call(this,t),this.scale.setTo(1),this.width=Math.min(this.width,this.userMaxWidth),this.height=Math.min(this.height,this.userMaxHeight)},t.TextCounter=function(e,i,s,a,n,o,r){this.amount=s,this.amountDisplayed=s,t.Text.call(this,e,i,null===s?"...":s.toString(),a,n,o),r=r||{lerpValue:.5},this.lerp=!0,this.lerpValue=r.lerpValue,this.stepCurrent=0,this.step=0},t.TextCounter.prototype=Object.create(t.Text.prototype),t.TextCounter.prototype.setAmount=function(t,e){this.amount=t,e&&(this.amountDisplayed=t,this.setText(this.amountDisplayed.toString()))},t.TextCounter.prototype.changeAmount=function(t,e){this.amount+=t,e&&(this.amountDisplayed=this.amount,this.setText(this.amountDisplayed.toString()))},t.TextCounter.prototype.update=function(){this.amountDisplayed!=this.amount&&this.stepCurrent--<=0&&(this.stepCurrent=this.step,this.lerp&&this.lerpUpdate())},t.TextCounter.prototype.lerpUpdate=function(){this.amountDisplayed=t.lerp(this.amountDisplayed,this.amount,this.lerpValue,.2),this.setText(Math.round(this.amountDisplayed).toString())},t.TextRTCacher=function(){},t.TextRTCacher.prototype.cacheText=function(t,e,i,s,a){this.txt||(this.txt=game.make.bitmapText(0,0,t,"",80)),this.txt.fontSize=i,this.txt.setText(e),this.txt.tint=a||16777215,this.txt.updateCache(),game.make.renderTexture(this.txt.width,this.txt.height,s,!0).render(this.txt)},t.TextRTCacher.prototype.cachePhaserText=function(t,e,i){var s=game.make.text(0,0,t,i);game.make.renderTexture(s.width,s.height,e,!0).render(s),s.destroy()},t.Timer=function(e,i,s,a,n,o,r){t.OneLineText.call(this,e,i,s,"???",a,n,o,r),this.secLeft=0,this.active=!1,this.timerBinding=t.sb("onWallClockTimeUpdate").add(this.updateTimer,this),this.events.onDestroy.add((function(){this.timerBinding.detach()}),this)},t.Timer.prototype=Object.create(t.OneLineText.prototype),t.Timer.prototype.updateTimer=function(){this.active&&(t.sfx.clock_tick.play(),this.secLeft=Math.max(0,this.secLeft-1),this.setText(t.changeSecToTimerFormat(this.secLeft)))},t.Timer.prototype.setSecLeft=function(e){this.secLeft=e,this.setText(t.changeSecToTimerFormat(this.secLeft))},t.Timer.prototype.start=function(t){this.active=!0},t.TimerT=function(e,i,s,a,n,o,r,h){t.Text.call(this,e,i,"???",a,n,o),this.secLeft=0,this.active=!1,this.timerFormat=r,this.dots=!0,this.sfx=h?t.sfx[sfs]:null,this.timerBinding=t.sb("onWallClockTimeUpdate").add(this.updateTimer,this),this.events.onDestroy.add((function(){this.timerBinding.detach()}),this),s&&this.setDate(s)},t.TimerT.prototype=Object.create(t.Text.prototype),t.TimerT.prototype.updateTimer=function(){this.active&&(this.sfx&&this.sfx.play(),this.secLeft=Math.max(0,this.secLeft-1),this.updateTimerText(this.secLeft,this.dots),this.dots=!this.dots)},t.TimerT.prototype.setSecLeft=function(t){this.secLeft=Math.max(0,t),this.updateTimerText(this.secLeft,!0)},t.TimerT.prototype.updateTimerText=function(e,i){var s=t.changeSecToDHMS(this.secLeft),a=[];this.timerFormat.indexOf("d")>-1&&a.push(s[0]),this.timerFormat.indexOf("h")>-1&&a.push(s[1]),this.timerFormat.indexOf("m")>-1&&a.push(s[2]),this.timerFormat.indexOf("s")>-1&&a.push(s[3]),this.setText(a.join(i?":":" "))},t.TimerT.prototype.start=function(t){this.active=!0},t.TimerT.prototype.setDate=function(t){var e=new Date(t).getTime(),i=Date.now(),s=Math.ceil((e-i)/1e3);this.setSecLeft(s),this.active=!0},t.UITargetParticles=function(){t.PoolGroup.call(this,t.UITargetParticle),this.fixedToCamera=!0},t.UITargetParticles.prototype=Object.create(t.PoolGroup.prototype),t.UITargetParticles.prototype.initPart=function(t,e,i,s,a,n){return this.init(t,e,i,s,a)},t.UITargetParticles.prototype.createDividedBatch=function(e,i,s,a,n,o){var r=new t.UITargetParticles.BatchObj,h=h||25;n/o>h&&(o=Math.ceil(n/h));for(var l=Math.floor(n/o)+Math.sign(n%o),c=0;c<l;c++){var d=this.init(e,i,s,a,Math.min(o,n));n-=o,r.add(d)}return r},t.UITargetParticles.prototype.createBatch=function(e,i,s,a,n,o){for(var r=new t.UITargetParticles.BatchObj,h=Array.isArray(e),l=0;l<o;l++){if(h)var c=this.init(e[l].x,e[l].y,s,a,n);else c=this.init(e,i,s,a,n);r.add(c)}return r},t.UITargetParticles.BatchObj=function(){this.parts=[],this.nrOfParts=0,this.nrOfFinished=0,this.onFinish=new Phaser.Signal},t.UITargetParticles.BatchObj.prototype.add=function(t){this.parts.push(t),t.onFinish.addOnce(this.onPartFinish,this),this.nrOfParts++},t.UITargetParticles.BatchObj.prototype.onPartFinish=function(){this.nrOfFinished++,this.nrOfFinished==this.nrOfParts&&this.onFinish.dispatch()},t.UITargetParticles.BatchObj.prototype.addOnPartStart=function(t,e){this.parts.forEach((function(i){i.onStart.addOnce(t,e||i,1)}))},t.UITargetParticles.BatchObj.prototype.addOnPartFinish=function(t,e){this.parts.forEach((function(i){i.onFinish.addOnce(t,e||i,1)}))},t.UITargetParticles.BatchObj.prototype.start=function(t){var e=0;this.parts.forEach((function(i){i.start(e),e+=t||0}))},t.UITargetParticle=function(){t.Image.call(this,0,0,null,.5),this.onStart=new Phaser.Signal,this.onFinish=new Phaser.Signal,this.speed=0,this.speedMax=30,this.speedDelta=.75,this.vel=new Phaser.Point(0,0),this.velInit=new Phaser.Point(0,0),this.kill()},t.UITargetParticle.prototype=Object.create(t.Image.prototype),t.UITargetParticle.prototype.init=function(t,e,i,s,a){this.position.setTo(t,e),this.changeTexture(i),this.onStart.removeAll(),this.onFinish.removeAll(),this.carriedValue=a||1,this.targetObj=s,this.stopTweens(this),this.scale.setTo(1),this.alpha=1,this.speed=0,this.vel.setTo(0,0)},t.UITargetParticle.prototype.start=function(t){t?game.time.events.add(t,this.start,this):(this.revive(),this.onStart.dispatch(this,this.carriedValue))},t.UITargetParticle.prototype.update=function(){if(this.alive){this.position.add(this.vel.x,this.vel.y),this.vel.x*=.95,this.vel.y*=.95,this.speed+=this.speedDelta,this.speed=Math.min(this.speed,this.speedMax);var e=Phaser.Point.distance(this.worldPosition,this.targetObj.worldPosition),i=Phaser.Point.angle(this.targetObj.worldPosition,this.worldPosition);this.position.add(t.lengthDirX(i,Math.min(e,this.speed),!0),t.lengthDirY(i,Math.min(e,this.speed),!0)),e<1.2*this.speedMax&&(this.onFinish.dispatch(this,this.carriedValue),this.kill())}},void 0===t&&(t={}),Math.sign=Math.sign||function(t){return 0===(t=+t)||isNaN(t)?t:t>0?1:-1},t.isImageInCache=function(t){return""!=this.checkSheet(t)||game.cache.checkImageKey(t)},t.checkSheet=function(e){return t.spritesheetMap?t.spritesheetMap[e]||"":this.checkSheetOld()},t.checkSheetOld=function(){for(var e=0,i=t.ASSETS.spritesheets.length;e<i;e++){t.ASSETS.spritesheets[e];if(game.cache.checkImageKey(t.ASSETS.spritesheets[e])&&game.cache.getFrameData(t.ASSETS.spritesheets[e]).getFrameByName(frame))return t.ASSETS.spritesheets[e]}return""},t.lerp=function(t,e,i,s){return s&&Math.abs(t-e)<=s?e:t+i*(e-t)},t.l=function(e){return Math.floor(e*t.Loader.currentConfigMulti)},t.rl=function(e){return Math.floor(e*(1/t.Loader.currentConfigMulti))},t.lnf=function(e){return e*t.Loader.currentConfigMulti},t.rnd=function(t,e){return game.rnd.realInRange(t||0,e||1)},t.rndInt=function(t,e){return game.rnd.between(t,e)},t.changeTexture=function(t,e){if("string"!=typeof e)return t.loadTexture(e);var i=this.checkSheet(e);""==i?t.loadTexture(e):t.loadTexture(i,e)},t.txt=function(e){return t.lang||(t.lang="en"),t.json.languages[t.lang]||(t.lang="en"),t.json.languages[t.lang][e]||e+"***"},t.deltaTime=1,t.delta=function(){t.deltaTime=Math.min(1.5,game.time.elapsedMS/16),17==game.time.elapsedMS&&(t.deltaTime=1)},t.rotatePositions=function(t){for(var e=[],i=0,s=t.length;i<s;i+=2)e.push(-1*t[i+1],t[i]);return e},t.loadTexture=t.changeTexture,t.makeImage=function(t,e,i,s,a){var n,o=this.checkSheet(i);return n=""==o?game.make.image(this.l(t),this.l(e),i):game.make.image(this.l(t),this.l(e),o,i),s&&("number"==typeof s?n.anchor.setTo(s):n.anchor.setTo(s[0],s[1])),a?(a.add||a.addChild).call(a,n):null!==a&&game.world.add(n),n},t.capitalize=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},t.lengthDirX=function(t,e,i){return(i=i||!1)?Math.cos(t)*e:Math.cos(game.math.degToRad(t))*e},t.lengthDirY=function(t,e,i){return(i=i||!1)?Math.sin(t)*e:Math.sin(game.math.degToRad(t))*e},t.stopTweens=function(t){game.tweens._add.forEach((function(e){t.scale&&e.target==t.scale&&e.stop(),e.target==t&&e.stop()})),game.tweens._tweens.forEach((function(e){t.scale&&e.target==t.scale&&e.stop(),e.target==t&&e.stop()}))},t.makeExtImage=function(e,i,s,a,n,o,r,h){var l;if(t.extLoader||(t.extLoader=new t.ExtLoader(game)),t.extLoader.loadedUrls[s])return l=t.makeImage(e,i,t.extLoader.loadedUrls[s],n,o),h.call(l),l;(l=t.makeImage(e,i,a,n,o)).onImgLoaded=new Phaser.Signal,t.extImagesKeys||(t.extImagesKeys=[]);var c="extImgBlankName"+t.extImagesKeys.length;t.extImagesKeys.push(c);var d=t.extLoader.onFileComplete.add((function(e,i,a){i==c&&a&&(t.extLoader.loadedUrls[s]=c,null!==l.game&&(t.changeTexture(l,c),h&&h.call(l)),d.detach())}));return t.extLoader.image(c,s,!0),l},t.drawCircleSegment=function(e,i,s,a,n,o,r){if(n===o)return e;void 0===r&&(r=10);var h=(o-n)/r;e.moveTo(i,s);for(var l=e.currentPath.shape.points;n<=o;n+=h)l.push(Math.floor(i+t.lengthDirX(n,a,!1)),Math.floor(s+t.lengthDirY(n,a,!1)));return l.push(Math.floor(i+t.lengthDirX(o,a,!1)),Math.floor(s+t.lengthDirY(o,a,!1))),e.dirty=!0,e._boundsDirty=!0,e},t.centerElements=function(e,i,s){void 0===s&&(s=0),void 0===i&&(i=[]);var a=0,n=Array.isArray(i);e.forEach((function(e,s){a+=e.width,(n?i[s-1]:void 0!==i)&&(a+=t.l(n?i[s-1]:i))}));var o=s+-.5*a;e.forEach((function(e,s,a){e.x=o,e.x+=e.width*e.anchor.x,o+=e.width,(n?i[s-1]:void 0!==i)&&(o+=t.l(n?i[s]:i))}))},t.centerElements2=function(t,e,i){void 0===i&&(i=0),void 0===e&&(e=0);var s=0;t.forEach((function(t,e){s+=t.width})),s+=e*(t.length-1),t.forEach((function(t,a,n){t.left=0==a?i+-.5*s:n[a-1].right+e}))},t.makeMover=function(e){void 0!==t.activeMover&&(t.activeMover.destroy(),t.activeMover.eKey.onDown.removeAll()),t.activeMover=game.add.image(),t.activeMover.obj=e,t.activeMover.cursors=game.input.keyboard.createCursorKeys(),t.activeMover.shiftKey=game.input.keyboard.addKey(Phaser.Keyboard.SHIFT),t.activeMover.eKey=game.input.keyboard.addKey(Phaser.Keyboard.E),t.activeMover.eKey.onDown.add((function(){}),t.activeMover),t.activeMover.update=function(){var t=this.shiftKey.isDown?10:2;this.cursors.down.isDown&&(e.y+=t),this.cursors.up.isDown&&(e.y-=t),this.cursors.left.isDown&&(e.x-=t),this.cursors.right.isDown&&(e.x+=t)}},t.makeLineEditor=function(e){var i=game.add.group();return i.interpolation=e||"linear",i.pointsX=[0],i.pointsY=[0],i.gfx=i.add(game.make.graphics()),i.shiftKey=game.input.keyboard.addKey(Phaser.Keyboard.SHIFT),i.wKey=game.input.keyboard.addKey(Phaser.Keyboard.W),i.wKey.onDown.add((function(){var e,i;this.children.length>2?(e=this.children[this.children.length-1].x,i=this.children[this.children.length-1].y):(e=0,i=0);var s=t.makeImage(e,i,"candy_1");s.anchor.setTo(.5),s.scale.setTo(.1),this.add(s),this.activeObject=s,this.changed=!0}),i),i.qKey=game.input.keyboard.addKey(Phaser.Keyboard.Q),i.qKey.onDown.add((function(){this.children.length<=2||(this.removeChildAt(this.children.length-1),this.children.length>3?this.activeObject=this.children[this.children.length-1]:this.activeObject=null,this.changed=!0)}),i),i.aKey=game.input.keyboard.addKey(Phaser.Keyboard.A),i.aKey.onDown.add((function(){if(this.activeObject){var t=this.getChildIndex(this.activeObject);2!=t&&(this.activeObject=this.getChildAt(t-1))}}),i),i.sKey=game.input.keyboard.addKey(Phaser.Keyboard.S),i.sKey.onDown.add((function(){if(this.activeObject){var t=this.getChildIndex(this.activeObject);t!=this.children.length-1&&(this.activeObject=this.getChildAt(t+1))}}),i),i.eKey=game.input.keyboard.addKey(Phaser.Keyboard.E),i.eKey.onDown.add((function(){}),i),i.cursors=game.input.keyboard.createCursorKeys(),i.activeObject=null,i.preview=t.makeImage(0,0,"candy_2",.5,i),i.preview.width=8,i.preview.height=8,i.preview.progress=0,i.update=function(){if(null!==this.activeObject&&(this.forEach((function(t){t==this.activeObject?t.alpha=1:t.alpha=.5}),this),0!=this.children.length)){var t=this.shiftKey.isDown?3:1;if(this.cursors.down.isDown&&(this.activeObject.y+=t,this.changed=!0),this.cursors.up.isDown&&(this.activeObject.y-=t,this.changed=!0),this.cursors.left.isDown&&(this.activeObject.x-=t,this.changed=!0),this.cursors.right.isDown&&(this.activeObject.x+=t,this.changed=!0),i.preview.progress+=.01,i.preview.progress>1&&(i.preview.progress=0),i.preview.x=game.math[this.interpolation+"Interpolation"](this.pointsX,i.preview.progress),i.preview.y=game.math[this.interpolation+"Interpolation"](this.pointsY,i.preview.progress),this.changed){var e=[],s=[];this.pointsX=e,this.pointsY=s,this.children.forEach((function(t,i){i<=1||(e.push(t.x),s.push(t.y))})),this.gfx.clear(),this.gfx.beginFill(16711680,1);for(var a=0;a<200;a++)this.gfx.drawRect(game.math[this.interpolation+"Interpolation"](e,a/200),game.math[this.interpolation+"Interpolation"](s,a/200),3,3)}}},i},t.lineUtils={getWholeDistance:function(t,e){for(var i=0,s=1;s<t.length;s++)i+=game.math.distance(t[s-1],e[s-1],t[s],e[s]);return i},findPointAtDitance:function(e,i,s){for(var a=0,n=1;n<e.length;n++){var o=game.math.distance(e[n-1],i[n-1],e[n],i[n]);if(o+a>s){var r=game.math.angleBetween(e[n-1],i[n-1],e[n],i[n]);return[e[n-1]+t.lengthDirX(r,s-a,!0),i[n-1]+t.lengthDirY(r,s-a,!0)]}a+=o}return[e[e.length-1],i[i.length-1]]},spreadAcrossLine:function(t,e,i,s,a){for(var n=this.getWholeDistance(t,e)/(i.length-1),o=0;o<i.length;o++){var r=this.findPointAtDitance(t,e,n*o);i[o][s||"x"]=r[0],i[o][a||"y"]=r[1]}},spreadOnNodes:function(t,e,i,s,a){for(var n=0;n<t.length;n++){if(void 0===i[n])return;i[n][s||"x"]=t[n],i[n][a||"y"]=e[n]}}},t.changeSecToTimerFormat=function(e,i){var s=parseInt(e,10),a=!!i&&-1!==i.toUpperCase().indexOf("D"),n=!!i&&-1!==i.toUpperCase().indexOf("H"),o=Math.floor(s/86400),r=Math.floor((s-86400*o)/3600),h=Math.floor((s-86400*o-3600*r)/60),l=s-86400*o-3600*r-60*h,c=t.zeroPad(h)+":"+t.zeroPad(l);return(r>0||o>0||n)&&(c=t.zeroPad(r)+":"+c),(o>0||a)&&(c=t.zeroPad(o)+":"+c),c},t.changeSecToDHMS=function(e,i){var s=parseInt(e,10),a=(!!i&&i.toUpperCase().indexOf("D"),!!i&&i.toUpperCase().indexOf("H"),Math.floor(s/86400)),n=Math.floor((s-86400*a)/3600),o=Math.floor((s-86400*a-3600*n)/60),r=s-86400*a-3600*n-60*o;return[t.zeroPad(a),t.zeroPad(n),t.zeroPad(o),t.zeroPad(r)]},t.zeroPad=function(t){return t<10?"0"+t:t},t.arrayJoin=function(t,e){return t.reduce((function(t,i){return i?t?t+e+i:i:t}),"")},t.makeTextButton=function(t,e,i,s,a,n){var o=game.make.text(t,e,i,s);return o.inputEnabled=!0,o.input.useHandCursor=!0,o.hitArea=new Phaser.Rectangle(0,0,o.width,o.height),o.events.onInputDown.add(a,n||null),o},t.setObjProp=function(t,e,i){var s=t;"string"==typeof e&&e.split(".");try{for(var a=0;a<this.refreshProp.length-1;a++)s=s[this.refreshProp[a]];s[this.refreshProp[this.refreshProp.length-1]]=i}catch(t){}},t.getObjProp=function(t,e){var i=t;"string"==typeof e&&(e=e.split("."));try{for(var s=0;s<e.length;s++)i=i[e[s]]}catch(t){return}return i},void 0===t&&(t={}),t.Utils={cacheText:function(t,e,i,s,a){(e=game.make.bitmapText(0,0,i,e,s)).tint=a||16777215,e.updateCache(),game.make.renderTexture(e.width,e.height,t,!0).render(e),e.destroy()},cacheGText:function(e,i,s){i=new t.Text(0,0,i,s,0);game.make.renderTexture(i.width,i.height,e,!0).render(i),i.destroy()},lerp:function(t,e,i,s){return s&&Math.abs(t-e)<=s?e:t+i*(e-t)},copyToClipboard:function(t){this.copyArea||(this.copyArea=document.createElement("textarea"),this.copyArea.style.positon="fixed",this.copyArea.style.opacity=0,document.body.appendChild(this.copyArea)),this.copyArea.value=t,this.copyArea.select(),document.execCommand("copy")},getObjProp:function(t,e){var i=t;"string"==typeof e&&(e=e.split("."));try{for(var s=0;s<e.length;s++)i=i[e[s]]}catch(t){return}return i},setObjProp:function(t,e,i){var s=t;"string"==typeof e&&(e=e.split("."));try{for(var a=0;a<e.length-1;a++)s=s[e[a]];s[e[e.length-1]]=i}catch(t){return null}},replaceAll:function(t,e,i){return t.split(e).join(i)},removeDuplicates:function(t){var e=[];return t.forEach((function(t){-1===e.indexOf(t)&&e.push(t)})),e},getParentsScaleX:function(e,i){return e==game.stage?1:t.Utils.getParentsScaleX(e.parent,!0)*(i?e.scale.x:1)},getParentsScaleY:function(e,i){return e==game.stage?1:t.Utils.getParentsScaleY(e.parent,!0)*(i?e.scale.y:1)},makeTextButton:function(t,e,i,s,a,n){var o=game.add.text(t,e,i,n);return o.inputEnabled=!0,o.input.useHandCursor=!0,o.hitArea=new Phaser.Rectangle(0,0,o.width,o.height),o.events.onInputDown.add(s,a),o},injectCSS:function(t){var e=document.createElement("style");e.type="text/css",e.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(e)},toClientX:function(t){return(parseInt(game.canvas.style.marginLeft)||0)+t/game.width*game.canvas.clientWidth},toClientY:function(t){return(parseInt(game.canvas.style.marginTop)||0)+t/game.height*game.canvas.clientHeight},clientXToWorldX:function(t){t-=parseInt(game.canvas.style.marginLeft)||0;var e=parseInt(game.canvas.style.width),i=(parseInt(game.canvas.style.height),parseInt(game.canvas.width));parseInt(game.canvas.height);return t*(i/e)},clientYToWorldY:function(t){t-=parseInt(game.canvas.style.marginTop)||0;parseInt(game.canvas.style.width);var e=parseInt(game.canvas.style.height);parseInt(game.canvas.width);return t*(parseInt(game.canvas.height)/e)},getImageURI:function(e){return this._bmpMarker||(this._bmpMarker=t.makeImage(0,0,null,0,null)),this._bmp||(this._bmp=game.make.bitmapData()),this._bmp.clear(),t.changeTexture(this._bmpMarker,e),this._bmp.resize(this._bmpMarker.width,this._bmpMarker.height),this._bmp.draw(this._bmpMarker),this._bmp.canvas.toDataURL()},getRT:function(t){return game.cache.getRenderTexture(t).texture},arraysEqual:function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}},t.lineCircleColl=function(t,e,i){var s=t.start,a=t.end,n=Math.sqrt(Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2)),o=(a.x-s.x)/n,r=(a.y-s.y)/n,h=o*(e.x-s.x)+r*(e.y-s.y),l=h*o+s.x,c=h*r+s.y,d=Math.sqrt(Math.pow(l-e.x,2)+Math.pow(c-e.y,2));if(d<e.radius){var p=Math.sqrt(e.radius*e.radius-d*d),u=(h-p)*o+s.x,g=(h-p)*r+s.y,f=(h+p)*o+s.x,m=(h+p)*r+s.y,y=game.math.distance(s.x,s.y,u,g),x=game.math.distance(s.x,s.y,f,m);return y<x?t.length>y&&(i.setTo(u,g),i):t.length>x&&(i.setTo(f,m),i)}return!1},t.getRT=function(t){var e=game.cache.getRenderTexture(t);return e?e.texture:null},t.numberDot=function(t){for(var e="",i=0,s=(t=t.toString()).length-1;s>=0;s--)e=t[s]+e,3==++i&&0!==s&&(e="."+e,i=0);return e},t.guid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},t.AnimationElement=function(e,i,s,a){t.Image.call(this,e,i,null),this.ANIMATIONELEMENT=!0,this.SPR=new t.Image(0,0,null,.5,this),this.frameCounter=0,this.data=s,this.currentAnimationData=null,this.currentAnimationName=null,this.playing=void 0===a||a},t.AnimationElement.prototype=Object.create(t.Image.prototype),t.AnimationElement.prototype.update=function(){this.currentAnimationName&&this.playing&&(this.frameCounter++,this.updateAnimation(this.frameCounter))},t.AnimationElement.prototype.pause=function(){this.playing=!1},t.AnimationElement.prototype.resume=function(){this.playing=!0},t.AnimationElement.prototype.play=function(){this.playing=!0},t.AnimationElement.prototype.stop=function(){this.playing=!1,this.updateAnimation(0)};t.AnimationElement.prototype.changeAnimationData=function(t){this.data[t]||(t=Object.keys(this.data)[0]),this.eventTL=this.data[t].eventTL,this.frameTL=this.data[t].frameTL,this.propTLS=this.data[t].propTLS,this.propKeys=Object.keys(this.propTLS),this.currentAnimationData=this.data[t],this.currentAnimationName=t,this.updateAnimation(0)},t.AnimationElement.prototype.playAnimation=function(t){this.changeAnimationData(t),this.playing=!0},t.AnimationElement.prototype.getLastKeyFrame=function(t,e){for(var i=t.length,s=0;s<i;s++){if(t[s].f==e||s==i-1)return t[s];if(t[s].f<e&&e<t[s+1].f)return t[s]}},t.AnimationElement.prototype.getNextKeyFrame=function(t,e){for(var i=t.length,s=0;s<i;s++)if(t[s].f>t||s==i-1)return t[s]},t.AnimationElement.prototype.getKeyFrameAt=function(t,e){if(!this.currentAnimationName)return null;for(var i=0;i<t.length;i++){var s=t[i];if(s.f===e)return s}return null},t.AnimationElement.prototype.isAnyKeyFrameAt=function(t){if(!this.currentAnimationName)return!1;if(this.getKeyFrameAt(this.eventTL,t))return!0;if(this.getKeyFrameAt(this.frameTL,t))return!0;for(var e=0;e<this.propKeys.length;e++){var i=this.propKeys[e];if(this.getKeyFrameAt(this.propTLS[i],t))return!0}return!1},t.AnimationElement.prototype.getFrameValue=function(t,e){var i=this.getLastKeyFrame(t,e),s=this.getNextKeyFrame(t,e);if(i.e){var a=s.f-i.f,n=s.v-i.v,o=Phaser.Easing[i.e[0]][i.e[1]]((e-i.f)/a);return i.v+n*o}return i.v},t.AnimationElement.prototype.updateAnimation=function(e){if(this.currentAnimationName){this.frameCounter=e,this.updateFromPropTLS(e);var i=this.getTextureFrameValue(this.frameTL,e);this.SPR.key!=i&&this.SPR.frameName!=i&&t.changeTexture(this.SPR,i)}},t.AnimationElement.prototype.updateFromPropTLS=function(t){for(var e=0;e<this.propKeys.length;e++){var i=this.propKeys[e];this.setProp(i,this.getFrameValue(this.propTLS[i],t))}},t.AnimationElement.prototype.setProp=function(t,e){"scale.x"==t?this.SPR.scale.x=e:"scale.y"==t?this.SPR.scale.y=e:"anchor.x"==t?this.SPR.anchor.x=e:"anchor.y"==t?this.SPR.anchor.y=e:this.SPR[t]=e},t.AnimationElement.prototype.getTextureFrameValue=function(t,e){var i=this.getLastKeyFrame(t,e),s=i.frameSkip||1,a=e-i.f;if(a=Math.floor(a/s),!i.animation)return i.v;var n=i.v.length;return i.loop?i.refraction||i.reverse?i.refraction&&!i.reverse?i.v[Math.min(n-1,a%(n+i.refraction))]:void 0:i.v[a%n]:i.v[Math.min(n-1,a)]},t.GroupColliderLineLine=function(e,i,s,a){t.Image.call(this,0,0,null),this.group1=e,this.group2=i,this.callback=s,this.context=a||null,this.collPoint=new Phaser.Point(0,0)},t.GroupColliderLineLine.prototype=Object.create(t.Image.prototype),t.GroupColliderLineLine.prototype.update=function(){for(var t=this.group1.length,e=this.group2.length,i=0;i<t;i++)for(var s=this.group1.children[i],a=0;a<e;a++){var n=this.group2.children[a];s!==n&&(s.collLine.intersects(n.collLine,!0,this.collPoint)&&this.callback.call(this.context,s,n,this.collPoint,this.group1,this.group2))}},t.GroupColliderLineCircle=function(e,i,s,a){t.Image.call(this,0,0,null),this.group1=e,this.group2=i,this.callback=s,this.context=a||null,this.collPoint=new Phaser.Point(0,0)},t.GroupColliderLineCircle.prototype=Object.create(t.Image.prototype),t.GroupColliderLineCircle.prototype.update=function(){this.group1.length,this.group2.length;for(var e=this.group1.length;e--;)for(var i=this.group1.children[e],s=this.group2.length;s--;){var a=this.group2.children[s];i!==a&&(t.lineCircleColl(i.collLine,a.collCircle,this.collPoint)&&this.callback.call(this.context,i,a,this.collPoint,this.group1,this.group2))}},Phaser.Group.prototype.destroy=function(t,e){null===this.game||this.ignoreDestroy||(void 0===t&&(t=!0),void 0===e&&(e=!1),this.onDestroy.dispatch(this,t,e),this.removeAll(t),this.cursor=null,this.filters=null,this.alive=!1,this.pendingDestroy=!1,e||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))},Phaser.exportChildren=function(t){for(var e=[],i=0;i<t.children.length;i++){var s=t.children[i];s.exportToString&&e.push(s.exportToString())}return e},Phaser.Group.prototype.exportToString=function(){return{type:"GROUP",x:this.x,y:this.y,scale:[this.scale.x,this.scale.y],angle:this.angle,children:Phaser.exportChildren(this)}},Phaser.Image.prototype.exportToString=function(){return exportObj={type:"IMG",x:this.x,y:this.y,frame:this.frameName,anchor:[this.anchor.x,this.anchor.y],scale:[this.scale.x,this.scale.y],angle:this.angle,children:Phaser.exportChildren(this)},exportObj},void 0===t&&(t={}),t.ASSETS={spritesheets:["gems","ssheet"],sfx:["boom.mp3","btn_pressed.mp3","firework.mp3","firework2.mp3","game_over.mp3","game_won.mp3","match.mp3","music.mp3","new_highscore.mp3","new_level.mp3","pop.mp3","score_counter.mp3","stone_selection.mp3","timer.mp3"],images:[],json:["languages.json","levels.json","settings.json"],fonts:{font:{data:"font.fnt",frame:"font.png"}}},t.Boot=function(t){},t.Boot.prototype={init:function(){t.lang=sgSettings.config.env.locale,this.scale.pageAlignHorizontally=!0,this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.stage.backgroundColor=0,this.input.maxPointers=1,this.stage.disableVisibilityChange=!0,game.tweens.frameBased=!0,game.time.advancedTiming=!0,game.input.mouse.enabled=!game.device.mspointer,this.game.device.desktop||(this.orientationDiv=document.getElementById("orientation"),this.scale.forceOrientation(!1,!0),this.scale.enterIncorrectOrientation.add(this.enterIncorrectOrientation,this),this.scale.leaveIncorrectOrientation.add(this.leaveIncorrectOrientation,this)),this.scaleGameSizeUpdate=function(){var e=window.innerHeight/window.innerWidth,i=window.innerWidth/window.innerHeight;if(game.device.desktop){var s=t.l(1200),a=t.l(800);i>=1.5?game.scale.setGameSize(Math.max(s,Math.floor(i*a)),a):game.scale.setGameSize(s,Math.floor(e*s))}else{s=t.l(800),a=t.l(1200);i>.666?game.scale.setGameSize(Math.max(s,Math.floor(i*a)),a):game.scale.setGameSize(s,Math.floor(e*s))}game.world.setBounds(0,0,game.width,game.height),t.sb("onScreenResize").dispatch()},t.sb=t.SignalBox,t.extLoader=new t.ExtLoader(game),game.resizeGame=this.scaleGameSizeUpdate,game.incentivised=sgSettings.config.rewarded.enabled,this.scale.setResizeCallback((function(){t.old_w==window.innerWidth&&t.old_h==window.innerHeight||(t.old_w=window.innerWidth,t.old_h=window.innerHeight,game.resizeGame())}))},preload:function(){t.Loader.loadBootAssets(t.lang)},create:function(){game.resizeGame(),this.state.start("Preloader")},enterIncorrectOrientation:function(){"block"!==this.orientationDiv.style.display&&(this.orientationDiv.style.display="block","DIV"==game.canvas.parentElement.tagName&&(game.canvas.parentElement.style.display="none"))},leaveIncorrectOrientation:function(){"none"!==this.orientationDiv.style.display&&(this.orientationDiv.style.display="none","DIV"==game.canvas.parentElement.tagName&&(game.canvas.parentElement.style.display="block"))}},Phaser.Stage.prototype.visibilityChange=function(e){if("pagehide"!==e.type&&"blur"!==e.type&&"pageshow"!==e.type&&"focus"!==e.type)if(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||"pause"===e.type)game.sound.mute=!0,game.input.pointers.forEach((function(t){t.active=!1}));else try{game.sound.mute=!t.saveState.data.soundButtonState}catch(t){game.sound.mute=!1}else"pagehide"===e.type||"blur"===e.type?this.game.focusLoss(e):"pageshow"!==e.type&&"focus"!==e.type||this.game.focusGain(e)},t.Game=function(t){},t.Game.prototype={init:function(){lvlNr=t.saveState.data.progress[0],this.lvlNr=game.math.clamp(lvlNr,0,t.json.levels.length-1),this.lvlData=t.json.levels[this.lvlNr],this.hintsNr=t.saveState.data.progress[2],this.pause=!1,this.pauseWindow=null,game.onPause.add(this.showPause,this)},showPause:function(){this.pauseWindow||new t.PauseWindow},shutdown:function(){t.sfx.music.resume(),game.onPause.remove(this.showPause,this)},create:function(){if(sdkHandler.trigger("levelStart",{level:this.lvlNr+1},this),t.sfx.new_level.play(),setInterval((function(){t.saveState.save()}),3e3),s=game.state.getCurrentState(),this.bg=new t.Background,this.board=new t.Board(this.lvlData),game.add.tween(this.board).from({alpha:0},500,Phaser.Easing.Sinusoidal.Out,!0),this.comboUI=new t.ComboUI,this.uiBar=new t.UIBar,game.device.desktop&&(this.soundBtn=new t.SoundBtn),this.hintBtn=new t.HintBtn,this.menuBtn=new t.MenuBtn,this.flyingGemsGroup=game.add.group(),this.flyingGemsGroup.fixedToCamera=!0,this.fadeInput=new t.FadeInput,t.sb("onTimesUp").add(this.onTimesUp,this),t.sb("onBoardEmpty").add(this.onBoardEmpty,this),t.sb("onBonusTimeZero").add((function(){this.autoSave=!1,this.lvlNr===t.json.levels.length-1?new t.GameOverWindow(t.saveState.data.progress[1],!0):game.time.events.add(500,(function(){sdkHandler.trigger("levelFinish",{level:this.lvlNr+1,score:t.saveState.data.progress[1],state:"win"},this),game.state.start("Game",!0,!1,this.lvlNr+1)}),this)}),this),this.fxLayer=new t.FxLayer(this.board),this.uiTargetParticles=new t.UITargetParticles,"MainMenu"==t.prevGameState&&game.camera.flash(0,600),t.prevGameState="Game",-1!==window.location.hash.indexOf("DEBUG")){var e=game.input.keyboard.createCursorKeys();e.left.onDown.add((function(){t.saveState.resetProgress(),t.saveState.data.progress[0]=this.lvlNr-1,game.state.start("Game",!0,!1,this.lvlNr-1)}),this),e.right.onDown.add((function(){t.saveState.resetProgress(),t.saveState.data.progress[0]=this.lvlNr+1,game.state.start("Game",!0,!1,this.lvlNr+1)}),this)}},update:function(){},onTimesUp:function(){this.autoSave=!1,t.sfx.game_over.play(),this.board.update=function(){};var e=t.saveState.data.progress[1];t.saveState.resetProgress();var i=new t.LevelCompleteTxt(t.txt("Time is up!"));game.time.events.add(2e3,(function(){new t.GameOverWindow(e),i.hide()}),this)},onBoardEmpty:function(){this.autoSave=!1,t.sfx.game_won.play(),new t.LevelCompleteTxt(t.txt("Level %NR% completed").replace("%NR%",this.lvlNr+1)),t.saveState.levelEnd(!0)},render:function(){}},t.GameProto=function(t){},t.GameProto.prototype={create:function(){s=game.state.getCurrentState(),this.gfx=game.add.graphics(),this.grid=new t.GridArray(10,10,!1),this.grid.loop((function(t,e,i,s){s[e][i]=game.rnd.between(1,10)})),this.drawGfx(),this.keyX=game.input.keyboard.addKey(Phaser.Keyboard.X),this.keyX.onDown.add((function(){var t=game.input.activePointer;xx=Math.floor(t.x/40),yy=Math.floor(t.y/40),this.grid.set(xx,yy,!1),this.drawGfx()}),this)},drawGfx:function(){this.gfx.clear(),this.grid.loop((function(t,e,i){this.gfx.beginFill([0,16711680,10035712,65280,8840,5570815,21879,16711935,6736998,10039903,16724575][t],1),this.gfx.drawRect(40*e,40*i,40,40)}),this)},findMatch:function(t,e,i,s){if(this.grid.get(t,e)!==this.grid.get(i,s))return!1;if(t==i&&e==s)return!1;if(1==this.getDistanceBetweenCells([t,e],[i,s]))return[[t,e],[i,s]];var a=this.getRaysForCell(t,e),n=this.getRaysForCell(i,s),o=this.findRoutes(a,n);return 0!=o.length&&this.getShortestFullRoute([t,e],[i,s],o)},getShortestFullRoute:function(t,e,i){var s=i.filter((function(t){return 1==t.length}));return s[0]?[t,s[0][0],e]:i.filter((function(t){return 2==t.length})).map((function(i){var s=this.getDistanceBetweenCells(t,i[0])+this.getDistanceBetweenCells(i[0],i[1])+this.getDistanceBetweenCells(i[1],e);return{route:[t,i[0],i[1],e],routeLength:s}}),this).sort((function(t,e){return t.routeLength>e.routeLength}))[0].route},getDistanceBetweenCells:function(t,e){return Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])},findRoutes:function(e,i){var s=[];return e.forEach((function(e){i.forEach((function(i){return t.Utils.arraysEqual(e,i)?s.push([e]):this.isSpaceBetweenFree(e,i)?s.push([e,i]):void 0}),this)}),this),s},isSpaceBetweenFree:function(t,e){if(t[0]==e[0]){for(var i=Math.min(t[1],e[1]),s=Math.max(t[1],e[1]),a=i;a<s;a++)if(this.grid.get(t[0],a))return!1;return!0}if(t[1]==e[1]){for(i=Math.min(t[0],e[0]),s=Math.max(t[0],e[0]),a=i;a<s;a++)if(this.grid.get(a,t[1]))return!1;return!0}return!1},getRaysForCell:function(t,e){var i=this.getRayInDir(t,e,0,-1),s=this.getRayInDir(t,e,0,1),a=this.getRayInDir(t,e,-1,0),n=this.getRayInDir(t,e,1,0);return[].concat(i,s,a,n)},getRayInDir:function(t,e,i,s){for(var a=[];!this.grid.get(t+i,e+s)&&(t+=i,e+=s,a.push([t,e]),this.grid.isInGrid(t,e)););return a},getAllPossibleMoves:function(){var t={};this.grid.loop((function(e,i,s){e&&!t[e]&&(t[e]=[],this.grid.loop((function(i,s,a){i===e&&t[e].push([s,a])})))}),this);var e=[];for(val in t)for(var i=t[val],s=i.length,a=0;a<s;a++)for(var n=i[a],o=a+1;o<s;o++){var r=i[o];this.findMatch(n[0],n[1],r[0],r[1])&&e.push([n,r])}return e},render:function(){var t=game.input.activePointer;xx=Math.floor(t.x/40),yy=Math.floor(t.y/40),game.debug.text(xx+"x"+yy,10,10,"#ffffff")}},t.MainMenu=function(t){},t.MainMenu.prototype={create:function(){s=game.state.getCurrentState(),this.bg=new t.Background,this.logo=new t.Logo(.5,.42,!0),this.playButton=new t.MainMenuPlayButton(.5,.76,!0),this.fadeInput=new t.FadeInput,game.resizeGame(),game.camera.flash(0,600),t.prevGameState="MainMenu"}},t.Preloader=function(t){this.ready=!1},t.Preloader.prototype={preload:function(){this.load.onFileComplete.add((function(t){sdkHandler.trigger("loading.update",{progressPercentage:t})})),t.Loader.loadAssets()},create:function(){t.Text.addStyle("regular",{font:"Lobster",fill:"#914023",fontSize:"30px",shadow:[0,1,"rgba(248,216,182,1)",0]}),t.Text.addStyle("ribbon",{font:"Lobster",fill:"#fdfd4b",fontSize:30}),t.Text.addStyle("endGameTexts",{font:"Lobster",fill:"#f8d8b6",fontSize:70,stroke:"#914023",strokeThickness:10}),t.saveState.init(),game.resizeGame()},update:function(){!this.ready&&t.saveState.ready&&(sdkHandler.trigger("loading.completed",{callback:function(){}}),this.ready=!0)}},t.Test=function(t){},t.Test.prototype={create:function(){s=game.state.getCurrentState(),this.borders=game.add.group(),this.test_border=t.makeImage(0,0,"gem_test_border",0),this.top=game.add.group(),this.test=t.makeImage(0,0,"gem_test",0),this.test_border.position=this.test.position,this.cursors=game.input.keyboard.createCursorKeys(),this.cursors.right.onDown.add((function(){this.test.x+=25.5}),this),this.cursors.left.onDown.add((function(){this.test.x-=25.5}),this),this.cursors.up.onDown.add((function(){this.test.y-=36}),this),this.cursors.down.onDown.add((function(){this.test.y+=36}),this),this.addRandom()},addRandom:function(){this.grid=new t.GridArray(10,10);for(var e=0;e<50;e++){var i=game.rnd.between(0,9),s=game.rnd.between(0,9);if(!this.grid.get(i,s)){var a=51+51*i,n=72+72*s,o=t.makeImage(a,n,"gem_test_border",0,this.borders),r=t.makeImage(a,n,"gem_test",0,this.top);o.zz=5*a+1e3*n,r.zz=o.zz}}this.borders.sort("zz",Phaser.Group.SORT_DESCENDING),this.top.sort("zz",Phaser.Group.SORT_DESCENDING)}},t.Board=function(e){if(Phaser.Group.call(this,game),this.state=game.state.getCurrentState(),game.device.desktop)var i=t.json.settings.boardSize[0],s=t.json.settings.boardSize[1];else i=t.json.settings.mobileBoardSize[0],s=t.json.settings.mobileBoardSize[1];this.moves=[],this.grid=new t.GridArray(i,s,!1),this.tileSize=t.json.settings.tileSize,this.tileWidth=this.tileSize[0],this.tileHeight=this.tileSize[1],this.gemTypes=e.gemTypes,this.cacheGroup=game.make.group(),this.cacheGroup.visible=!1,this.bottomRTLayer=new t.RTLayer(this,this.cacheGroup,!1),this.add(this.bottomRTLayer),this.backMoveable=new t.BoardMoveBackLayer(this),this.add(this.backMoveable),this.topMoveable=game.add.group(),this.add(this.topMoveable),this.topRTLayer=new t.RTLayer(this,this.cacheGroup,!0),this.add(this.topRTLayer),null==t.saveState.data.progress[4]?this.fillBoard():this.loadSnapshot(),this.orderRedraw=!0,this.postUpdate(),this.inputMgr=new t.BoardInputMgr(this),this.add(this.inputMgr),this.boardHint=new t.BoardHint(this),this.add(this.boardHint),this.matcher=new t.BoardMatcher(this),this.fallMgr=new t.BoardFallMgr(this,e.fallType),this.orderRedraw=!1,t.sb("onMoveStart").add(this.onMoveStart,this),t.sb("onMoveFinish").add(this.onMoveFinish,this),t.sb("onSceenResize").add(this.center,this),t.sb("onPause").add(this.onPause,this),t.sb("onUnpause").add(this.onUnpause,this),t.sb("onScreenResize").add(this.center,this),this.center(),this.possibleMoves=null,this.onIdle=new Phaser.Signal,this.idle=!1},t.Board.prototype=Object.create(Phaser.Group.prototype),t.Board.prototype.update=function(){for(var e=this.moves.length-1;e>=0;e--)this.moves[e].update();this.fallMgr.update(),this.inputMgr.update(),this.topMoveable.sort("y",Phaser.Group.SORT_DESCENDING),0==this.moves.length?this.idle||(this.onIdle.dispatch(),this.idle=!0,this.makeSnapshot(),this.possibleMoves=this.matcher.getAllPossibleMoves(),0==this.possibleMoves.length&&(this.checkWin()?(t.sb("onBoardEmpty").dispatch(!0),this.EMPTY=!0,this.update=function(){}):this.shuffleBoard())):this.idle=!1},t.Board.prototype.postUpdate=function(){this.orderRedraw&&(this.orderRedraw=!1,this.cacheGroup.forEach((function(t){t.zz=-100*t.cellY+t.cellX})),this.cacheGroup.sort("zz",Phaser.Group.SORT_ASCENDING),this.bottomRTLayer.redrawGroup(),this.topRTLayer.redrawGroup())},t.Board.prototype.processMatch=function(e){t.sb("onProcessMatch").dispatch();var i=this.grid.get(e[0][0],e[0][1]);i.inputLocked=!0;var s=this.grid.get(e[e.length-1][0],e[e.length-1][1]);s.inputLocked=!0;var a=i.x<s.x?-1:1,n=-1*a,o=new t.GemFlying(this.x+i.x*this.scale.x,this.y+i.y*this.scale.y,i.matchType,this.scale.x);this.state.flyingGemsGroup.add(o);var r=new t.GemFlying(this.x+s.x*this.scale.x,this.y+s.y*this.scale.y,s.matchType,this.scale.x);this.state.flyingGemsGroup.add(r);var h=game.device.desktop?110:150;1===a?(this.state.flyingGemsGroup.bringToTop(o),o.flyTo(.5*game.width,game.height-h,a),r.flyTo(.5*game.width-74,game.height-h,n)):(this.state.flyingGemsGroup.bringToTop(r),o.flyTo(.5*game.width-74,game.height-h,a),r.flyTo(.5*game.width,game.height-h,n)),this.grid.set(e[0][0],e[0][1],!1),this.grid.set(e[e.length-1][0],e[e.length-1][1],!1),t.sb("onMatch").dispatch(i,s),this.idle=!1,i.destroy(),s.destroy(),t.sfx.match.play(),this.orderRedraw=!0},t.Board.prototype.checkWin=function(){return allFalse=!0,this.grid.loop((function(t){t&&(allFalse=!1)})),allFalse},t.Board.prototype.onMoveStart=function(t){this.moves.push(t),this.topMoveable.add(t.gem),this.topMoveable.updateTransform(),this.orderRedraw=!0,this.possibleMoves=null},t.Board.prototype.onMoveFinish=function(t){this.moves.splice(this.moves.indexOf(t),1),t.FALL&&(this.cacheGroup.add(t.gem),this.orderRedraw=!0,t.gem.inputLocked=!1)},t.Board.prototype.cellToPx=function(t,e){return[t*this.tileWidth,e*this.tileHeight]},t.Board.prototype.fillBoard=function(){for(var e=this.grid.width*this.grid.height,i=[],s=0;s<e;s+=2){var a=s%this.gemTypes;i.push(a,a)}Phaser.ArrayUtils.shuffle(i),this.grid.loop((function(e,s,a,n){n[s][a]=new t.Gem(this,s,a,i.pop()),this.cacheGroup.add(n[s][a])}),this)},t.Board.prototype.shuffleBoard=function(t){var e=[],i=[];this.grid.loop((function(t,s,a){t&&(i.push(t),e.push([s,a]))}));for(var s=0;!(0!=s&&0!=this.matcher.getAllPossibleMoves().length||(Phaser.ArrayUtils.shuffle(i),e.forEach((function(t,e){var s=i[e],a=this.cellToPx(t[0],t[1]);s.x=a[0],s.y=a[1],this.grid.set(t[0],t[1],s)}),this),s++>20)););this.possibleMoves=this.matcher.getAllPossibleMoves(),this.orderRedraw=!0},t.Board.prototype.center=function(){var t=new Phaser.Rectangle;game.device.desktop?t.setTo(0,50,game.width,game.height-180):t.setTo(0,30,game.width,game.height-200),this.putInRect(t)},t.Board.prototype.putInRect=function(t){var e=this.grid.width*this.tileWidth,i=this.grid.height*this.tileHeight,s=Math.min(1,t.width/e),a=Math.min(1,t.height/i),n=Math.min(s,a),o=e*n,r=i*n;this.x=Math.round(t.x+.5*(t.width-o)),this.y=Math.round(t.y+.5*(t.height-r)),this.scale.setTo(n)},t.Board.prototype.onPause=function(){t.stopTweens(this),game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.In,!0)},t.Board.prototype.onUnpause=function(){t.stopTweens(this),game.add.tween(this).to({alpha:1},300,Phaser.Easing.Sinusoidal.Out,!0)},t.Board.prototype.makeSnapshot=function(){var e=[];this.grid.loop((function(t,i,s){t&&e.push(i,s,t.matchType)})),t.saveState.data.progress[4]=e,t.saveState.save()},t.Board.prototype.loadSnapshot=function(){for(var e=t.saveState.data.progress[4],i=0;i<e.length;i+=3){var s=e[i],a=e[i+1],n=e[i+2];this.grid.set(s,a,new t.Gem(this,s,a,n)),this.cacheGroup.add(this.grid.get(s,a))}},t.BoardFallMgr=function(t,e){this.board=t,this.grid=t.grid,this.fallType=e,this.update=this["fallUpdate"+e],this.halfRow=game.device.desktop?5:8,this.halfCollumn=game.device.desktop?7:3},t.BoardFallMgr.prototype.makeFall=function(e,i,s,a){var n=this.grid.get(e,i);this.grid.set(s,a,n),this.grid.set(e,i,!1),n.inputLocked=!0;new t.BoardMoveObject(this.board,n,[[e,i],[s,a]],!0)},t.BoardFallMgr.prototype.fallUpdateNone=function(){},t.BoardFallMgr.prototype.fallUpdateDown=function(){for(var t=0;t<this.grid.width;t++)for(var e=this.grid.height-1;e>=0;e--)if(!this.grid.get(t,e))for(var i=e-1;i>=0;i--){var s=this.grid.get(t,i);if(s){s.inputLocked||this.makeFall(t,i,t,e);break}}},t.BoardFallMgr.prototype.fallUpdateUp=function(){for(var t=0;t<this.grid.width;t++)for(var e=0;e<this.grid.height;e++)if(!this.grid.get(t,e))for(var i=e+1;i<this.grid.height;i++){var s=this.grid.get(t,i);if(s){s.inputLocked||this.makeFall(t,i,t,e);break}}},t.BoardFallMgr.prototype.fallUpdateUpDown=function(){for(var t=0;t<this.grid.width;t++){for(var e=0;e<this.halfRow;e++)if(!this.grid.get(t,e))for(var i=e+1;i<this.halfRow;i++){if(s=this.grid.get(t,i)){s.inputLocked||this.makeFall(t,i,t,e);break}}for(e=this.grid.height-1;e>=this.halfRow;e--)if(!this.grid.get(t,e))for(i=e-1;i>=this.halfRow;i--){var s;if(s=this.grid.get(t,i)){s.inputLocked||this.makeFall(t,i,t,e);break}}}},t.BoardFallMgr.prototype.fallUpdateRight=function(){for(var t=0;t<this.grid.height;t++)for(var e=this.grid.width-1;e>=0;e--)if(!this.grid.get(e,t))for(var i=e-1;i>=0;i--){var s=this.grid.get(i,t);if(s){s.inputLocked||this.makeFall(i,t,e,t);break}}},t.BoardFallMgr.prototype.fallUpdateLeft=function(){for(var t=0;t<this.grid.height;t++)for(var e=0;e<this.grid.width;e++)if(!this.grid.get(e,t))for(var i=e+1;i<this.grid.width;i++){var s=this.grid.get(i,t);if(s){s.inputLocked||this.makeFall(i,t,e,t);break}}},t.BoardFallMgr.prototype.fallUpdateLeftRight=function(){for(var t=0;t<this.grid.height;t++){for(var e=0;e<this.halfCollumn;e++)if(!this.grid.get(e,t))for(var i=e+1;i<this.halfCollumn;i++){if(s=this.grid.get(i,t)){s.inputLocked||this.makeFall(i,t,e,t);break}}for(e=this.grid.width-1;e>=this.halfCollumn;e--)if(!this.grid.get(e,t))for(i=e-1;i>=this.halfCollumn;i--){var s;if(s=this.grid.get(i,t)){s.inputLocked||this.makeFall(i,t,e,t);break}}}},t.BoardHint=function(e){Phaser.Group.call(this,game),this.board=e,game.add.tween(this).to({alpha:.7},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.highlightHint1=t.makeImage(0,0,"gem_highlight_hint",0,this),this.highlightHint1.pivot.setTo(4,5),this.highlightHint1.visible=!1,this.highlightHint2=t.makeImage(0,0,"gem_highlight_hint",0,this),this.highlightHint2.pivot.setTo(4,5),this.highlightHint2.visible=!1,t.sb("onHint").add(this.showHint,this),t.sb("onProcessMatch").add(this.hideHint,this)},t.BoardHint.prototype=Object.create(Phaser.Group.prototype),t.BoardHint.prototype.showHint=function(){if(!(this.board.moves.length>0)){var e=game.rnd.pick(this.board.possibleMoves),i=this.board.grid.get(e[0][0],e[0][1]),s=this.board.grid.get(e[1][0],e[1][1]);if(i&&s){this.highlightHint1.position.set(i.x,i.y),this.highlightHint2.position.set(s.x,s.y);this.board.grid.get(e[0][0],e[0][1]+1),this.board.grid.get(e[1][0],e[1][1]+1);t.changeTexture(this.highlightHint1,"gem_hl"),t.changeTexture(this.highlightHint2,"gem_hl"),this.highlightHint1.visible=!0,this.highlightHint2.visible=!0}}},t.BoardHint.prototype.hideHint=function(){this.highlightHint1.visible=!1,this.highlightHint2.visible=!1},t.BoardInputMgr=function(e){Phaser.Group.call(this,game),this.state=game.state.getCurrentState(),this.highlight=t.makeImage(0,0,"gem_selection",0,this),this.highlight.pivot.setTo(4,5),game.add.tween(this.highlight).to({alpha:.5},500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.board=e,this.cell1=null,this.locked=!1,game.input.onDown.add(this.onClick,this),t.sb("onTimesUp").add((function(){this.locked=!0}),this),t.sb("onPause").add((function(){this.cell1=null,this.locked=!0}),this),t.sb("onUnpause").add((function(){this.cell1=null,this.locked=!1}),this)},t.BoardInputMgr.prototype=Object.create(Phaser.Group.prototype),t.BoardInputMgr.prototype.update=function(){this.locked&&(this.cell1=null),this.cell1?(this.highlight.visible=!0,this.highlight.x=this.cell1[0]*this.board.tileWidth,this.highlight.y=this.cell1[1]*this.board.tileHeight):this.highlight.visible=!1},t.BoardInputMgr.prototype.onClick=function(t){if(!this.state.pause&&!this.locked){var e=Math.floor((t.x-this.board.worldPosition.x)/(this.board.tileWidth*this.board.scale.x)),i=Math.floor((t.y-this.board.worldPosition.y)/(this.board.tileHeight*this.board.scale.y)),s=this.board.grid.get(e,i);if(s&&!s.inputLocked)if(null==this.cell1)this.selectCell(e,i);else{var a=this.board.grid.get(this.cell1[0],this.cell1[1]);if(!a)return void this.deselect();if(a.matchType==s.matchType){var n=this.board.matcher.findMatch(this.cell1[0],this.cell1[1],e,i);n&&this.board.processMatch(n),this.cell1=null}else this.selectCell(e,i)}}},t.BoardInputMgr.prototype.selectCell=function(e,i){t.sfx.stones_touch.play();var s=this.board.grid.get(e,i);this.board.grid.get(e,i+1);s&&(this.cell1=[e,i],this.highlight.visible=!0,this.highlight.position.setTo(s.x,s.y))},t.BoardInputMgr.prototype.deselect=function(){this.cell1=null,this.highlight.visible=!1},t.BoardMatcher=function(t){this.board=t,this.grid=t.grid},t.BoardMatcher.prototype.findMatch=function(t,e,i,s){if(t==i&&e==s)return!1;if(this.grid.get(t,e).matchType!==this.grid.get(i,s).matchType)return!1;if(1==this.getDistanceBetweenCells([t,e],[i,s]))return[[t,e],[i,s]];var a=this.getRaysForCell(t,e),n=this.getRaysForCell(i,s),o=this.findRoutes(a,n);return 0!=o.length&&this.getShortestFullRoute([t,e],[i,s],o)},t.BoardMatcher.prototype.getShortestFullRoute=function(t,e,i){var s=i.filter((function(t){return 1==t.length}));return s[0]?[t,s[0][0],e]:i.filter((function(t){return 2==t.length})).map((function(i){var s=this.getDistanceBetweenCells(t,i[0])+this.getDistanceBetweenCells(i[0],i[1])+this.getDistanceBetweenCells(i[1],e);return{route:[t,i[0],i[1],e],routeLength:s}}),this).sort((function(t,e){return t.routeLength-e.routeLength}))[0].route},t.BoardMatcher.prototype.getDistanceBetweenCells=function(t,e){return Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])},t.BoardMatcher.prototype.findRoutes=function(e,i){var s=[];return e.forEach((function(e){i.forEach((function(i){return t.Utils.arraysEqual(e,i)?s.push([e]):this.isSpaceBetweenFree(e,i)?s.push([e,i]):void 0}),this)}),this),s},t.BoardMatcher.prototype.isSpaceBetweenFree=function(t,e){if(t[0]==e[0]){for(var i=Math.min(t[1],e[1]),s=Math.max(t[1],e[1]),a=i;a<s;a++)if(this.grid.get(t[0],a))return!1;return!0}if(t[1]==e[1]){for(i=Math.min(t[0],e[0]),s=Math.max(t[0],e[0]),a=i;a<s;a++)if(this.grid.get(a,t[1]))return!1;return!0}return!1},t.BoardMatcher.prototype.getRaysForCell=function(t,e){var i=this.getRayInDir(t,e,0,-1),s=this.getRayInDir(t,e,0,1),a=this.getRayInDir(t,e,-1,0),n=this.getRayInDir(t,e,1,0);return[].concat(i,s,a,n)},t.BoardMatcher.prototype.getRayInDir=function(t,e,i,s){for(var a=[];!this.grid.get(t+i,e+s)&&(t+=i,e+=s,a.push([t,e]),this.grid.isInGrid(t,e)););return a},t.BoardMatcher.prototype.getAllPossibleMoves=function(){var t={};this.grid.loop((function(e,i,s){e&&!t[e.matchType]&&(t[e.matchType]=[],this.grid.loop((function(i,s,a){i&&i.matchType===e.matchType&&t[e.matchType].push([s,a])})))}),this);var e=[];for(val in t)for(var i=t[val],s=i.length,a=0;a<s;a++)for(var n=i[a],o=a+1;o<s;o++){var r=i[o];this.findMatch(n[0],n[1],r[0],r[1])&&e.push([n,r])}return e},t.BoardMoveBackLayer=function(e){Phaser.Group.call(this,game),this.deadArray=[],t.sb("onMoveStart").add(this.onMove,this)},t.BoardMoveBackLayer.prototype=Object.create(Phaser.Group.prototype),t.BoardMoveBackLayer.prototype.getFreePart=function(){var e;return this.deadArray[0]?(e=this.deadArray.pop(),this.add(e)):e=t.makeImage(0,0,null,0,this),this.updateTransform(),e},t.BoardMoveBackLayer.prototype.onMove=function(e){var i=this.getFreePart();t.changeTexture(i,"blog_back"),i.position=e.gem.position,i.pivot.setTo(-5,8),e.onFinish.add((function(){this.removeChild(i),this.deadArray.push(i)}),this)},t.BoardMoveObject=function(e,i,s,a){if(this.board=e,this.gem=i,this.FALL=a||!1,this.beginPos=[this.gem.x,this.gem.y],this.routeRaw=s,this.routeMap=this.processRoute(s),this.moveSpeed=0,this.moveSpeedDelta=1,this.progress=0,!this.FALL){var n=Math.max(Math.floor(.6*this.routeMap.len),300);game.add.tween(this).to({progress:this.routeMap.len},n,Phaser.Easing.Sinusoidal.InOut,!0)}this.onTurn=new Phaser.Signal,this.onFinish=new Phaser.Signal,t.sb("onMoveStart").dispatch(this)},t.BoardMoveObject.prototype.update=function(){if(this.FALL&&(this.moveSpeed+=this.moveSpeedDelta,this.progress+=this.moveSpeed),this.progress>=this.routeMap.len){if(this.FALL){var e=this.routeMap.nodes[this.routeMap.nodes.length-1];this.gem.x=e.px[0],this.gem.y=e.px[1]}t.sb("onMoveFinish").dispatch(this),this.onTurn.dispatch(),this.onFinish.dispatch()}else this.setPosByDistance(this.gem,this.progress,this.routeMap)},t.BoardMoveObject.prototype.processRoute=function(t){for(var e={nodes:[],len:0},i=0;i<t.length;i++){var s={cell:t[i],px:this.board.cellToPx(t[i][0],t[i][1])},a=t[i+1];this.FALL||a!==t[t.length-1]||(s.cell[0]===a[0]?e.len-=this.board.tileWidth:e.len-=this.board.tileHeight),a&&(t[i][0]==a[0]?(s.lenToNext=Math.abs(t[i][1]-a[1])*this.board.tileWidth,s.ver=!0):(s.lenToNext=Math.abs(t[i][0]-a[0])*this.board.tileHeight,s.ver=!1),e.len+=s.lenToNext),e.nodes.push(s)}return e},t.BoardMoveObject.prototype.setPosByDistance=function(t,e,i){for(var s=0,a=0;a<i.nodes.length-1;a++){var n=i.nodes[a],o=i.nodes[a+1];if(e<s+n.lenToNext){var r=(e-s)/n.lenToNext;if(n.ver){var h=o.px[1]-n.px[1];t.x=n.px[0],t.y=n.px[1]+h*r}else{h=o.px[0]-n.px[0];t.x=n.px[0]+h*r,t.y=n.px[1]}a>0&&this.onTurn.dispatch();break}s+=n.lenToNext}},t.FadeInput=function(){Phaser.Graphics.call(this,game),this.fixedToCamera=!0,this.inputEnabled=!0,this.visible=!1,t.sb("onScreenResize").add(this.onResize,this),this.onResize(),t.sb("openOverlay").add(this.open,this),t.sb("closeOverlay").add(this.close,this),game.add.existing(this)},t.FadeInput.prototype=Object.create(Phaser.Graphics.prototype),t.FadeInput.prototype.onResize=function(){this.clear(),this.beginFill(0,.6),this.drawRect(0,0,game.width,game.height)},t.FadeInput.prototype.open=function(){t.stopTweens(this),this.visible=!0,this.alpha=0},t.FadeInput.prototype.close=function(){t.stopTweens(this),this.visible=!1},t.Gem=function(e,i,s,a){var n=e.cellToPx(i,s);t.Image.call(this,n[0],n[1],"blog_front",0,null);t.json.settings.tileSize;this.sign=t.makeImage(0,0,"sign ("+(a+1)+")",0,this),this.cellX=i,this.cellY=s,this.board=e,this.matchType=a,this.inputLocked=!1},t.Gem.prototype=Object.create(t.Image.prototype),t.RTLayer=function(e,i,s){Phaser.Group.call(this,game),this.group=i;var a=(e.grid.width+2)*e.tileWidth,n=(e.grid.height+2)*e.tileHeight;this.tileWidth=e.tileWidth,this.tileHeight=e.tileHeight,this.rt=game.make.renderTexture(a,n),this.img=game.add.image(-this.tileWidth,-this.tileHeight,this.rt),this.topLayer=s||!1,this.marker=t.makeImage(0,0,this.topLayer?null:"blog_back",0,null),this.add(this.img)},t.RTLayer.prototype=Object.create(Phaser.Group.prototype),t.RTLayer.prototype.redrawGroup=function(){this.topLayer||t.changeTexture(this.marker,"blog_back"),this.rt.clear();for(var e=0,i=this.group.length;e<i;e++){var s=this.group.children[e],a=s.x+this.tileWidth,n=s.y+this.tileHeight;this.topLayer?(t.changeTexture(this.marker,"blog_front"),this.rt.renderRawXY(this.marker,a,n),this.marker.loadTexture(s.sign.texture),this.rt.renderRawXY(this.marker,a,n)):this.rt.renderRawXY(this.marker,a+5,n-8)}},t.Text=function(e,i,s,a,n,o,r,h,l){for(a=t.Text.getStyle(a),this.userMaxWidth=o||1/0,this.userMaxHeight=r||1/0,h&&(a.wordWrap=!0,a.wordWrapWidth=o,a.align=l||"left"),Phaser.Text.call(this,game,e,i,s,a),a.lineSpacing&&(this.lineSpacing=a.lineSpacing),a.shadow&&(this.setShadow.apply(this,a.shadow),this.padding.setTo(a.shadow[0],a.shadow[1])),n&&("number"==typeof n?this.anchor.setTo(n):this.anchor.setTo(n[0],n[1]));(this.width>this.userMaxWidth||this.height>this.userMaxHeight)&&(this.fontSize-=2,!(this.fontSize<10)););},t.Text.prototype=Object.create(Phaser.Text.prototype),t.Text.styles={},t.Text.addStyle=function(e,i){t.Text.styles[e]=i},t.Text.getStyle=function(e){var i;if("object"!=typeof e)i=JSON.parse(JSON.stringify(t.Text.styles[e]));else if(e.style||e.fontStyle){e.style=e.fontStyle||e.style;var s=JSON.parse(JSON.stringify(t.Text.styles[e.style]));if(e.scaleStroke&&e.fontSize&&s.fontSize&&s.strokeThickness){var a=s.strokeThickness/parseInt(s.fontSize);e.strokeThickness=Math.ceil(parseInt(e.fontSize)*a)}i=Object.assign(s,e)}else i=e;return"vi"!==t.lang&&"tr"!==t.lang&&"ja"!==t.lang||"Lobster"!==i.font||(delete i.font,i.fontWeight="bold"),i},t.Text.prototype.setText=function(t){Phaser.Text.prototype.setText.call(this,t),this.scale.setTo(1),this.width=Math.min(this.width,this.userMaxWidth),this.height=Math.min(this.height,this.userMaxHeight)},t.Text.prototype.setStyle=function(e,i){e=t.Text.getStyle(e),Phaser.Text.prototype.setStyle.call(this,e,i)},t.TextCounter=function(e,i,s,a,n,o,r){this.amount=s,this.amountDisplayed=s,t.Text.call(this,e,i,null===s?"...":s.toString(),a,n,o),r=r||{lerpValue:.5},this.lerp=!0,this.lerpValue=r.lerpValue,this.stepCurrent=0,this.step=0},t.TextCounter.prototype=Object.create(t.Text.prototype),t.TextCounter.prototype.setAmount=function(t,e){this.amount=t,e&&(this.amountDisplayed=t,this.setText(this.amountDisplayed.toString()))},t.TextCounter.prototype.changeAmount=function(t,e){this.amount+=t,e&&(this.amountDisplayed=this.amount,this.setText(this.amountDisplayed.toString()))},t.TextCounter.prototype.increaseAmount=function(t,e){this.changeAmount(t)},t.TextCounter.prototype.update=function(){this.amountDisplayed!=this.amount&&this.stepCurrent--<=0&&(this.stepCurrent=this.step,this.lerp&&this.lerpUpdate())},t.TextCounter.prototype.lerpUpdate=function(){this.amountDisplayed=t.lerp(this.amountDisplayed,this.amount,this.lerpValue,.2),this.setText(Math.round(this.amountDisplayed).toString())},"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),s=1;s<arguments.length;s++){var a=arguments[s];if(null!=a)for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(i[n]=a[n])}return i},writable:!0,configurable:!0}),Phaser.Text.prototype.updateText=function(){this.texture.baseTexture.resolution=this._res,this.context.font=this.style.font;var t=this.text;this.characterLimitSize>-1&&this.characterLimitSize<t.length&&(t=this.text.substring(0,this.characterLimitSize)+this.characterLimitSuffix),this.style.wordWrap&&(t=this.runWordWrap(this.text));var e=t.split(this.splitRegExp),i=this.style.tabs,s=[],a=0,n=this.determineFontProperties(this.style.font),o=e.length;this.style.maxLines>0&&this.style.maxLines<e.length&&(o=this.style.maxLines),this._charCount=0;for(var r=0;r<o;r++){if(0===i){var h=this.style.strokeThickness+this.padding.x;this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?h+=this.measureLine(e[r]):h+=this.context.measureText(e[r]).width,this.style.wordWrap&&(h-=this.context.measureText(" ").width)}else{var l=e[r].split(/(?:\t)/);h=this.padding.x+this.style.strokeThickness;if(Array.isArray(i))for(var c=0,d=0;d<l.length;d++){var p=0;p=this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?this.measureLine(l[d]):Math.ceil(this.context.measureText(l[d]).width),d>0&&(c+=i[d-1]),h=c+p}else for(d=0;d<l.length;d++){this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?h+=this.measureLine(l[d]):h+=Math.ceil(this.context.measureText(l[d]).width),h+=this.game.math.snapToCeil(h,i)-h}}s[r]=Math.ceil(h),a=Math.max(a,s[r])}this.canvas.width=a*this._res,this.canvas.width%2==1&&(this.canvas.width=this.canvas.width+1);var u,g,f=n.fontSize+this.style.strokeThickness+this.padding.y,m=f*o,y=this._lineSpacing;for(y<0&&Math.abs(y)>f&&(y=-f),0!==y&&(m+=y>0?y*e.length:y*(e.length-1)),this.canvas.height=m*this._res,this.canvas.height%2==1&&(this.canvas.height=this.canvas.height+1),this.context.scale(this._res,this._res),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.style.backgroundColor&&(this.context.fillStyle=this.style.backgroundColor,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.textBaseline="alphabetic",this.context.lineWidth=this.style.strokeThickness,this.context.lineCap="round",this.context.lineJoin="round",this._charCount=0,r=0;r<o;r++)u=this.style.strokeThickness/2,g=this.style.strokeThickness/2+r*f+n.ascent,r>0&&(g+=y*r),"right"===this.style.align?u+=a-s[r]:"center"===this.style.align&&(u+=(a-s[r])/2),this.autoRound&&(u=Math.round(u),g=Math.round(g)),this.colors.length>0||this.strokeColors.length>0||this.fontWeights.length>0||this.fontStyles.length>0?this.updateLine(e[r],u,g):(this.style.stroke&&this.style.strokeThickness&&(this.updateShadow(this.style.shadowStroke),0===i?this.context.strokeText(e[r],u,g):this.renderTabLine(e[r],u,g,!1)),this.style.fill&&(this.updateShadow(this.style.shadowFill),0===i?this.context.fillText(e[r],u,g):this.renderTabLine(e[r],u,g,!0)));this.updateTexture(),this.dirty=!1},t.AdPopUp=function(){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.state=game.state.getCurrentState(),this.state.pauseWindow=this,this.bg=new t.PopUpBackground,this.add(this.bg),this.watchAdTxt=new t.Text(0,-100,t.txt("Watch a video"),{style:"ribbon",fontSize:50},.5),this.add(this.watchAdTxt),this.hintAmount=new t.Text(0,-10,"+"+t.json.settings.hintsForAd,{style:"ribbon",fontSize:70},.5),this.add(this.hintAmount),this.hintImg=t.makeImage(0,-10,"button_hint_2",.5,this),this.hintImg.scale.setTo(1.4),t.centerElements2([this.hintAmount,this.hintImg],10),this.showAdBtn=new t.Button(0,100,"play_button",this.showAd,this),this.showAdBtn.addTextLabel("regular",t.txt("Continue"),50),this.showAdBtn.label.y=-2,this.add(this.showAdBtn),this.closeBtn=new t.Button(0,103,"button_back",this.close,this),this.add(this.closeBtn),t.centerElements2([this.closeBtn,this.showAdBtn],0),game.add.tween(this).from({alpha:0},300,Phaser.Easing.Sinusoidal.In,!0),this.resizeBinding=t.sb("onScreenResize").add(this.onResize,this),this.onDestroy.add((function(){this.resizeBinding.detach()}),this),this.onResize(),t.sb("onPause").dispatch()},t.AdPopUp.prototype=Object.create(Phaser.Group.prototype),t.AdPopUp.prototype.showAd=function(){game.paused=!0,sdkHandler.trigger("rewardedAd",{callback:function(e){game.paused=!1,e&&(t.saveState.addHints(t.json.settings.hintsForAd),t.sb("onHintAdded").dispatch()),this.showSecondScreen(e)}},this)},t.AdPopUp.prototype.hideFirstScreen=function(){this.showAdBtn.inputEnabled=!1,this.showAdBtn.update=function(){},this.closeBtn.inputEnabled=!0,this.closeBtn.update=function(){},game.add.tween(this.showAdBtn).to({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0),game.add.tween(this.closeBtn).to({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0),game.add.tween(this.watchAdTxt).to({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0),game.add.tween(this.hintAmount).to({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0),game.add.tween(this.hintImg).to({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0)},t.AdPopUp.prototype.showSecondScreen=function(e){this.hideFirstScreen(),this.msg=new t.Text(0,-60,e?t.txt("Thanks for watching!"):t.txt("Something went wrong! Please, try again."),{style:"ribbon",fontSize:60,lineSpacing:-15},.5,.9*game.width,200,!0,"center"),this.add(this.msg),game.add.tween(this.msg).from({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0),this.continueBtn=new t.Button(0,100,"play_button",this.close,this),this.continueBtn.addTextLabel("regular",t.txt("Continue"),50),this.continueBtn.label.y=-2,this.add(this.continueBtn),game.add.tween(this.continueBtn).from({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0)},t.AdPopUp.prototype.onResize=function(){this.cameraOffset.x=.5*game.width,this.cameraOffset.y=.5*game.height,this.bg.onResize()},t.AdPopUp.prototype.close=function(){this.ignoreChildInput=!0,t.sb("onUnpause").dispatch(),game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.In,!0).onComplete.add((function(){this.destroy(),this.state.pauseWindow=null}),this)},t.Background=function(){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.bg=t.makeImage(0,0,game.device.desktop?"bg_h":"bg_v",0,this),t.sb("onScreenResize").add(this.onResize,this),this.onResize()},t.Background.prototype=Object.create(Phaser.Group.prototype),t.Background.prototype.onResize=function(){game.width/game.height<1.65?this.bg=t.makeImage(0,0,"bg_v",0,this):this.bg=t.makeImage(0,0,"bg_h",0,this),this.bg.width=game.width,this.bg.height=game.height},void 0===t&&(t={}),t.Button=function(e,i,s,a,n){Phaser.Button.call(this,game,t.l(e),t.l(i),null),this.state=game.state.getCurrentState(),t.changeTexture(this,s),this.anchor.setTo(.5),this.sfx=t.sfx.btn_pressed,this.active=!0,this.onClick=new Phaser.Signal,a&&this.onClick.add(a,n||this),this.onInputDown.add(this.click,this),this.terms=[],this.IMMEDIATE=!1,this.scaleOnClick=!0,this.targetAlphaTermsNotFulfilled=.5,this.targetAlpha=1,this.pulsing=!1},t.Button.prototype=Object.create(Phaser.Button.prototype),t.Button.constructor=t.Button,t.Button.prototype.update=function(){this.checkTerms()?this.targetAlpha=1:this.targetAlpha=this.targetAlphaTermsNotFulfilled,this.alpha=t.lerp(this.alpha,this.targetAlpha,.2,.05),this.updateChildren()},t.Button.prototype.pulse=function(t){this.pulsing=!0,this.pulsingTween=game.add.tween(this.scale).to({x:t||1.1,y:t||1.1},500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},t.Button.prototype.stopPulse=function(t){this.pulsingTween&&this.pulsingTween.stop(),this.scale.setTo(t||1),this.pulsing=!1},t.Button.prototype.click=function(){if(this.active&&this.checkTerms()){this.active=!1,this.onClick.dispatch(),this.sfx.play();var t=this.scale.x,e=this.scale.y;this.IMMEDIATE?this.active=!0:this.pulsing||!this.scaleOnClick?game.time.events.add(400,(function(){this.active=!0}),this):game.add.tween(this.scale).to({x:t+.1,y:e+.1},200,Phaser.Easing.Quadratic.Out,!0).onComplete.add((function(){game.add.tween(this.scale).to({x:t,y:e},200,Phaser.Easing.Quadratic.Out,!0).onComplete.add((function(){this.active=!0}),this)}),this)}},t.Button.prototype.checkTerms=function(){for(var t=0;t<this.terms.length;t++)if(!this.terms[t][0].call(this.terms[t][1]))return!1;return!0},t.Button.prototype.addTerm=function(t,e){this.terms.push([t,e])},t.Button.prototype.addImageLabel=function(t){this.label=game.make.image(0,0,"ssheet",t),this.label.anchor.setTo(.5),this.addChild(this.label)},t.Button.prototype.addTextLabel=function(e,i,s){var a=1/t.Loader.currentConfigMulti;this.label=new t.Text(0,-6,i,{style:e,fontSize:s||Math.floor(this.height*a*.7)},.5,.9*this.width),this.addChild(this.label)},t.Button.prototype.addTextLabelMultiline=function(e,i){var s=1/t.Loader.currentConfigMulti;this.label=new t.MultiLineText(0,0,e,i,Math.floor(this.height*s*.5),this.width*s*.8,this.height*s*.7,"center",.5,.5),this.addChild(this.label)},t.Button.prototype.stopTweens=function(){t.stopTweens(this)},t.Button.prototype.changeTexture=function(e){t.changeTexture(this,e)},t.Button.prototype.add=function(t){return this.addChild(t)},t.Button.prototype.updateChildren=function(){for(var t=this.children.length;t--;)this.children[t].update()},t.ComboUI=function(){t.Text.call(this,0,0," ",{style:"endGameTexts",fill:"#f8f8f8",stroke:"#0380c1",fontSize:50},.5),this.padding.x=6,this.padding.y=6,this.setShadow(4,6,"rgba(0,0,0,0.2)",6),this.fixedToCamera=!0,this.timeDisappearEvent=null,t.sb("onComboIncreased").add(this.showCombo,this),t.sb("onScreenResize").add(this.onResize,this),this.onResize(),this.comboSounds=[t.sfx.combo_01,t.sfx.combo_02,t.sfx.combo_03,t.sfx.combo_04,t.sfx.combo_05,t.sfx.combo_06,t.sfx.combo_07,t.sfx.combo_08,t.sfx.combo_09],this.comboSoundIndex=0,game.add.existing(this)},t.ComboUI.prototype=Object.create(t.Text.prototype),t.ComboUI.prototype.onResize=function(){this.cameraOffset.x=Math.floor(.5*game.width),this.cameraOffset.y=40},t.ComboUI.prototype.showCombo=function(e){var i=(e-2)%this.comboSounds.length;this.comboSounds[i].play(),t.stopTweens(this),t.stopTweens(this.anchor),this.timeDisappearEvent&&game.time.events.remove(this.timeDisappearEvent),this.alpha=1,this.anchor.setTo(.5),this.setText(t.txt("Combo")+" x"+e),this.scale.setTo(0),game.add.tween(this.scale).to({x:1,y:1},300,Phaser.Easing.Cubic.Out,!0),this.timeDisappearEvent=game.time.events.add(t.json.settings.comboTime,(function(){game.add.tween(this).to({alpha:0},500,Phaser.Easing.Sinusoidal.Out,!0),game.add.tween(this.anchor).to({y:1.5},500,Phaser.Easing.Sinusoidal.Out,!0)}),this)},t.FxLayer=function(e){t.PoolGroup.call(this,t.FxPart,null,"fx",20),this.position=e.position,this.scale=e.scale,t.sb("onMatch").add(this.onMatch,this)},t.FxLayer.prototype=Object.create(t.PoolGroup.prototype),t.FxLayer.prototype.onMatch=function(e,i){t.sb("fx").dispatch("gem",e);for(var s=0;s<5;s++)t.sb("fx").dispatch("star",e);t.sb("fx").dispatch("gem",i);for(s=0;s<5;s++)t.sb("fx").dispatch("star",i)},t.FxPart=function(){t.Image.call(this,0,0,null,.5,null),this.kill()},t.FxPart.prototype=Object.create(t.Image.prototype),t.FxPart.prototype.emptyUpdate=function(){},t.FxPart.prototype.reset=function(t){this.x=t.position?t.position.x:t.x,this.y=t.position?t.position.y:t.y,this.anchor.setTo(.5),this.scale.setTo(1),this.alpha=1,this.angle=0,this.blendMode=0,this.changeTexture(null),this.update=this.emptyUpdate,this.revive()},t.FxPart.prototype.init=function(t,e){this.reset(e),this[t]&&this[t].apply(this,arguments)},t.FxPart.prototype.gem=function(e,i,s,a){this.alpha=.7,this.x+=27,this.y+=33,t.changeTexture(this,"gem_tile_light"),game.add.tween(this.scale).to({x:1.5,y:1.5},350,Phaser.Easing.Cubic.Out,!0),game.add.tween(this).to({alpha:0},350,Phaser.Easing.Cubic.Out,!0).onComplete.add(this.kill,this)},t.FxPart.prototype.star=function(e,i){t.changeTexture(this,"starPart"),this.x+=54*Math.random(),this.y+=67*Math.random(),this.angle=360*Math.random(),this.velX=game.rnd.realInRange(-3,3),this.velY=game.rnd.realInRange(-3,-8),this.grav=.4,this.update=this.starUpdate},t.FxPart.prototype.starUpdate=function(){this.x+=this.velX,this.y+=this.velY,this.velX*=.99,this.velY+=this.grav,this.angle+=this.velX,this.velY>0&&(this.alpha-=.03,this.alpha<=0&&this.kill())},t.FxPartFW=function(){t.Image.call(this)},t.FxPartFW.prototype=Object.create(t.Image.prototype),t.FxPartFW.prototype.emptyUpdate=function(){},t.FxPartFW.prototype.reset=function(t){this.x=t.x,this.y=t.y,this.anchor.setTo(.5),this.scale.setTo(1),this.alpha=1,this.angle=0,this.blendMode=0,this.changeTexture(null),this.update=this.emptyUpdate,this.revive()},t.FxPartFW.prototype.init=function(t,e){this.reset(e),this[t]&&this[t].apply(this,arguments)},t.FxPartFW.prototype.dust=function(){t.changeTexture(this,"dust_part"),this.angle=game.rnd.between(0,360),game.add.tween(this).to({width:2*this.width,height:2*this.height,alpha:0},500,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add(this.kill,this)},t.FxPartFW.prototype.dustBig=function(){this.alpha=.4,this.scale.setTo(1),t.changeTexture(this,"dust_part"),this.angle=game.rnd.between(0,360),game.add.tween(this).to({x:this.x+50,width:4*this.width,height:4*this.height,alpha:0},1e3,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add(this.kill,this)},t.FxPartFW.prototype.firework=function(e,i){t.changeTexture(this,"firework_part_"+i.color),this.blendMode=1;var s=i.spd||4,a=i.angle||game.rnd.between(0,360);this.velX=t.lengthDirX(a,s,!1),this.velY=t.lengthDirY(a,s,!1),this.timer=i.timer||20,this.timer+=game.rnd.between(0,4),this.grav=.05,this.scaleDelta=game.rnd.realInRange(-.02,.005),this.update=this.fireworkUpdate},t.FxPartFW.prototype.fireworkUpdate=function(){this.x+=this.velX,this.y+=this.velY,this.scale.setTo(this.scale.x+this.scaleDelta),this.velX*=.95,this.velY*=.95,this.velY+=this.grav,this.timer--<0&&(this.alpha-=.02,this.alpha<=0&&this.kill())},t.GameOverWindow=function(e,i){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.state=game.state.getCurrentState(),this.state.pauseWindow=this,this.bg=new t.PopUpBackground,this.add(this.bg),this.points=e,this.level=t.saveState.data.progress[1]||0,this.gameCompleted=i,this.gameOverRibbon=t.makeImage(-190,-70,"ribbon",.5,this),this.gameOverTxt=new t.Text(-190,-70,t.txt("Game over"),{style:"ribbon",fontSize:35},.5,280),this.add(this.gameOverTxt),this.scoreRibbon=t.makeImage(190,-70,"ribbon",.5,this),this.scoreTxt=new t.Text(190,-70,t.txt("Score")+": "+e,{style:"ribbon",fontSize:35},.5,280),this.scoreTxt.addColor("#ffffff",(t.txt("Score")+": ").length),this.add(this.scoreTxt),this.restartBtn=new t.Button(0,70,"play_button",this.restart,this),this.restartBtn.addTextLabel("regular",t.txt("Restart"),50),this.restartBtn.label.y=-2,this.restartBtn.label.fill="#EEEEEE",this.add(this.restartBtn),game.add.tween(this).from({alpha:0},300,Phaser.Easing.Sinusoidal.In,!0),t.sb("onScreenResize").add(this.onResize,this),this.onResize(),t.sb("onPause").dispatch(),t.saveState.resetProgress()},t.GameOverWindow.prototype=Object.create(Phaser.Group.prototype),t.GameOverWindow.prototype.onResize=function(){this.cameraOffset.x=.5*game.width,this.cameraOffset.y=.5*game.height,this.bg.onResize()},t.GameOverWindow.prototype.close=function(){},t.GameOverWindow.prototype.restart=function(){sdkHandler.trigger("levelFinish",{level:this.state.lvlNr+1,score:this.level,state:"lose"},this),sdkHandler.trigger("interstitialAd",{callback:function(){t.saveState.resetProgress(),this.ignoreChildInput=!0,game.camera.fade(0,300,!0),game.camera.onFadeComplete.add((function(){game.state.start("MainMenu")}))}},this)},t.gameTracking={sink:function(t,e,i,s){try{sdkHandler.trigger("gameTracking",{event:"Sink",dimension1:t?t.toString():void 0,dimension2:e?e.toString():void 0,dimension3:i?i.toString():void 0,value:s||1})}catch(t){}},source:function(t,e,i,s){try{sdkHandler.trigger("gameTracking",{event:"Source",dimension1:t?t.toString():void 0,dimension2:e?e.toString():void 0,dimension3:i?i.toString():void 0,value:s||1})}catch(t){}},start:function(t,e,i,s){try{sdkHandler.trigger("gameTracking",{event:"Start",dimension1:t?t.toString():void 0,dimension2:e?e.toString():void 0,dimension3:i?i.toString():void 0,value:s})}catch(t){}},fail:function(t,e,i,s){try{sdkHandler.trigger("gameTracking",{event:"Fail",dimension1:t?t.toString():void 0,dimension2:e?e.toString():void 0,dimension3:i?i.toString():void 0,value:s})}catch(t){}},complete:function(t,e,i,s){try{sdkHandler.trigger("gameTracking",{event:"Complete",dimension1:t?t.toString():void 0,dimension2:e?e.toString():void 0,dimension3:i?i.toString():void 0,value:s})}catch(t){}},design:function(t,e){try{sdkHandler.trigger("gameTracking",{event:"Design",dimension1:t?t.toString():void 0,value:e})}catch(t){}},init:function(){this.onInitFinished=new Phaser.Signal,sdkHandler.trigger("restore",{key:"ftueEventsData",callback:function(t,e){if(!t){try{this.ftueData=null===e||e=={}?{}:JSON.parse(e)}catch(t){this.ftueData={}}this.initialized=!0,this.onInitFinished.dispatch()}}},this)},FTUEDesign:function(t,e){this.initialized?this._FTUEDesign(t,e):this.onInitFinished.addOnce((function(){this._FTUEDesign(t,e)}),this)},_FTUEDesign:function(t,e){this.ftueData[t]||(this.ftueData[t]=!0,this.design(t,e),sdkHandler.trigger("save",{key:"ftueEventsData",value:JSON.stringify(this.ftueData),callback:function(){}}))},checkFTUE:function(t){return this.ftueData[t]}},t.ga={event:function(){}},t.GameUI=function(){Phaser.Group.call(this,game),this.state=game.state.getCurrentState(),this.bgExt=t.makeImage(0,800,"bg_hud_ext",0,this),this.bg=t.makeImage(0,0,"bg_hud",0,this),this.levelTxt=new t.OneLineText(15,185,"font",t.txt(19).toUpperCase()+":",20,100,0,1),this.levelTxt.tint=13345819,this.levelTxt.updateCache(),this.add(this.levelTxt),this.levelNr=new t.OneLineText(75,210,"font",this.state.lvlNr+1+"/"+t.json.levels.length,28,150,.5,.5),this.add(this.levelNr),"ar"==t.lang&&(this.levelNr.y=215),this.timeTxt=new t.OneLineText(15,378,"font",t.txt(20).toUpperCase()+":",20,150,0,1),this.timeTxt.tint=13345819,this.timeTxt.updateCache(),this.add(this.timeTxt),this.timeController=new t.TimeController(15,380),this.add(this.timeController),this.scoreTxt=new t.OneLineText(15,276,"font",t.txt(5).toUpperCase()+":",20,100,0,1),this.scoreTxt.tint=13345819,this.scoreTxt.updateCache(),this.add(this.scoreTxt),this.pointController=new t.PointController(75,302),this.add(this.pointController),t.sb("onScreenResize").add(this.onResize,this),this.onResize()},t.GameUI.prototype=Object.create(Phaser.Group.prototype),t.GameUI.prototype.onResize=function(){this.bgExt.height=Math.max(192,game.height-800)},t.GemFlying=function(e,i,s,a){t.Image.call(this,e,i,"blog_spin_00",0);var n=t.json.settings.tileSize;this.sign=t.makeImage(2+.5*n[0],12+.5*n[1],"sign ("+(s+1)+")",.5,this),this.rotating=!1,this.rotationPos=0,this.lastPos=0,this.scale.setTo(a||1)},t.GemFlying.prototype=Object.create(t.Image.prototype),t.GemFlying.prototype.update=function(){if(this.rotating){var t=Math.floor(this.rotationPos);t!==this.lastPos&&this.changeSpriteRotPos(t)}},t.GemFlying.prototype.changeSpriteRotPos=function(e){12==e&&(e=0),t.changeTexture(this,"blog_spin_"+(1==e.toString().length?"0"+e:e)),this.sign.visible=0==e,this.lastPos=e},t.GemFlying.prototype.rotateTo=function(t,e){this.rotating=!0,game.add.tween(this).to({rotationPos:t},e||200,Phaser.Easing.Linear.None,!0).onComplete.add((function(){this.rotating=!1,this.changeSpriteRotPos(t)}),this)},t.GemFlying.prototype.rotateTo180=function(){this.rotateTo(6)},t.GemFlying.prototype.rotateTo360=function(){this.rotateTo(12)},t.GemFlying.prototype.flyTo=function(t,e,i){this.rotateTo180(),game.add.tween(this.scale).to({x:1.25,y:1.25},500,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add((function(){game.add.tween(this.scale).to({x:1.1,y:1.1},500,Phaser.Easing.Sinusoidal.In,!0)}),this),game.add.tween(this).to({y:e},1e3,Phaser.Easing.Sinusoidal.InOut,!0);var s=i||Math.sign(this.x-t)||game.rnd.pick([1,-1]),a=100*s;Math.sign(this.x-t)!==s&&(a=(Math.abs(this.x-t)+100)*s),game.add.tween(this).to({x:this.x+a},500,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add((function(){game.add.tween(this).to({x:t},500,Phaser.Easing.Sinusoidal.InOut,!0).onComplete.add((function(){game.time.events.add(300,(function(){game.add.tween(this).to({y:this.y+200,alpha:0},500,Phaser.Easing.Sinusoidal.In,!0).onComplete.add((function(){this.destroy()}),this)}),this)}),this),game.time.events.add(200,this.rotateTo360,this)}),this)},t.HintBtn=function(){t.Button.call(this,0,0,game.device.desktop?"button_hint_2":"button_hint",this.onClick,this),this.targetAlphaTermsNotFulfilled=1,this.state=game.state.getCurrentState(),this.counter=t.makeImage(38,-33,"bg_number_booster",.5,this),this.counter.text=new t.Text(0,2," ",{style:"regular",fontSize:30},.5,50),this.counter.text.fill="#EEEEEE",this.counter.addChild(this.counter.text),this.updateHintNumber(),this.addTerm((function(){return(t.saveState.getHintsAmount()>0||game.incentivised)&&0==this.state.board.moves.length&&!this.state.board.EMPTY&&!this.state.pause&&!this.state.pauseWindow}),this),t.sb("onScreenResize").add(this.onResize,this),this.onResize(),t.sb("onBoardEmpty").add(this.hide,this),t.sb("onTimesUp").add(this.hide,this),t.sb("onHintAdded").add(this.updateHintNumber,this),game.add.tween(this).from({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0),game.add.existing(this)},t.HintBtn.prototype=Object.create(t.Button.prototype),t.HintBtn.prototype.hide=function(){this.inputEnabled=!1,this.update=function(){},game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0)},t.HintBtn.prototype.updateHintNumber=function(){var e=t.saveState.getHintsAmount();this.counter.text.setText(e.toString()),0==e&&game.incentivised?(this.counter.text.visible=!1,t.changeTexture(this.counter,"plus")):(this.counter.text.visible=!0,t.changeTexture(this.counter,"bg_number_booster"))},t.HintBtn.prototype.onClick=function(){if(0===t.saveState.getHintsAmount())return this.adFlow();t.saveState.useHint(),t.sb("onHint").dispatch(),this.updateHintNumber()},t.HintBtn.prototype.adFlow=function(){new t.AdPopUp},t.HintBtn.prototype.onResize=function(){game.device.desktop?(this.x=Math.floor(.5*game.width)+490,this.y=game.height-35):(this.x=game.width-80,this.y=game.height-60)},t.LabelValue=function(e,i,s,a,n,o){Phaser.Group.call(this,game),this.position.setTo(e,i),this.label=new t.OneLineText(0,0,"font",s,n,350,0,0),this.label.tint=13345819,this.label.updateCache(),this.add(this.label),this.value=new t.OneLineText(0,0,"font",a,n,350,0,0),this.add(this.value),this.center(this.label,this.value,o)},t.LabelValue.prototype=Object.create(Phaser.Group.prototype),t.LabelValue.prototype.center=function(t,e,i){var s=-.5*(t.width+i+e.width);t.left=s,e.left=t.right+i},t.LevelCompleteTxt=function(e){Phaser.Group.call(this,game),this.txt=this.add(new t.Text(0,0,e.toUpperCase(),{fontSize:80,style:"endGameTexts",fill:"#f8f8f8",stroke:"#0380c1"},.5,600)),this.state=game.state.getCurrentState(),this.board=this.state.board,this.x=this.board.x+Math.floor(this.board.grid.width*this.board.tileWidth*.5),this.y=this.board.y+Math.floor((this.board.grid.height-1)*this.board.tileHeight*.5),game.add.existing(this)},t.LevelCompleteTxt.prototype=Object.create(Phaser.Group.prototype),t.LevelCompleteTxt.prototype.update=function(){this.x=this.board.x+Math.floor(this.board.grid.width*this.board.tileWidth*.5),this.y=this.board.y+Math.floor((this.board.grid.height-1)*this.board.tileHeight*.5)},t.LevelCompleteTxt.prototype.hide=function(){game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.In,!0)},t.LoadingBar=function(e,i){Phaser.Group.call(this,game),this.rX=e,this.rY=i,this.barBg=t.makeImage(-257,0,"loading_bar_empty_2",0,this),this.barFull=t.makeImage(-257,0,"loading_bar_full_2",0,this),game.load.setPreloadSprite(this.barFull),t.sb("onScreenResize").add(this.onResize,this),this.onResize()},t.LoadingBar.prototype=Object.create(Phaser.Group.prototype),t.LoadingBar.prototype.onResize=function(){this.x=Math.floor(game.width*this.rX),this.y=Math.floor(game.height*this.rY)},t.Logo=function(e,i,s){t.Image.call(this,e,i,"ja"===t.lang?"logo_ja":"logo",.5),s&&this.setRelPos(e,i),t.sb("onScreenResize").add(this.onResize,this)},t.Logo.prototype=Object.create(t.Image.prototype),t.Logo.prototype.onResize=function(){this.relPos&&(this.x=Math.floor(game.width*this.relPos.x),this.y=Math.floor(game.height*this.relPos.y))},t.Logo.prototype.setRelPos=function(t,e){this.relPos={x:t,y:e},this.onResize()},t.MainMenuBgGems=function(){Phaser.Group.call(this,game);for(var e=[[.22,.11],[.06,.24],[.11,.7],[.28,.9],[.38,.59],[.69,.08],[.68,.4],[.92,.32],[.85,.78]],i=0;i<e.length;i++)this.add(new t.MainMenuBgGem(e[i]));t.sb("onScreenResize").add(this.onResize,this),this.onResize()},t.MainMenuBgGems.prototype=Object.create(Phaser.Group.prototype),t.MainMenuBgGems.prototype.onResize=function(){this.children.forEach((function(t){t.onResize()}))},t.MainMenuBgGem=function(e){this.px=e[0],this.py=e[1],t.Image.call(this,this.px*game.width,this.py*game.height,"gem_test_border_s",0),this.bottom=t.makeImage(0,0,"gem_"+game.rnd.between(0,41),0,this),this.angle=game.rnd.between(0,360),this.scale.setTo(1.5),this.onResize()},t.MainMenuBgGem.prototype=Object.create(t.Image.prototype),t.MainMenuBgGem.prototype.onResize=function(){this.x=Math.floor(this.px*game.width),this.y=Math.floor(this.py*game.height)},t.MainMenuGroup=function(){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.logo=t.makeImage(0,-90,"ja"===t.lang?"logo_ja":"logo",.5,this),this.playBtn=new t.Button(0,230,"button_green",(function(){this.ignoreChildInput=!0,game.camera.fade(0,500,!0),game.camera.onFadeComplete.addOnce((function(){game.state.start("Game")}))}),this),this.playBtn.addTextLabel("font",t.txt(0).toUpperCase(),50),this.playBtn.label.y=-12,this.add(this.playBtn),this.highscore=new t.LabelValue(0,305,t.txt(1).toUpperCase(),t.saveState.data.highscore.toString(),45,70),this.add(this.highscore),t.sb("onScreenResize").add(this.onResize,this),this.onResize()},t.MainMenuGroup.prototype=Object.create(Phaser.Group.prototype),t.MainMenuGroup.prototype.onResize=function(){this.cameraOffset.x=.5*game.width,this.cameraOffset.y=.5*game.height,this.logo.scale.setTo(1);var t=game.width/this.logo.width;this.logo.scale.setTo(Math.min(t,1))},t.MainMenuPlayButton=function(e,i,s){t.Button.call(this,e,i,"play_button",(function(){sdkHandler.trigger("interstitialAd",{callback:function(){game.state.start("Game")}},this)}),this),this.label=this.addChild(new t.Text(0,0,t.txt("Play"),{style:"regular",fill:"#EEEEEE",fontSize:50},.5,440)),s&&this.setRelPos(e,i),t.sb("onScreenResize").add(this.onResize,this),game.add.existing(this)},t.MainMenuPlayButton.prototype=Object.create(t.Button.prototype),t.MainMenuPlayButton.prototype.onResize=function(){this.relPos&&(this.x=Math.floor(game.width*this.relPos.x),this.y=Math.floor(game.height*this.relPos.y))},t.MainMenuPlayButton.prototype.setRelPos=function(t,e){this.relPos={x:t,y:e},this.onResize()},t.MenuBtn=function(){t.Button.call(this,0,0,game.device.desktop?"button_brake_2":"button_brake",this.onClick,this),this.state=game.state.getCurrentState(),t.sb("onScreenResize").add(this.onResize,this),this.onResize(),t.sb("onBoardEmpty").add(this.hide,this),t.sb("onTimesUp").add(this.hide,this),game.add.tween(this).from({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0),game.add.existing(this)},t.MenuBtn.prototype=Object.create(t.Button.prototype),t.MenuBtn.prototype.hide=function(){this.inputEnabled=!1,this.update=function(){},game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0)},t.MenuBtn.prototype.onClick=function(){this.state.pauseWindow?this.state.pauseWindow.close():new t.PauseWindow},t.MenuBtn.prototype.onResize=function(){game.device.desktop?(this.x=Math.floor(.5*game.width)+420,this.y=game.height-35):(this.x=65,this.y=game.height-60)},t.PauseNotificator=function(){Phaser.Group.call(this,game),this.pauseShadowTxt=new t.OneLineText(-5,-2,"font","Pause",90,500,.5,.5),this.pauseShadowTxt.tint=0,this.pauseShadowTxt.updateCache(),this.add(this.pauseShadowTxt),game.add.tween(this.pauseShadowTxt).to({x:5},8e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),game.add.tween(this.pauseShadowTxt).to({y:8},8e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.pauseTxt=new t.OneLineText(0,0,"font","Pause",90,500,.5,.5),this.add(this.pauseTxt),this.pauseTxt.angle=-5,game.add.tween(this.pauseTxt).to({angle:5},8e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.alpha=0,t.sb("onScreenResize").add(this.onResize,this),t.sb("onPause").add(this.show,this),t.sb("onUnpause").add(this.hide,this)},t.PauseNotificator.prototype=Object.create(Phaser.Group.prototype),t.PauseNotificator.prototype.update=function(){this.pauseShadowTxt.angle=this.pauseTxt.angle},t.PauseNotificator.prototype.onResize=function(){this.x=.5*game.width,this.y=.4*game.height},t.PauseNotificator.prototype.show=function(){t.stopTweens(this),game.add.tween(this).to({alpha:1},300,Phaser.Easing.Sinusoidal.Out,!0)},t.PauseNotificator.prototype.hide=function(){t.stopTweens(this),game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0)},t.PauseWindow=function(){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.state=game.state.getCurrentState(),this.state.pauseWindow=this,this.bg=new t.PopUpBackground,this.add(this.bg),this.ribbon=t.makeImage(0,-100,"ribbon",.5,this),this.pauseTxt=new t.Text(0,-100,t.txt("Pause"),{style:"ribbon",fontSize:40},.5,280),this.add(this.pauseTxt),game.add.tween(this).from({alpha:0},300,Phaser.Easing.Sinusoidal.In,!0),this.restartBtn=new t.Button(0,100,"play_button",this.restart,this),this.restartBtn.addTextLabel("regular",t.txt("Restart"),50),this.restartBtn.label.y=-2,this.restartBtn.label.fill="#EEEEEE",this.add(this.restartBtn),this.continueBtn=new t.Button(0,10,"play_button",this.close,this),this.continueBtn.addTextLabel("regular",t.txt("Resume"),50),this.continueBtn.label.y=-2,this.continueBtn.label.fill="#EEEEEE",this.add(this.continueBtn),game.device.desktop||(this.soundBtn=new t.SoundBtn,this.add(this.soundBtn)),this.resizeBinding=t.sb("onScreenResize").add(this.onResize,this),this.onDestroy.add((function(){this.resizeBinding&&this.resizeBinding.detach()}),this),this.onResize(),t.sb("onPause").dispatch(),t.sfx.music.pause()},t.PauseWindow.prototype=Object.create(Phaser.Group.prototype),t.PauseWindow.prototype.onResize=function(){this.cameraOffset.x=.5*game.width,this.cameraOffset.y=.5*game.height,this.bg.onResize(),this.soundBtn&&(this.soundBtn.x=.5*game.width-55,this.soundBtn.y=-95)},t.PauseWindow.prototype.close=function(){sdkHandler.trigger("interstitialAd",{callback:function(){t.sfx.music.resume(),this.ignoreChildInput=!0,t.sb("onUnpause").dispatch(),game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.In,!0).onComplete.add((function(){this.destroy(),this.state.pauseWindow=null}),this)}},this)},t.PauseWindow.prototype.restart=function(){sdkHandler.trigger("levelFinish",{level:this.state.lvlNr+1,score:t.saveState.data.progress[1]||0,state:"lose"},this),sdkHandler.trigger("interstitialAd",{callback:function(){t.saveState.resetProgress(),this.ignoreChildInput=!0,game.camera.fade(0,300,!0),game.camera.onFadeComplete.add((function(){game.state.start("MainMenu")}))}},this)},t.PointController=function(e,i){Phaser.Group.call(this,game),this.position.setTo(e,i),this.points=t.saveState.data.progress[1],this.counter=new t.TextCounter(0,0,t.saveState.data.progress[1],{style:game.device.desktop?"regular":"endGameTexts",fontSize:40},.5,150),game.device.desktop||(this.counter.padding.x=6,this.counter.padding.y=6,this.counter.setShadow(4,6,"rgba(0,0,0,0.2)",6)),this.add(this.counter),this.forMatch=t.json.settings.pointsForMatch,this.forHint=t.json.settings.hintPenalty,this.combo=1,this.lastMatchTimestamp=0,t.sb("onMatch").add(this.onMatch,this),t.sb("onHint").add(this.onHint,this),t.sb("onTimeBonus").add(this.onTimeBonus,this)},t.PointController.prototype=Object.create(Phaser.Group.prototype),t.PointController.prototype.onMatch=function(){Date.now()-this.lastMatchTimestamp<=t.json.settings.comboTime?(this.combo++,this.combo>10&&(this.combo=2),t.sb("onComboIncreased").dispatch(this.combo)):this.combo=1,this.lastMatchTimestamp=Date.now(),this.points+=this.forMatch*this.combo,this.counter.setAmount(this.points),t.saveState.setPoints(this.points)},t.PointController.prototype.onHint=function(){this.points-=this.forHint,this.points=Math.max(0,this.points),this.counter.setAmount(this.points),t.saveState.setPoints(this.points),t.sfx.hint.play()},t.PointController.prototype.onTimeBonus=function(e){this.points+=t.json.settings.bonusPerSecond*(e||1),this.counter.setAmount(this.points),t.saveState.setPoints(this.points),t.sfx.pop.play()},t.PopUpBackground=function(){Phaser.Group.call(this,game),this.onResize()},t.PopUpBackground.prototype=Object.create(Phaser.Group.prototype),t.PopUpBackground.prototype.onResize=function(){for(var e=Math.ceil(game.width/576);this.children.length<e;)t.makeImage(576*this.children.length,0,"popup",[0,.5],this);this.pivot.x=Math.floor(576*this.children.length*.5)},t.PreloaderDot=function(e,i,s){Phaser.Group.call(this,game),this.rX=e,this.rY=i,this.config=s||{},this.gfx=this.add(this.addDotsGfx()),this.txt=this.add(new t.Text(0,0,"0%",{font:"LascoBold",fontSize:"28px",fill:this.config.textColor||"white"},.5)),this.frameCounter=0,this.frameEvery=6,game.load.onFileComplete.add((function(t){this.txt.setText(t+"%")}),this),t.sb("onScreenResize").add(this.onResize,this),this.onResize()},t.PreloaderDot.prototype=Object.create(Phaser.Group.prototype),t.PreloaderDot.prototype.onResize=function(){this.x=game.width*this.rX,this.y=game.height*this.rY},t.PreloaderDot.prototype.update=function(){this.frameCounter++%this.frameEvery==0&&(this.gfx.angle+=45)},t.PreloaderDot.prototype.addDotsGfx=function(){for(var e=game.add.graphics(),i=0;i<6;i++){var s=t.lengthDirX(45*i,60,!1),a=t.lengthDirY(45*i,60,!1);e.beginFill(this.config.dotColor||16777215,i/6),e.drawCircle(s,a,15)}return e},t.saveState={makeNewDataObject:function(){return{mute:!1,progress:[0,0,t.json.settings.hintsNr,null,null],highscore:0}},save:function(){this.data.mute=game.sound.mute,this.data.desktop=game.device.desktop,sdkHandler.trigger("save",{key:"gm-candymahjong",value:JSON.stringify(this.data),callback:function(){}},this)},init:function(){sdkHandler.trigger("restore",{key:"gm-candymahjong",callback:function(t,e){e?(this.data=JSON.parse(e),this.data.desktop!==game.device.desktop&&(this.resetProgress(),this.data.desktop=game.device.desktop)):this.data=this.makeNewDataObject(),game.sound.mute=this.data.mute,this.ready=!0}.bind(this)},this)},resetProgress:function(){this.data.progress=[0,0,t.json.settings.hintsNr,null,null],this.save()},levelEnd:function(t){t&&(this.data.progress[0]++,this.data.progress[3]=null,this.data.progress[4]=null),this.save()},useHint:function(){this.data.progress[2]--,this.save()},addHints:function(t){this.data.progress[2]+=t,this.save()},getHintsAmount:function(){return this.data.progress[2]},setPoints:function(t){this.data.progress[1]=t}},t.SoundBtn=function(){t.Button.call(this,0,0,"button_sound_off_2",(function(){game.sound.mute=!game.sound.mute,t.sfx.music.resume(),t.saveState.data.soundButtonState=!game.sound.mute,this.refreshSprite()}),this),this.refreshSprite(),this.onResizeBinding=t.sb("onScreenResize").add(this.onResize,this),this.onResize(),this.events.onDestroy.add((function(){this.onResizeBinding&&this.onResizeBinding.detach()}),this),game.add.existing(this)},t.SoundBtn.prototype=Object.create(t.Button.prototype),t.SoundBtn.prototype.refreshSprite=function(){var e=game.sound.mute?"button_sound_off":"button_sound_on";t.saveState.data.soundButtonState=!game.sound.mute,game.device.desktop&&(e+="_2"),t.changeTexture(this,e)},t.SoundBtn.prototype.onResize=function(){game.device.desktop&&(this.x=Math.floor(.5*game.width)-520,this.y=game.height-35)},t.TimeController=function(e,i){Phaser.Group.call(this,game),this.state=game.state.getCurrentState(),this.board=this.state.board,this.position.setTo(e,i),this.bonusPointsPart=0,game.device.desktop?this.timeUI=new t.TimeControllerBar(0,0):this.timeUI=new t.TimeControllerArc(0,0),this.add(this.timeUI),this.timerFlashingSec=t.json.settings.timerFlashingSec,this.secForMatch=void 0!==this.state.lvlData.secForMatch?this.state.lvlData.secForMatch:t.json.settings.secForMatch,this.timeMax=this.state.lvlData.timeSec||t.json.settings.timeSec,this.timeCurrent=this.timeMax,this.timeCurrentLerp=this.timeCurrent,null!==t.saveState.data.progress[3]&&(this.timeCurrent=t.saveState.data.progress[3],this.timeCurrentLerp=this.timeCurrent,this.timeUI.update(this.timeCurrent/this.timeMax)),this.lastFullSec=Math.ceil(this.timeCurrent),this.paused=!1,t.sb("onPause").add((function(){this.paused=!0}),this),t.sb("onUnpause").add((function(){this.paused=!1}),this),t.sb("onBoardEmpty").add((function(){this.lastFullSec=Math.ceil(this.timeCurrent),t.sb("onTimeBonus").dispatch(Math.ceil(this.timeCurrent)),game.time.events.add(2e3,(function(){t.sb("onBonusTimeZero").dispatch()}))}),this),t.sb("onMatch").add(this.onMatch,this)},t.TimeController.prototype=Object.create(Phaser.Group.prototype),t.TimeController.prototype.update=function(){this.paused||(this.timeCurrent-=.0166,t.saveState.data.progress[3]=this.timeCurrent,this.timeCurrentLerp=t.lerp(this.timeCurrentLerp,this.timeCurrent,.05),this.lastFullSec!==Math.ceil(this.timeCurrent)&&this.lastFullSec<=10&&t.sfx.timer.play(),this.lastFullSec=Math.ceil(this.timeCurrent),this.timeUI.update(this.timeCurrentLerp/this.timeMax,this.timeCurrent<this.timerFlashingSec),this.timeCurrent<=0&&0==this.board.moves.length&&(this.update=function(){},t.sb("onTimesUp").dispatch()))},t.TimeController.prototype.onMatch=function(){this.timeCurrent=game.math.clamp(this.timeCurrent+this.secForMatch,0,this.timeMax)},t.TimeControllerArc=function(e,i){Phaser.Group.call(this,game),this.position.setTo(e,i),this.bg=t.makeImage(0,0,"mobile_time",[.5,1],this),this.arc=t.makeImage(0,-26,"mobile_time_bar",[.5,1],this),this.arcHl=t.makeImage(0,0,"mobile_time_bar_hl",[.5,1],this.arc),this.arcHl.alphaVis=0,this.arcHl.alphaPulse=0,game.add.tween(this.arcHl).to({alphaPulse:1},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.maskGfx=game.make.graphics(),this.arc.addChild(this.maskGfx),this.arc.mask=this.maskGfx},t.TimeControllerArc.prototype=Object.create(Phaser.Group.prototype),t.TimeControllerArc.prototype.update=function(e,i){this.drawMaskArc(e),this.arcHl.alphaVis=t.lerp(this.arcHl.alphaVis,i?1:0,.1),this.arcHl.alpha=this.arcHl.alphaVis*this.arcHl.alphaPulse},t.TimeControllerArc.prototype.drawMaskArc=function(e){var i=180+180*e;this.maskGfx.clear(),this.maskGfx.beginFill(0),t.drawCircleSegment(this.maskGfx,0,0,190,179,i)},t.TimeControllerBar=function(e,i){Phaser.Group.call(this,game),this.position.setTo(e,i),this.bg=t.makeImage(0,0,"loading_bar_empty_2",0,this),this.full=t.makeImage(0,0,"loading_bar_full_2",0,this),this.fullHl=t.makeImage(0,0,"loading_bar_full_hl_2",0,this),this.full.cropRect=new Phaser.Rectangle(0,0,514,20),this.fullHl.cropRect=this.full.cropRect,this.fullHl.alphaPulse=0,this.fullHl.alphaVis=0,game.add.tween(this.fullHl).to({alphaPulse:1},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},t.TimeControllerBar.prototype=Object.create(Phaser.Group.prototype),t.TimeControllerBar.prototype.update=function(e,i){this.full.cropRect.width=Math.max(0,Math.floor(514*e)),this.full.updateCrop(),this.fullHl.updateCrop(),this.fullHl.alphaVis=t.lerp(this.fullHl.alphaVis,i?1:0,.1),this.fullHl.alpha=this.fullHl.alphaVis*this.fullHl.alphaPulse},t.UIBar=function(){Phaser.Group.call(this,game),this.state=game.state.getCurrentState(),game.device.desktop?this.initDesktop():this.initMobile(),t.sb("onScreenResize").add(this.onResize,this),this.onResize()},t.UIBar.prototype=Object.create(Phaser.Group.prototype),t.UIBar.prototype.initDesktop=function(){this.bg=t.makeImage(0,0,"ui_bar",[.5,1],this),this.levelNr=this.add(new t.Text(300,-35,this.state.lvlNr+1+"/"+t.json.levels.length,{style:"regular",fontSize:40},[0,.5])),this.pointController=new t.PointController(-370,-35),this.add(this.pointController),this.progressBar=new t.TimeController(-257,-30),this.add(this.progressBar),this.timeLabel=new t.Text(0,-45,t.txt("Time"),{style:"regular",fontSize:25},.5),this.add(this.timeLabel)},t.UIBar.prototype.initMobile=function(){this.levelNr=this.add(new t.Text(190,-55,this.state.lvlNr+1+" / "+t.json.levels.length,{style:"endGameTexts",fontSize:40},.5)),this.levelNr.padding.x=6,this.levelNr.padding.y=6,this.levelNr.setShadow(4,6,"rgba(0,0,0,0.2)",6),this.pointController=new t.PointController(-190,-55),this.add(this.pointController),this.progressBar=new t.TimeController(0,0),this.add(this.progressBar)},t.UIBar.prototype.onResize=function(){this.x=Math.floor(.5*game.width),this.y=game.height,this.bg&&(this.bg.width=game.width)},window.initGame=function(){var e=new Phaser.Game(1200,800,Phaser.CANVAS,"content",null,!0);window.game=e,e.state.add("Boot",t.Boot),e.state.add("Preloader",t.Preloader),e.state.add("MainMenu",t.MainMenu),e.state.add("Game",t.Game),e.state.add("GameProto",t.GameProto),e.state.add("Test",t.Test),e.state.start("Boot")},t.ASSETS={spritesheets:["BOOT-loader_ja","BOOT-loader","gems","ssheet"],sfx:["boom.mp3","btn_pressed.mp3","combo_01.mp3","combo_02.mp3","combo_03.mp3","combo_04.mp3","combo_05.mp3","combo_06.mp3","combo_07.mp3","combo_08.mp3","combo_09.mp3","firework.mp3","firework2.mp3","game_over.mp3","game_won.mp3","hint.mp3","match.mp3","music.mp3","new_highscore.mp3","new_level.mp3","pop.mp3","score_counter.mp3","stones_touch.mp3","stone_selection.mp3","timer.mp3"],images:["bg_h.png","bg_v.png"],json:["languages.json","levels.json","settings.json"],fonts:{}}}();