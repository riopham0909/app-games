(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}!function(){var e={};window.G=e,window.gameG=e,void 0===e&&(e={}),e.ExtLoader=function(){Phaser.Loader.call(this,game),game.state.onStateChange.add(this.reset,this),this.imagesToRemoveOnStateChange=[],this.loadedUrls={}},e.ExtLoader.prototype=Object.create(Phaser.Loader.prototype),e.ExtLoader.prototype.reset=function(t,e){this.imagesToRemoveOnStateChange.forEach((function(t){this.cache.removeImage(t)}),this),this.imagesToRemoveOnStateChange=[],Phaser.Loader.prototype.reset.call(this,t,e)},e.ExtLoader.prototype.addToFileList=function(t,e,i,s,a,n){if(void 0===a&&(a=!1),void 0===e||""===e)return this;if(null==i){if(!n)return this;i=e+n}var o={type:t,key:e,path:this.path,url:i,syncPoint:this._withSyncPointDepth>0,data:null,loading:!1,loaded:!1,error:!1};if(s)for(var r in s)o[r]=s[r];var h=this.getAssetIndex(t,e);if(a&&h>-1){var l=this._fileList[h];l.loading||l.loaded?(this._fileList.push(o),this._totalFileCount++):this._fileList[h]=o}else-1===h&&(this._fileList.push(o),this._totalFileCount++);return this.loadFile(this._fileList.shift()),this},e.ExtLoader.prototype.asyncComplete=function(t,e){void 0===e&&(e=""),t.loaded=!0,t.error=!!e,e&&(t.errorMessage=e)},e.ExtLoader.prototype.fileComplete=function(t,e){switch(t.type){case"packfile":var i=JSON.parse(e.responseText);t.data=i||{};break;case"image":this.cache.addImage(t.key,t.url,t.data);break;case"spritesheet":this.cache.addSpriteSheet(t.key,t.url,t.data,t.frameWidth,t.frameHeight,t.frameMax,t.margin,t.spacing);break;case"textureatlas":if(null==t.atlasURL)this.cache.addTextureAtlas(t.key,t.url,t.data,t.atlasData,t.format);else if(!1,t.format==Phaser.Loader.TEXTURE_ATLAS_JSON_ARRAY||t.format==Phaser.Loader.TEXTURE_ATLAS_JSON_HASH||t.format==Phaser.Loader.TEXTURE_ATLAS_JSON_PYXEL)this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.jsonLoadComplete);else{if(t.format!=Phaser.Loader.TEXTURE_ATLAS_XML_STARLING)throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+t.format);this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",this.xmlLoadComplete)}break;case"bitmapfont":t.atlasURL?(!1,this.xhrLoad(t,this.transformUrl(t.atlasURL,t),"text",(function(t,e){var i;try{i=JSON.parse(e.responseText)}catch(t){}i?(t.atlasType="json",this.jsonLoadComplete(t,e)):(t.atlasType="xml",this.xmlLoadComplete(t,e))}))):this.cache.addBitmapFont(t.key,t.url,t.data,t.atlasData,t.atlasType,t.xSpacing,t.ySpacing);break;case"video":if(t.asBlob)try{t.data=e.response}catch(e){throw new Error("Phaser.Loader. Unable to parse video file as Blob: "+t.key)}this.cache.addVideo(t.key,t.url,t.data,t.asBlob);break;case"audio":this.game.sound.usingWebAudio?(t.data=e.response,this.cache.addSound(t.key,t.url,t.data,!0,!1),t.autoDecode&&this.game.sound.decode(t.key)):this.cache.addSound(t.key,t.url,t.data,!1,!0);break;case"text":t.data=e.responseText,this.cache.addText(t.key,t.url,t.data);break;case"shader":t.data=e.responseText,this.cache.addShader(t.key,t.url,t.data);break;case"physics":i=JSON.parse(e.responseText);this.cache.addPhysicsData(t.key,t.url,i,t.format);break;case"script":t.data=document.createElement("script"),t.data.language="javascript",t.data.type="text/javascript",t.data.defer=!1,t.data.text=e.responseText,document.head.appendChild(t.data),t.callback&&(t.data=t.callback.call(t.callbackContext,t.key,e.responseText));break;case"binary":t.callback?t.data=t.callback.call(t.callbackContext,t.key,e.response):t.data=e.response,this.cache.addBinary(t.key,t.data)}this.onFileComplete.dispatch(0,t.key,!t.error)},void 0===e&&(e={}),e.Button=function(t,i,s,a,n){Phaser.Button.call(this,game,e.l(t),e.l(i),null),this.state=game.state.getCurrentState(),e.changeTexture(this,s),this.anchor.setTo(.5),this.sfx=e.sfx.pop,this.active=!0,this.onClick=new Phaser.Signal,a&&this.onClick.add(a,n||this),this.onInputDown.add(this.click,this),this.terms=[],this.IMMEDIATE=!1,this.scaleOnClick=!0,this.targetAlphaTermsNotFulfilled=.5,this.targetAlpha=1,this.pulsing=!1},e.Button.prototype=Object.create(Phaser.Button.prototype),e.Button.constructor=e.Button,e.Button.prototype.update=function(){this.checkTerms()?this.targetAlpha=1:this.targetAlpha=this.targetAlphaTermsNotFulfilled,this.alpha=e.lerp(this.alpha,this.targetAlpha,.2,.05),this.updateChildren()},e.Button.prototype.pulse=function(t){this.pulsing=!0,this.pulsingTween=game.add.tween(this.scale).to({x:t||1.1,y:t||1.1},500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},e.Button.prototype.stopPulse=function(t){this.pulsingTween&&this.pulsingTween.stop(),this.scale.setTo(t||1),this.pulsing=!1},e.Button.prototype.click=function(){if(this.active&&this.checkTerms()){this.active=!1,this.onClick.dispatch();var t=this.scale.x,e=this.scale.y;this.IMMEDIATE?this.active=!0:this.pulsing||!this.scaleOnClick?game.time.events.add(400,(function(){this.active=!0}),this):game.add.tween(this.scale).to({x:t+.2,y:e+.2},200,Phaser.Easing.Quadratic.Out,!0).onComplete.add((function(){game.add.tween(this.scale).to({x:t,y:e},200,Phaser.Easing.Quadratic.Out,!0).onComplete.add((function(){this.active=!0}),this)}),this)}},e.Button.prototype.checkTerms=function(){for(var t=0;t<this.terms.length;t++)if(!this.terms[t][0].call(this.terms[t][1]))return!1;return!0},e.Button.prototype.addTerm=function(t,e){this.terms.push([t,e])},e.Button.prototype.addImageLabel=function(t){this.label=game.make.image(0,0,"ssheet",t),this.label.anchor.setTo(.5),this.addChild(this.label)},e.Button.prototype.addTextLabel=function(t,i,s){var a=1/e.Loader.currentConfigMulti;this.label=new e.OneLineText(-7,-6,t,i,s||Math.floor(this.height*a*.7),this.width*a*.9,.5,.5),this.addChild(this.label)},e.Button.prototype.addTextLabelMultiline=function(t,i){var s=1/e.Loader.currentConfigMulti;this.label=new e.MultiLineText(0,0,t,i,Math.floor(this.height*s*.5),this.width*s*.8,this.height*s*.7,"center",.5,.5),this.addChild(this.label)},e.Button.prototype.stopTweens=function(){e.stopTweens(this)},e.Button.prototype.changeTexture=function(t){e.changeTexture(this,t)},e.Button.prototype.add=function(t){return this.addChild(t)},e.Button.prototype.updateChildren=function(){for(var t=this.children.length;t--;)this.children[t].update()},void 0===e&&(e={}),e.FrameAnimation=function(t,i,s,a,n){Phaser.Image.call(this,game,e.l(t),e.l(i)),this.anchor.setTo(.5),this.frameNamePrefix=s,this.animFramesLen=this.getAnimationLength(this.frameNamePrefix),this.timerEvery=a?60/a:1,this.animDir=1,e.changeTexture(this,this.frameNamePrefix+"_0"),this.currentTimer=0,this.currentIndex=0,this.onFinish=new Phaser.Signal,this.active=n||!1},e.FrameAnimation.prototype=Object.create(Phaser.Image.prototype),e.FrameAnimation.prototype.play=function(t,i,s){return this.currentTimer=0,this.currentIndex=s||0,this.active=!0,this.loop=t-1||0,this.animDir=1,this.bounce=i||!1,e.changeTexture(this,this.frameNamePrefix+"_"+this.currentIndex),this},e.FrameAnimation.prototype.update=function(){if(this.active&&(this.currentTimer+=e.deltaTime>=this.timerEvery)){if(this.currentTimer=this.currentTimer-this.timerEvery,this.currentIndex+=this.animDir,this.bounce){if(this.currentIndex==this.animFramesLen||0==this.currentIndex){if(0==this.loop&&0==this.currentIndex)return this.onFinish.dispatch(),this.active=!1;this.loop>0&&0==this.currentIndex&&this.loop--,this.currentIndex==this.animFramesLen&&(this.currentIndex=this.animFramesLen-1),this.animDir*=-1}}else if(this.currentIndex==this.animFramesLen){if(0==this.loop)return this.onFinish.dispatch(),this.active=!1;this.loop>0&&this.loop--,this.currentIndex=0}e.changeTexture(this,this.frameNamePrefix+"_"+this.currentIndex)}},e.FrameAnimation.prototype.getAnimationLength=function(t){if(e.FrameAnimation.CacheAnimLength[t])return e.FrameAnimation.CacheAnimLength[t];for(var i=0,s=0;s<1e3&&e.isImageInCache(t+"_"+s);s++)i++;return e.FrameAnimation.CacheAnimLength[t]=i,i},e.FrameAnimation.CacheAnimLength={},e.gift={},e.gift.getGift=function(t){t=t||"normals";var i=e.json.settings.gifts[t],s=i.boosterMaxNr||e.json.settings.gifts.boosterMaxNr,a=i.boosterChance||e.json.settings.gifts.boosterChance,n=[];i.list.forEach((function(t){("coin"==t[0]||-1!==t[0].indexOf("booster")&&e.saveState.isBoosterUnlocked(parseInt(t[0][8]))&&e.saveState.getBoosterAmount(parseInt(t[0][8]))<s)&&n.push(t)})),Phaser.ArrayUtils.shuffle(n);for(var o=Math.random()<a,r=0;r<n.length;r++){var h=n[r];if(-1===h[0].indexOf("booster"))return h.slice();if(o)return h.slice()}return["coin",50]},e.gift.getLabelString=function(t){return t[1]+" @"+e.json.settings.gifts.icons[t[0]]+"@"},e.gift.applyGift=function(t){"coin"==t[0]?e.saveState.changeCoins(t[1]):e.saveState.changeBoosterAmount(parseInt(t[0][8]),t[1])},e.gift.getIcon=function(t){return e.json.settings.gifts.icons[t[0]]},void 0===e&&(e={}),e.GridArray=function(t,e,i,s){"number"==typeof t?this.createGrid.apply(this,arguments):"string"==typeof t?(this.data=JSON.parse(arguments[0]),this.width=this.data.length,this.height=this.data[0].length):Array.isArray(t)&&(a=arguments[0],this.data=arguments[0],this.width=this.data.length,this.height=this.data[0].length)},e.GridArray.prototype={createGrid:function(t,e,i){this.data=[],this.width=t,this.height=e;for(var s=0;s<t;s++){this.data[s]=[];for(var a=0;a<e;a++)this.data[s][a]=i}},set:function(t,e,i){return this.isInGrid(t,e)?this.data[t][e]=i:(this.dbg,!1)},get:function(t,e){return this.isInGrid(t,e)?this.data[t][e]:(this.dbg,!1)},swapValues:function(t,e,i,s){if(!this.isInGrid(t,e)||!this.isInGrid(i,s))return this.dbg,!1;var a=this.data[t][e];this.data[t][e]=this.data[i][s],this.data[i][s]=a},isInGrid:function(t,e){return!(t<0||t>=this.width||e<0||e>=this.height)},find:function(t,e){for(var i=0;i<this.width;i++)for(var s=0;s<this.height;s++){if(t.call(e,this.data[i][s],i,s,this.data))return this.data[i][s]}return!1},filter:function(t,e){for(var i=[],s=0;s<this.width;s++)for(var a=0;a<this.height;a++){t.call(e,this.data[s][a],s,a,this.data)&&i.push(this.data[s][a])}return i},loop:function(t,e){for(var i=0;i<this.width;i++)for(var s=0;s<this.height;s++)t.call(e,this.data[i][s],i,s,this.data)},clear:function(t){this.loop((function(e,i,s,a){a[i][s]=t||!1}))},findPattern:function(t,e){var i=!1,s=t.length;return this.loop((function(a,n,o,r){if(a==e&&!i){for(var h=0;h<s;h+=2){if(!this.get(n+t[h],o+t[h+1]))return;if(this.get(n+t[h],o+t[h+1])!==e)return}i=[];for(var l=0;l<s;l+=2)i.push(n+t[l],o+t[l+1])}}),this),i},count:function(){for(var t=0,e=0;e<this.width;e++)for(var i=0;i<this.height;i++)this.data[e][i]&&t++;return t},getAllElements:function(){for(var t=[],e=0;e<this.width;e++)for(var i=0;i<this.height;i++)this.data[e][i]&&t.push(this.data[e][i]);return t}},e.Image=function(t,i,s,a,n){Phaser.Image.call(this,game,e.l(t),e.l(i),null),Object.defineProperty(this,"angle",{get:function(){return Phaser.Math.radToDeg(this.rotation)},set:function(t){this.rotation=Phaser.Math.degToRad(t)}}),this.angle=0,this.state=game.state.getCurrentState(),this.changeTexture(s),a&&("number"==typeof a?this.anchor.setTo(a):this.anchor.setTo(a[0],a[1])),n?(n.add||n.addChild).call(n,this):null!==n&&game.world.add(this)},e.Image.prototype=Object.create(Phaser.Image.prototype),e.Image.prototype.stopTweens=function(){e.stopTweens(this)},e.Image.prototype.changeTexture=function(t){e.changeTexture(this,t)},Phaser.Image.prototype.changeTexture=function(t){e.changeTexture(this,t)},e.Image.prototype.add=function(t){return this.addChild(t)},e.LabelParser={specialChars:["$","@","%","^"],changeIntoTagArray:function(t,e){for(var i=[],s=0;t.length>0&&!(s++>20);){var a=this.findFirstSpecialChar(t);if(-1===a){i.push(t);break}a[0]>0&&(i.push(t.slice(0,a[0])),t=t.slice(a[0])),t=this.cutOffTag(t,i,a[1])}var n=[];for(s=0;s<i.length;s++)n.push(this.processTag(i[s],e));return this.mergeTextTagsInArray(n)},mergeTextTagsInArray:function(t){for(var e=[],i=null,s=0;s<t.length;s++)"text"!==t[s].type?(null!==i&&(e.push(this.mergeTextTags(t,i,s)),i=null),e.push(t[s])):null==i&&(i=s);return null!==i&&e.push(this.mergeTextTags(t,i,s)),e},mergeTextTags:function(t,e,i){for(var s={type:"text",content:[]};e<i;e++)s.content.push(t[e].content);return s.content=s.content.join(" "),s},processTag:function(t,i){if("@"==t[0]){var s=1;return"*"==t[1]&&t.indexOf("*",2)&&(s=parseFloat(t.slice(t.indexOf("*")+1,t.indexOf("*",2))),t=t.slice(t.indexOf("*",2))),{type:"img",content:t.slice(1,-1),scale:s}}return"%"==t[0]?{type:"text",content:i[t.slice(1,-1)]}:"$"==t[0]?{type:"text",content:e.txt(t.slice(1,-1))}:"^"==t[0]?{type:"text",content:t.slice(1,-1)}:this.isStringJustSpaces(t)?{type:"separator",content:t,length:t.length}:{type:"text",content:t}},isStringJustSpaces:function(t){for(var e=0;e<t.length;e++)if(" "!==t[e])return!1;return!0},cutOffTag:function(t,e,i){var s=t.indexOf(i),a=t.indexOf(i,s+1);return e.push(t.slice(s,a+1)),t.slice(0,s)+t.slice(a+1)},findFirstSpecialChar:function(t){var e=1/0,i=!1;return this.specialChars.forEach((function(s){var a=t.indexOf(s);a>-1&&e>a&&(i=s,e=Math.min(a,e))})),e===1/0?-1:[e,i]},createLabel:function(t,i,s,a,n,o,r,h,l,d){this.changeIntoTagArray(t,i);return new e.LabelGroup(s,a,o,l,r,h,d)}},e.LabelGroup=function(t,i,s,a,n,o,r,h){Phaser.Group.call(this,game),this.fontData=game.cache.getBitmapFont(a).font,this.fontBaseSize=this.fontData.size,this.fontSpaceOffset=this.fontData.chars[32].xOffset+this.fontData.chars[32].xAdvance,this.str=t,this.tagArray=e.LabelParser.changeIntoTagArray(t),this.x=void 0===i?0:e.l(i),this.y=void 0===s?0:e.l(s),this.font=a,this.fontSize=void 0===n?e.l(30):e.l(n),this.distanceBetween=0,this.anchorX=void 0===o?.5:o,this.anchorY=void 0===r?.5:r,this.maxWidth=h||0,this.processTagArray()},e.LabelGroup.prototype=Object.create(Phaser.Group.prototype),e.LabelGroup.prototype.processTagArray=function(){for(var t=0;t<this.tagArray.length;t++){if("img"==this.tagArray[t].type)(i=e.makeImage(0,0,this.tagArray[t].content,0,this)).tagScale=this.tagArray[t].scale;else if("separator"==this.tagArray[t].type){var i;(i=e.makeImage(0,0,null,0,this)).SEPARATOR=!0,i.SEP_LENGTH=this.tagArray[t].length}else this.add(game.add.bitmapText(0,0,this.font,this.tagArray[t].content,this.fontSize))}this.refresh()},e.LabelGroup.prototype.refresh=function(){if(this.applySizeAndAnchor(),this.maxWidth>0&&this.getWholeWidth()>this.maxWidth)for(;this.getWholeWidth()>this.maxWidth;)this.distanceBetween*=.9,this.fontSize*=.9,this.applySizeAndAnchor();this.spreadElements()},e.LabelGroup.prototype.applySizeAndAnchor=function(){this.children.forEach((function(t){t.anchor.setTo(this.anchorX,this.anchorY),t.fontSize?(t.fontSize=this.fontSize,t.updateText()):(t.height=this.fontSize*(t.tagScale||1),t.scale.x=t.scale.y),t.SEPARATOR&&(t.width=this.fontSize/this.fontBaseSize*this.fontSpaceOffset*t.SEP_LENGTH)}),this)},e.LabelGroup.prototype.getWholeWidth=function(){var t=(this.children.length-1)*this.distanceBetween,e=0;return this.children.forEach((function(t){e+=t.width})),t+e},e.LabelGroup.prototype.spreadElements=function(){var t=this.getWholeWidth()*this.anchorX*-1;this.children.forEach((function(e,i,s){e.left=0==i?t:s[i-1].right+this.distanceBetween}),this)},e.LineEditor=function(){Phaser.Group.call(this,game),this.gfx=game.add.graphics(),this.gfx.fixedToCamera=!0,this.points={x:[],y:[]},this.currentIndex=null,this.pointerStart=new Phaser.Point(0,0),this.interpolation="linearInterpolation",game.input.onDown.add((function(t){this.currentIndex=this.findCurrentIndex(t),null!==this.currentIndex&&(this.pointerStart.x=t.x,this.pointerStart.y=t.y)}),this),game.input.onUp.add((function(t){this.currentIndex=null}),this),this.keys=game.input.keyboard.addKeys({Z:Phaser.Keyboard.Z,X:Phaser.Keyboard.X,C:Phaser.Keyboard.C,A:Phaser.Keyboard.A,S:Phaser.Keyboard.S,D:Phaser.Keyboard.D}),this.keys.Z.onDown.add((function(){this.interpolation="catmullRomInterpolation"}),this),this.keys.X.onDown.add((function(){this.interpolation="bezierInterpolation"}),this),this.keys.C.onDown.add((function(){this.interpolation="linearInterpolation"}),this),this.keys.A.onDown.add((function(){var t=game.input.activePointer;this.points.x.push(t.x),this.points.y.push(t.y)}),this),this.keys.S.onDown.add((function(){this.currentIndex&&(this.points.x.splice(this.currentIndex,1),this.points.y.splice(this.currentIndex,1))}),this),this.keys.D.onDown.add((function(){this.points.x.pop(),this.points.y.pop()}),this)},e.LineEditor.prototype=Object.create(Phaser.Group.prototype),e.LineEditor.prototype.update=function(){if(this.currentIndex){var t=game.input.activePointer,e=this.pointerStart.x-t.x,i=this.pointerStart.y-t.y;this.pointerStart.x=t.x,this.pointerStart.y=t.y,this.points.x[this.currentIndex]-=e,this.points.y[this.currentIndex]-=i}this.redraw()},e.LineEditor.prototype.findCurrentIndex=function(t){for(var e=null,i=1/0,s=0;s<this.points.x.length;s++){var a=game.math.distance(t.x,t.y,this.points.x[s],this.points.y[s]);a<i&&(e=s,i=a)}return e},e.LineEditor.prototype.redraw=function(){this.gfx.clear(),this.drawLine(),this.drawPoints()},e.LineEditor.prototype.drawPoints=function(){this.gfx.lineStyle(2,255,1),this.gfx.beginFill(255,.5);for(var t=0;t<this.points.x.length;t++)this.gfx.drawCircle(this.points.x[t],this.points.y[t],10)},e.LineEditor.prototype.drawLine=function(){if(0!=this.points.x.length){this.gfx.lineStyle(2,16711680,1),this.gfx.moveTo(this.points.x[0],this.points.y[0]);for(var t=0;t<1;t+=.001){var e=game.math[this.interpolation](this.points.x,t),i=game.math[this.interpolation](this.points.y,t);this.gfx.lineTo(e,i)}}},void 0===e&&(e={}),e.Loader={currentConfig:"hd",currentConfigMulti:1,loadingScreenActive:!1,passConfigs:function(t){this.configs=t},setConfig:function(t){this.currentConfig=t,this.currentConfigMulti=this.configs[t]},killLoadingScreen:function(){e.imgRotate&&(e.whiteOverlay.destroy(),e.imgRotate.fadeOut=!0,e.imgRotate=!1,this.loadingScreenActive=!1)},loadPOSTImage:function(t){void 0!==t&&(game.cache.checkImageKey(t)||(this.makeLoadingScreen(),game.load.image(t,"assets/"+this.currentConfig+"/imagesPOST/"+t)))},loadBootAssets:function(){e.ASSETS.images.forEach((function(t){0==t.indexOf("BOOT")&&game.load.image(this.removeExt(t),"assets/"+this.currentConfig+"/images/"+t)}),this),e.ASSETS.spritesheets.forEach((function(t){0==t.indexOf("BOOT")&&game.load.atlasJSONHash(t,"assets/"+this.currentConfig+"/spritesheets/"+t+".png","assets/"+this.currentConfig+"/spritesheets/"+t+".json")}),this),game.load.onLoadComplete.addOnce((function(){this.createSpritesheetMap(!0)}),this)},loadAssets:function(){game.load.onLoadComplete.addOnce(this.processAssets,this),this.loadSFX(e.ASSETS.sfx),this.loadImages(e.ASSETS.images),this.loadSpritesheets(e.ASSETS.spritesheets),this.loadJson(e.ASSETS.json),this.loadFonts(e.ASSETS.fonts)},processAssets:function(){this.processJson(e.ASSETS.json),this.processSFX(e.ASSETS.sfx),this.createSpritesheetMap()},createSpritesheetMap:function(t){e.spritesheetMap||(e.spritesheetMap={});for(var i=0,s=e.ASSETS.spritesheets.length;i<s;i++){var a=e.ASSETS.spritesheets[i];if((!t||0===a.indexOf("BOOT"))&&((t||0!=a.indexOf("BOOT"))&&game.cache.checkImageKey(a)))for(var n=game.cache.getFrameData(a),o=0;o<n._frames.length;o++){var r=n._frames[o];e.spritesheetMap[r.name],e.spritesheetMap[r.name]=a}}},loadSFX:function(t){t.forEach((function(t){game.load.audio(this.removeExt(t),"assets/sfx/"+t)}),this)},loadFonts:function(t){for(var e in t){if(0==e.indexOf("MOBILE")&&game.device.desktop)return;if(0==e.indexOf("DESKTOP")&&!game.device.desktop)return;game.load.bitmapFont(e,"assets/"+this.currentConfig+"/fonts/"+t[e].frame,"assets/"+this.currentConfig+"/fonts/"+t[e].data)}},loadImages:function(t){t.forEach((function(t){0!=t.indexOf("BOOT")&&(0==t.indexOf("MOBILE")&&game.device.desktop||(0!=t.indexOf("DESKTOP")||game.device.desktop)&&game.load.image(this.removeExt(t),"assets/"+this.currentConfig+"/images/"+t))}),this)},loadJson:function(t){t.forEach((function(t){game.load.json(this.removeExt(t),"assets/json/"+t)}),this)},loadSpritesheets:function(t){t.forEach((function(t){0!=t.indexOf("BOOT")&&(0==t.indexOf("MOBILE")&&game.device.desktop||(0!=t.indexOf("DESKTOP")||game.device.desktop)&&game.load.atlasJSONHash(t,"assets/"+this.currentConfig+"/spritesheets/"+t+".png","assets/"+this.currentConfig+"/spritesheets/"+t+".json"))}),this)},removeExt:function(t){return t.slice(0,t.lastIndexOf("."))},processJson:function(t){e.json={},t.forEach((function(t){t=this.removeExt(t),e.json[t]=game.cache.getJSON(t)}),this)},processSFX:function(t){e.sfx={},game.sfx=e.sfx,t.forEach((function(t){t=this.removeExt(t),e.sfx[t]=game.add.audio(t)}),this)}},e.MultiLineText=function(t,i,s,a,n,o,r,h,l,d){if(t=e.l(t),i=e.l(i),n=e.l(n),o=e.l(o),r=e.l(r),this.maxUserWidth=o,this.maxUserHeight=r,Phaser.BitmapText.call(this,game,t,i,s,"",n),this.splitText(a,o),this.align=h||"center",r)for(;this.height>r&&(this.fontSize-=2,this.splitText(a,o),this.updateText(),!(this.fontSize<5)););this.anchor.setTo(l,d),this.cacheAsBitmap=!0},e.MultiLineText.prototype=Object.create(Phaser.BitmapText.prototype),e.MultiLineText.prototype.constructor=e.MultiLineText,e.MultiLineText.prototype.splitText=function(t,e){for(var i=t,s=[],a=0,n=0;i.length>0;)if(a=n,-1==(n=i.indexOf(" ",n+1))?this.setText(i):this.setText(i.substring(0,n)),this.updateText(),this.width>e){if(0==a&&-1==n){s.push(i),i="",n=0;continue}if(0==a){s.push(i.substring(0,n)),i=i.substring(n+1),n=0;continue}s.push(i.substring(0,a)),i=i.substring(a+1),n=0}else-1==n&&(s.push(i),i="");this.setText(s.join("\n"))},e.MultiLineText.prototype.popUpAnimation=function(){this.cacheAsBitmap=!1;for(var t=this.children.length,e=[],i=0;i<t;i++)e[i]=i;e=Phaser.ArrayUtils.shuffle(e),delay_index=0,this.activeTweens=0,this.children.forEach((function(t){0==t.anchor.x&&(t.x=t.x+.5*t.width,t.y=t.y+t.height,t.anchor.setTo(.5,1));var i=t.scale.x;t.scale.setTo(0,0),this.activeTweens++;var s=game.add.tween(t.scale).to({x:1.5*i,y:1.5*i},200,Phaser.Easing.Quadratic.In,!1,25*e[delay_index]).to({x:i,y:i},200,Phaser.Easing.Sinusoidal.In);s.onComplete.add((function(){this.activeTweens--,0==this.activeTweens&&this.alive&&(this.cacheAsBitmap=!0)}),this),s.start(),delay_index++}),this)},e.OneLineText=function(t,i,s,a,n,o,r,h){if(Phaser.BitmapText.call(this,game,e.l(t),e.l(i),s,a,e.l(n),e.l(o)),o)for(;this.width>e.l(o)&&(this.fontSize-=2,this.updateText(),!(this.fontSize<5)););this.orgFontSize=e.l(n),this.maxUserWidth=e.l(o),this.skipCaching=e.skipOneLineTextCaching||!1,this.hAnchor=r,this.vAnchor=h,this.anchor.setTo(this.hAnchor,this.vAnchor),this.updateText(),this.insertCoin(this.fontSize),this.skipCaching||(this.cacheAsBitmap=!0,this.updateCache())},e.OneLineText.prototype=Object.create(Phaser.BitmapText.prototype),e.OneLineText.prototype.constructor=e.OneLineText,e.OneLineText.prototype.insertCoin=function(t){-1!=this.text.indexOf("$$")&&this.children.forEach((function(i,s,a){if(i.name&&"$"==i.name&&i.visible&&s+1<=a.length-1&&"$"==a[s].name){var n=i,o=a[s+1];n.visible=!1,o.visible=!1,coin=e.makeImage(n.x+.05*t,n.y-.05*t,"coin"),coin.width=t,coin.height=t,n.parent.addChild(coin)}}))},e.OneLineText.prototype.setText=function(t){Phaser.BitmapText.prototype.setText.call(this,t.toString());var e=this.scale.x,i=this.scale.y,s=this.alpha,a=this.angle;if(this.alpha=1,this.scale.setTo(1),this.maxUserWidth){this.fontSize=this.orgFontSize,this.updateText();for(;this.width>this.maxUserWidth&&(this.fontSize-=1,this.updateText(),!(this.fontSize<5)););}!this.skipCaching&&this.cacheAsBitmap&&this.updateCache(),this.scale.setTo(e,i),this.alpha=s,this.angle=a},e.OneLineText.prototype.popUpAnimation=function(){this.cacheAsBitmap=!1;for(var t=this.children.length,e=[],i=0;i<t;i++)e[i]=i;e=Phaser.ArrayUtils.shuffle(e),delay_index=0,this.activeTweens=0,this.children.forEach((function(t){0==t.anchor.x&&(t.x=t.x+.5*t.width,t.y=t.y+t.height,t.anchor.setTo(.5,1));var i=t.scale.x;t.scale.setTo(0,0),this.activeTweens++;var s=game.add.tween(t.scale).to({x:1.5*i,y:1.5*i},200,Phaser.Easing.Quadratic.In,!1,25*e[delay_index]).to({x:i,y:i},200,Phaser.Easing.Sinusoidal.In);s.onComplete.add((function(){this.activeTweens--,0==this.activeTweens&&this.alive&&!this.skipCaching&&(this.cacheAsBitmap=!0)}),this),s.start(),delay_index++}),this)},e.OneLineText.prototype.scaleOut=function(t,e){this.cacheAsBitmap=!1,this.activeTweens=0,this.children.forEach((function(t,e){0==t.anchor.x&&(t.x=t.x+.5*t.width,t.y=t.y+.5*t.height,t.anchor.setTo(.5,.5)),this.activeTweens++,t.scale.setTo(t.scale.x,t.scale.y);var i=game.add.tween(t.scale).to({x:0,y:0},400,Phaser.Easing.Cubic.In,!1,20*e);i.onComplete.add((function(){this.activeTweens--,0==this.activeTweens&&this.destroy()}),this),i.start()}),this)},e.OneLineCounter=function(t,i,s,a,n,o,r,h,l,d){e.OneLineText.call(this,t,i,s,"",n,o,r,h),this.amount=a,this.amountDisplayed=a,this.amountMaxInterval=5,this.amountMaxNegInterval=-5,this.absoluteDisplay=!1,this.fixedToDecimal=0,this.stepCurrent=0,this.step=0,this.preText=l||"",this.postText=d||"",this.setText(this.preText+a+this.postText)},e.OneLineCounter.prototype=Object.create(e.OneLineText.prototype),e.OneLineCounter.prototype.update=function(){if(this.lerp)this.lerpUpdate();else if(this.amountDisplayed!=this.amount&&this.stepCurrent--<=0&&(this.stepCurrent=this.step,this.amountDisplayed!=this.amount)){var t=this.amount-this.amountDisplayed;this.amountDisplayed+=game.math.clamp(t,this.amountMaxNegInterval,this.amountMaxInterval);var e=this.amountDisplayed;this.absoluteDisplay&&(e=Math.abs(e)),0!=this.fixedTo&&(e=e.toFixed(this.fixedToDecimal)),this.setText(this.preText+e+this.postText)}},e.OneLineCounter.prototype.changeAmount=function(t){this.amount=t},e.OneLineCounter.prototype.increaseAmount=function(t){this.amount+=t},e.OneLineCounter.prototype.changeIntervals=function(t,e){void 0===e?(this.amountMaxInterval=t,this.amountMaxNegInterval=-t):(this.amountMaxInterval=t,this.amountMaxNegInterval=e)},e.OneLineCounter.prototype.lerpUpdate=function(){this.amountDisplayed!=this.amount&&this.stepCurrent--<=0&&(this.stepCurrent=this.step,this.amountDisplayed=Math.round(e.lerp(this.amountDisplayed,this.amount,.5,.6)),this.setText(this.amountDisplayed.toString()))},e.PartCacher=function(){Phaser.Group.call(this,game),this.active=!1,this.every=1,this.rt=game.add.renderTexture(10,10),this.frameCounter=0,this.framesToRecord=null},e.PartCacher.prototype=Object.create(Phaser.Group.prototype),e.PartCacher.prototype.update=function(){if(this.active){if(this.stepForward(),!this.checkChildren())return this.active=!1,void this.removeAll(!0,!0);this.frameCounter%this.frameRate==0&&(this.saveFrame(),this.frameNr++,null!==this.framesToRecord&&(this.framesToRecord--,0==this.framesToRecord&&(this.active=!1))),this.frameCounter++}},e.PartCacher.prototype.stepForward=function(){for(var t=this.children.length;t--;)this.children[t].update()},e.PartCacher.prototype.start=function(t,e,i){this.fileName=t,this.frameNr=0,this.frameRate=60/e,this.active=!0,this.frameCounter=0,this.framesToRecord=i||null},e.PartCacher.prototype.saveFrame=function(){var t=this.getBounds(),e=Math.max(this.x-t.x,t.x+t.width-this.x,400),i=Math.max(this.y-t.y,t.y+t.height-this.y,400);this.rt.resize(2*e,2*i,!0),this.rt.renderXY(this,e,i,!0);var s=this.rt.getCanvas(),a=this.fileName+"_"+this.frameNr;s.toBlob((function(t){saveAs(t,a)}))},e.PartCacher.prototype.checkChildren=function(){var t=this.children.filter((function(t){return!t.alive||0===t.alpha||0==t.scale.x||0==t.scale.y}));return this.children.length!==t.length},e.PoolGroup=function(t,i,s,a){if(Phaser.Group.call(this,game),this._deadArray=[],this._elementConstructor=t,this._argumentsArray=i||[],this._argumentsArray.unshift(null),s&&e.sb(s).add(this.init,this),a)for(var n=0;n<a;n++)element=new(Function.prototype.bind.apply(this._elementConstructor,this._argumentsArray)),this.add(element),element.events.onKilled.add(this._onElementKilled,this),element.kill()},e.PoolGroup.prototype=Object.create(Phaser.Group.prototype),e.PoolGroup.prototype.getFreeElement=function(){var t;return this._deadArray.length>0?t=this._deadArray.pop():(t=new(Function.prototype.bind.apply(this._elementConstructor,this._argumentsArray))).events.onKilled.add(this._onElementKilled,this),this.add(t),t},e.PoolGroup.prototype._onElementKilled=function(t){this===t.parent&&(this._deadArray.push(t),this.removeChild(t))},e.PoolGroup.prototype.init=function(){var t=this.getFreeElement();return t.init.apply(t,arguments),t},e.PoolGroup.prototype.initBatch=function(t){for(var e=0;e<t;e++)this.init.apply(this,[].slice.call(arguments,1))},e.PreloaderBar=function(){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.gfx=game.add.graphics(),this.add(this.gfx),this.drawProgress(0),e.sb("onScreenResize").add(this.onResize,this),this.onResize(),game.load.onFileComplete.add(this.drawProgress,this)},e.PreloaderBar.prototype=Object.create(Phaser.Group.prototype),e.PreloaderBar.prototype.onResize=function(){this.cameraOffset.x=.5*game.width,this.cameraOffset.y=.4*game.height},e.PreloaderBar.prototype.drawProgress=function(t){this.gfx.clear(),this.gfx.lineStyle(2,16777215,1),this.gfx.beginFill(0,1),this.gfx.drawRect(-150,0,300,50),this.gfx.beginFill(16777215,1),this.gfx.drawRect(-145,5,t/100*290,40)},e.ProgressBar=function(t,i,s,a,n,o,r){e.Image.call(this,t,i,s+"_empty",0,null),o=void 0===o?0:o,r=void 0===r?0:o,this.fill=e.makeImage(o,r,s+"_full",0,this),this.fillFullWidth=this.fill.width,this.fillOverlay=e.makeImage(o,r,s+"_full_overlay",this.fill,this),this.fillOverlay.alpha=0,this.fill.cropRect=new Phaser.Rectangle(0,0,0,this.fill.height),this.fill.updateCrop(),this.currentValue=a,this.prevCurrentValue=a,this.targetValue=a,this.maxValue=n,this.lerpValue=.05,this.updateBarCrop(),this.onTargetReached=new Phaser.Signal,this.onBarFilled=new Phaser.Signal},e.ProgressBar.prototype=Object.create(e.Image.prototype),e.ProgressBar.prototype.update=function(){this.currentValue!==this.targetValue&&(this.currentValue=e.lerp(this.currentValue,this.targetValue,this.lerpValue,.005*this.maxValue),this.currentValue===this.targetValue&&this.onTargetReached.dispatch()),this.currentValue!==this.prevCurrentValue&&(this.updateBarCrop(),this.currentValue===this.maxValue&&(game.add.tween(this.fillOverlay).to({alpha:1},300,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0),this.onBarFilled.dispatch(),this.label&&game.add.tween(this.label).to({alpha:0},600,Phaser.Easing.Sinusoidal.InOut,!0)),this.label&&Math.floor(this.currentValue)!==Math.floor(this.prevCurrentValue)&&this.label.updateValue(Math.floor(this.currentValue))),this.prevCurrentValue=this.currentValue},e.ProgressBar.prototype.updateBarCrop=function(){var t=this.fill.cropRect.width,e=Math.round(this.fillFullWidth*(this.currentValue/this.maxValue));t!==e&&(this.fill.cropRect.width=e,this.fill.updateCrop())},e.ProgressBar.prototype.changeCurrentValue=function(t,e){this.targetValue=game.math.clamp(t,0,this.maxValue),this.lerpValue=e||this.lerpValue},e.ProgressBar.prototype.increaseCurrentValue=function(t){this.changeCurrentValue(this.targetValue+(t||1))},e.ProgressBar.prototype.decreaseCurrentValue=function(t){this.changeCurrentValue(this.targetValue-(t||1))},e.ProgressBar.prototype.changeValues=function(t,e){this.currentValue=t,this.prevCurrentValue=t,this.targetValue=t,this.maxValue=e,this.label&&this.label.changeValues(t,e),this.updateBarCrop()},e.ProgressBar.prototype.addLabel=function(t,i){this.label=new e.ProgressBar.Label(e.rl(.5*this.width),e.rl(.5*this.height),this.currentValue,this.maxValue,Math.floor(.6*e.rl(this.height)),e.rl(.7*this.width),t,i),this.add(this.label)},e.ProgressBar.Label=function(t,i,s,a,n,o,r,h){e.OneLineText.call(this,t,i,"font","",n,o,.5,.5),this.labelType=r||0,this.labelType1Text=e.txt("%AMOUNT% left"),this.currentValue=s,this.maxValue=a,this.animationOnIncrease=h||!1,this.updateValue(this.currentValue,!0)},e.ProgressBar.Label.prototype=Object.create(e.OneLineText.prototype),e.ProgressBar.Label.prototype.updateValue=function(t,i){(i||Math.min(t,this.maxValue)!==this.currentValue)&&(this.currentValue=t,this.updateLabelText(),!i&&this.animationOnIncrease&&(e.stopTweens(this),this.scale.setTo(1),game.add.tween(this.scale).to({x:1.2,y:1.2},200,Phaser.Easing.Sinusoidal.InOut,!0,0,0,!0)))},e.ProgressBar.Label.prototype.changeValues=function(t,e){this.currentValue=t,this.maxValue=e,this.alpha=this.currentValue<this.maxValue?1:0,this.updateLabelText()},e.ProgressBar.Label.prototype.updateLabelText=function(){0==this.labelType?this.setText(this.currentValue+"/"+this.maxValue):this.setText(this.labelType1Text.replace("%AMOUNT%",this.maxValue-this.currentValue))},void 0===e&&(e={}),e.SignalBox=function(){Phaser.Signal.prototype.addPermanent||(Phaser.Signal.prototype.addPermanent=function(){var t=this.add.apply(this,arguments);return t._PERMANENT=!0,t},Phaser.Signal.prototype.removeNonPermanent=function(){if(this._bindings)for(var t=this._bindings.length;t--;)this._bindings[t]._PERMANENT||(this._bindings[t]._destroy(),this._bindings.splice(t,1))});var t=!1,e={};function i(){Object.keys(e).forEach((function(t){e[t].removeNonPermanent()}))}function s(s){return t||game.state.onStateChange.add(i,this),e[s]||(e[s]=new Phaser.Signal),e[s]}return s.signals=e,s.clearNonPermanent=i,s.clearAll=function(){Object.keys(e).forEach((function(t){e[t].removeAll()}))},s}(),e.Slider=function(t,e,i,s){Phaser.Graphics.call(this,game,t,e),this.sliderWidth=i,this.pos=s,this.beginFill(0,1),this.drawRect(0,-2,this.sliderWidth,4),this.circleGfx=this.addChild(game.make.graphics(i*s,0)),this.circleGfx.clear(),this.circleGfx.lineStyle(1,0,1),this.circleGfx.beginFill(10066329,1),this.circleGfx.drawCircle(0,0,32),this.circleGfx.sliderWidth=i,this.circleGfx.inputEnabled=!0,this.circleGfx.input.useHandCursor=!0,this.circleGfx.input.draggable=!0,this.circleGfx.input.setDragLock(!0,!1)},e.Slider.prototype=Object.create(Phaser.Graphics.prototype),e.Slider.prototype.update=function(){this.circleGfx.x=game.math.clamp(this.circleGfx.x,0,this.sliderWidth),this.pos=this.circleGfx.x/this.sliderWidth},e.SliderPanel=function(t,i,s,a,n,o){Phaser.Group.call(this,game),this.sliderWidth=e.l(s),this.sliderHeight=e.l(a),this.x=t+-.5*this.sliderWidth,this.y=i+-.5*this.sliderHeight,this.gfxMask=game.add.graphics(),this.gfxMask.beginFill(0,1),this.gfxMask.drawRect(0,0,s,a),this.clickableObjects=[],this.config=o,this.applyConfig(this.config),this.addContent(n),this.add(this.gfxMask),this.contentGroup.mask=this.gfxMask,this.slideY=0,this.inputSprite=e.makeImage(0,0,null,0,this),this.inputSprite.inputEnabled=!0,this.inputSprite.hitArea=new Phaser.Rectangle(0,0,s,a),this.inputSpriteDown=!1,this.inputData={x:null,y:null,velX:0,velY:0,xStart:null,yStart:null,startFrameStamp:null,clickDistanceWindow:10,clickTimeWindow:10},this.inputSprite.events.onInputDown.add((function(t){var e=game.input.activePointer;this.inputSpriteDown=!0,this.inputData.x=this.inputData.xStart=e.worldX,this.inputData.y=this.inputData.yStart=e.worldY,this.inputData.startFrameStamp=this.frameCounter}),this),this.inputSprite.events.onInputUp.add((function(){var t=game.input.activePointer;this.inputSpriteDown=!1;var e=game.math.distance(this.inputData.xStart,this.inputData.yStart,t.worldX,t.worldY),i=this.frameCounter-this.inputData.startFrameStamp;e<=this.inputData.clickDistanceWindow&&i<=this.inputData.clickTimeWindow&&(this.propagateClick(t.x,t.y),this.inputData.velX=0,this.inputData.velY=0)}),this),this.frameCounter=0},e.SliderPanel.prototype=Object.create(Phaser.Group.prototype),e.SliderPanel.prototype.applyConfig=function(t){this.horizontal=t.horizontal||!1,this.horizontalLerp=t.horizontalLerp||!1,this.vertical=t.vertical||!0,this.verticalLerp=t.verticalLerp},e.SliderPanel.prototype.addContent=function(t){this.changeInputSettings(t),this.contentGroup=t,this.add(t),this.contentGroup.x=0,this.contentGroupMinY=-this.contentGroup.height+this.sliderHeight,this.contentGroupMaxY=0,this.contentGroupMinX=this.sliderWidth-this.contentGroup.width,this.contentGroupMaxX=0},e.SliderPanel.prototype.changeInputSettings=function(t){for(var e=t.children.length;e--;){var i=t.children[e];i.inputEnabled&&(this.clickableObjects.push(i),i.inputEnabled=!1),i.children.length>0&&this.changeInputSettings(i)}},e.SliderPanel.prototype.update=function(){if(this.frameCounter++,this.inputSpriteDown&&game.input.activePointer.isDown){var t=this.inputData.x-game.input.activePointer.worldX,e=this.inputData.y-game.input.activePointer.worldY;this.inputData.x=game.input.activePointer.worldX,this.inputData.y=game.input.activePointer.worldY,this.inputData.velX=.8*t+.2*this.inputData.velX,this.inputData.velY=.8*e+.2*this.inputData.velY,this.horizontal&&(this.contentGroup.x-=this.inputData.velX),this.vertical&&(this.contentGroup.y-=this.inputData.velY)}else this.horizontal&&(this.contentGroup.x-=this.inputData.velX,this.inputData.velX*=.95,Math.abs(this.inputData.velX)<1&&(this.inputData.velX=0)),this.vertical&&(this.contentGroup.y-=this.inputData.velY,this.inputData.velY*=.95,Math.abs(this.inputData.velY)<1&&(this.inputData.velY=0));this.vertical&&this.boundRestrict("y",this.verticalLerp,this.contentGroupMinY,this.contentGroupMaxY),this.horizontal&&this.boundRestrict("x",this.horizontalLerp,this.contentGroupMinX,this.contentGroupMaxX),this.boundRestrict()},e.SliderPanel.prototype.propagateClick=function(t,e){for(var i=0;i<this.clickableObjects.length;i++)if(this.clickableObjects[i].visible&&this.clickableObjects[i].getBounds().contains(t,e)){this.clickableObjects[i].onInputDown.dispatch();break}},e.SliderPanel.prototype.boundRestrict=function(t,i,s,a){i?(this.contentGroup[t]>a&&(this.contentGroup[t]=e.lerp(this.contentGroup[t],a,.5),this.contentGroup[t]<a+1&&(this.contentGroup[t]=a)),this.contentGroup[t]<s&&(this.contentGroup[t]=e.lerp(this.contentGroup[t],s,.2),this.contentGroup[t]>s-1&&(this.contentGroup[t]=s))):this.contentGroup[t]=game.math.clamp(this.contentGroup[t],s,a)},e.StrObjGroup=function(t,e,i){Phaser.Group.call(this,game),this.x=t||0,this.y=e||0,this.importObj="string"==typeof i?JSON.parse(i):i,this.parseImportObj(this.importObj)},e.StrObjGroup.prototype=Object.create(Phaser.Group.prototype),e.StrObjGroup.prototype.parseImportObj=function(t){for(var i=0;i<t.length;i++){var s=t[i],a=e.makeImage(s.x,s.y,s.frame,s.anchor,this);a.scale.setTo(s.scale[0],s.scale[1]),a.angle=s.angle}},e.Text=function(t,i,s,a,n,o,r,h,l){a=JSON.parse(JSON.stringify(e.Text.styles[a]));this.userMaxWidth=o||1/0,this.userMaxHeight=r||1/0,h&&(a.wordWrap=!0,a.wordWrapWidth=width),Phaser.Text.call(this,game,t,i,s,a),n&&("number"==typeof n?this.anchor.setTo(n):this.anchor.setTo(n[0],n[1])),this.width=Math.min(this.width,this.userMaxWidth),this.height=Math.min(this.height,this.userMaxHeight)},e.Text.prototype=Object.create(Phaser.Text.prototype),e.Text.styles={},e.Text.addStyle=function(t,i){e.Text.styles[t]=i},e.Text.prototype.setText=function(t){Phaser.Text.prototype.setText.call(this,t),this.scale.setTo(1),this.width=Math.min(this.width,this.userMaxWidth),this.height=Math.min(this.height,this.userMaxHeight)},e.TextRTCacher=function(){},e.TextRTCacher.prototype.cacheText=function(t,e,i,s,a){this.txt||(this.txt=game.make.bitmapText(0,0,t,"",80)),this.txt.fontSize=i,this.txt.setText(e),this.txt.tint=a||16777215,this.txt.updateCache(),game.make.renderTexture(this.txt.width,this.txt.height,s,!0).render(this.txt)},e.TextRTCacher.prototype.cachePhaserText=function(t,e,i){var s=game.make.text(0,0,t,i);game.make.renderTexture(s.width,s.height,e,!0).render(s),s.destroy()},e.Timer=function(t,i,s,a,n,o,r){e.OneLineText.call(this,t,i,s,"???",a,n,o,r),this.secLeft=0,this.active=!1,this.timerBinding=e.sb.onWallClockTimeUpdate.add(this.updateTimer,this),this.events.onDestroy.add((function(){this.timerBinding.detach()}),this)},e.Timer.prototype=Object.create(e.OneLineText.prototype),e.Timer.prototype.updateTimer=function(){this.active&&(e.sfx.clock_tick.play(),this.secLeft=Math.max(0,this.secLeft-1),this.setText(e.changeSecToTimerFormat(this.secLeft)))},e.Timer.prototype.setSecLeft=function(t){this.secLeft=t,this.setText(e.changeSecToTimerFormat(this.secLeft))},e.Timer.prototype.start=function(t){this.active=!0},e.UITargetParticles=function(){e.PoolGroup.call(this,e.UITargetParticle)},e.UITargetParticles.prototype=Object.create(e.PoolGroup.prototype),e.UITargetParticles.prototype.initPart=function(t,e,i,s,a,n){return this.init(t,e,i,s,a)},e.UITargetParticles.prototype.createDividedBatch=function(t,i,s,a,n,o){var r=new e.UITargetParticles.BatchObj,h=h||25;n/o>h&&(o=Math.ceil(n/h));for(var l=Math.floor(n/o)+Math.sign(n%o),d=0;d<l;d++){var u=this.init(t,i,s,a,Math.min(o,n));n-=o,r.add(u)}return r},e.UITargetParticles.prototype.createBatch=function(t,i,s,a,n,o){for(var r=new e.UITargetParticles.BatchObj,h=Array.isArray(t),l=0;l<o;l++){if(h)var d=this.init(t[l].x,t[l].y,s,a,n);else d=this.init(t,i,s,a,n);r.add(d)}return r},e.UITargetParticles.BatchObj=function(){this.parts=[],this.nrOfParts=0,this.nrOfFinished=0,this.onFinish=new Phaser.Signal},e.UITargetParticles.BatchObj.prototype.add=function(t){this.parts.push(t),t.onFinish.addOnce(this.onPartFinish,this),this.nrOfParts++},e.UITargetParticles.BatchObj.prototype.onPartFinish=function(){this.nrOfFinished++,this.nrOfFinished==this.nrOfParts&&this.onFinish.dispatch()},e.UITargetParticles.BatchObj.prototype.addOnPartStart=function(t,e){this.parts.forEach((function(i){i.onStart.addOnce(t,e||i,1)}))},e.UITargetParticles.BatchObj.prototype.addOnPartFinish=function(t,e){this.parts.forEach((function(i){i.onFinish.addOnce(t,e||i,1)}))},e.UITargetParticles.BatchObj.prototype.start=function(t){var e=0;this.parts.forEach((function(i){i.start(e),e+=t||0}))},e.UITargetParticle=function(){e.Image.call(this,0,0,null,.5),this.onStart=new Phaser.Signal,this.onFinish=new Phaser.Signal,this.speed=0,this.speedMax=30,this.speedDelta=.75,this.vel=new Phaser.Point(0,0),this.velInit=new Phaser.Point(0,0),this.kill()},e.UITargetParticle.prototype=Object.create(e.Image.prototype),e.UITargetParticle.prototype.init=function(t,e,i,s,a){this.position.setTo(t,e),this.changeTexture(i),this.onStart.removeAll(),this.onFinish.removeAll(),this.carriedValue=a||1,this.targetObj=s,this.stopTweens(this),this.scale.setTo(1),this.alpha=1,this.speed=0,this.vel.setTo(0,0)},e.UITargetParticle.prototype.start=function(t){t?game.time.events.add(t,this.start,this):(this.revive(),this.onStart.dispatch(this,this.carriedValue))},e.UITargetParticle.prototype.update=function(){if(this.alive){this.position.add(this.vel.x,this.vel.y),this.vel.x*=.95,this.vel.y*=.95,this.speed+=this.speedDelta,this.speed=Math.min(this.speed,this.speedMax);var t=Phaser.Point.distance(this.position,this.targetObj.worldPosition),i=Phaser.Point.angle(this.targetObj.worldPosition,this.worldPosition);this.position.add(e.lengthDirX(i,Math.min(t,this.speed),!0),e.lengthDirY(i,Math.min(t,this.speed),!0)),t<this.speedMax&&(this.onFinish.dispatch(this,this.carriedValue),this.kill())}},void 0===e&&(e={}),Math.sign=Math.sign||function(t){return 0===(t=+t)||isNaN(t)?t:t>0?1:-1},e.isImageInCache=function(t){return""!=this.checkSheet(t)||game.cache.checkImageKey(t)},e.checkSheet=function(t){return e.spritesheetMap?e.spritesheetMap[t]||"":this.checkSheetOld()},e.checkSheetOld=function(){for(var t=0,i=e.ASSETS.spritesheets.length;t<i;t++){e.ASSETS.spritesheets[t];if(game.cache.checkImageKey(e.ASSETS.spritesheets[t])&&game.cache.getFrameData(e.ASSETS.spritesheets[t]).getFrameByName(frame))return e.ASSETS.spritesheets[t]}return""},e.lerp=function(t,e,i,s){return s&&Math.abs(t-e)<=s?e:t+i*(e-t)},e.l=function(t){return Math.floor(t*e.Loader.currentConfigMulti)},e.rl=function(t){return Math.floor(t*(1/e.Loader.currentConfigMulti))},e.lnf=function(t){return t*e.Loader.currentConfigMulti},e.rnd=function(t,e){return game.rnd.realInRange(t||0,e||1)},e.rndInt=function(t,e){return game.rnd.between(t,e)},e.changeTexture=function(t,e){if("string"!=typeof e)return t.loadTexture(e);var i=this.checkSheet(e);""==i?t.loadTexture(e):t.loadTexture(i,e)},e.txt=function(t){return e.lang||(e.lang="en"),e.json.languages[e.lang]||(e.lang="en"),e.json.languages[e.lang][t]||t+"***"},e.deltaTime=1,e.delta=function(){e.deltaTime=Math.min(1.5,game.time.elapsedMS/16),17==game.time.elapsedMS&&(e.deltaTime=1)},e.rotatePositions=function(t){for(var e=[],i=0,s=t.length;i<s;i+=2)e.push(-1*t[i+1],t[i]);return e},e.loadTexture=e.changeTexture,e.makeImage=function(t,e,i,s,a){var n,o=this.checkSheet(i);return n=""==o?game.make.image(this.l(t),this.l(e),i):game.make.image(this.l(t),this.l(e),o,i),s&&("number"==typeof s?n.anchor.setTo(s):n.anchor.setTo(s[0],s[1])),a?(a.add||a.addChild).call(a,n):null!==a&&game.world.add(n),n},e.capitalize=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},e.lengthDirX=function(t,e,i){return(i=i||!1)?Math.cos(t)*e:Math.cos(game.math.degToRad(t))*e},e.lengthDirY=function(t,e,i){return(i=i||!1)?Math.sin(t)*e:Math.sin(game.math.degToRad(t))*e},e.stopTweens=function(t){game.tweens._tweens.forEach((function(e){t.scale&&e.target==t.scale&&e.stop(),e.target==t&&e.stop()}))},e.makeExtImage=function(t,i,s,a,n,o,r,h){var l;if(e.extLoader||(e.extLoader=new e.ExtLoader(game)),e.extLoader.loadedUrls[s])return l=e.makeImage(t,i,e.extLoader.loadedUrls[s],n,o),h.call(l),l;(l=e.makeImage(t,i,a,n,o)).onImgLoaded=new Phaser.Signal,e.extImagesKeys||(e.extImagesKeys=[]);var d="extImgBlankName"+e.extImagesKeys.length;e.extImagesKeys.push(d);var u=e.extLoader.onFileComplete.add((function(t,i,a){i==d&&a&&(e.extLoader.loadedUrls[s]=d,e.changeTexture(l,d),h&&h.call(l),u.detach())}));return e.extLoader.image(d,s,!0),l},e.drawCircleSegment=function(t,i,s,a,n,o,r){if(n===o)return t;void 0===r&&(r=10);var h=(o-n)/r;t.moveTo(i,s);for(var l=t.currentPath.shape.points;n<=o;n+=h)l.push(Math.floor(i+e.lengthDirX(n,a,!1)),Math.floor(s+e.lengthDirY(n,a,!1)));return l.push(Math.floor(i+e.lengthDirX(o,a,!1)),Math.floor(s+e.lengthDirY(o,a,!1))),t.dirty=!0,t._boundsDirty=!0,t},e.centerElements=function(t,i,s){void 0===s&&(s=0),void 0===i&&(i=[]);var a=0;t.forEach((function(t,s){a+=t.width,void 0!==i[s-1]&&(a+=e.l(i[s-1]))}));var n=s+-.5*a;t.forEach((function(t,s,a){t.x=n,t.x+=t.width*t.anchor.x,n+=t.width,void 0!==i[s]&&(n+=e.l(i[s]))}))},e.makeMover=function(t){void 0!==e.activeMover&&(e.activeMover.destroy(),e.activeMover.eKey.onDown.removeAll()),e.activeMover=game.add.image(),e.activeMover.obj=t,e.activeMover.cursors=game.input.keyboard.createCursorKeys(),e.activeMover.shiftKey=game.input.keyboard.addKey(Phaser.Keyboard.SHIFT),e.activeMover.eKey=game.input.keyboard.addKey(Phaser.Keyboard.E),e.activeMover.eKey.onDown.add((function(){}),e.activeMover),e.activeMover.update=function(){var e=this.shiftKey.isDown?10:2;this.cursors.down.isDown&&(t.y+=e),this.cursors.up.isDown&&(t.y-=e),this.cursors.left.isDown&&(t.x-=e),this.cursors.right.isDown&&(t.x+=e)}},e.makeLineEditor=function(t){var i=game.add.group();return i.interpolation=t||"linear",i.pointsX=[0],i.pointsY=[0],i.gfx=i.add(game.make.graphics()),i.shiftKey=game.input.keyboard.addKey(Phaser.Keyboard.SHIFT),i.wKey=game.input.keyboard.addKey(Phaser.Keyboard.W),i.wKey.onDown.add((function(){var t,i;this.children.length>2?(t=this.children[this.children.length-1].x,i=this.children[this.children.length-1].y):(t=0,i=0);var s=e.makeImage(t,i,"candy_1");s.anchor.setTo(.5),s.scale.setTo(.1),this.add(s),this.activeObject=s,this.changed=!0}),i),i.qKey=game.input.keyboard.addKey(Phaser.Keyboard.Q),i.qKey.onDown.add((function(){this.children.length<=2||(this.removeChildAt(this.children.length-1),this.children.length>3?this.activeObject=this.children[this.children.length-1]:this.activeObject=null,this.changed=!0)}),i),i.aKey=game.input.keyboard.addKey(Phaser.Keyboard.A),i.aKey.onDown.add((function(){if(this.activeObject){var t=this.getChildIndex(this.activeObject);2!=t&&(this.activeObject=this.getChildAt(t-1))}}),i),i.sKey=game.input.keyboard.addKey(Phaser.Keyboard.S),i.sKey.onDown.add((function(){if(this.activeObject){var t=this.getChildIndex(this.activeObject);t!=this.children.length-1&&(this.activeObject=this.getChildAt(t+1))}}),i),i.eKey=game.input.keyboard.addKey(Phaser.Keyboard.E),i.eKey.onDown.add((function(){}),i),i.cursors=game.input.keyboard.createCursorKeys(),i.activeObject=null,i.preview=e.makeImage(0,0,"candy_2",.5,i),i.preview.width=8,i.preview.height=8,i.preview.progress=0,i.update=function(){if(null!==this.activeObject&&(this.forEach((function(t){t==this.activeObject?t.alpha=1:t.alpha=.5}),this),0!=this.children.length)){var t=this.shiftKey.isDown?3:1;if(this.cursors.down.isDown&&(this.activeObject.y+=t,this.changed=!0),this.cursors.up.isDown&&(this.activeObject.y-=t,this.changed=!0),this.cursors.left.isDown&&(this.activeObject.x-=t,this.changed=!0),this.cursors.right.isDown&&(this.activeObject.x+=t,this.changed=!0),i.preview.progress+=.01,i.preview.progress>1&&(i.preview.progress=0),i.preview.x=game.math[this.interpolation+"Interpolation"](this.pointsX,i.preview.progress),i.preview.y=game.math[this.interpolation+"Interpolation"](this.pointsY,i.preview.progress),this.changed){var e=[],s=[];this.pointsX=e,this.pointsY=s,this.children.forEach((function(t,i){i<=1||(e.push(t.x),s.push(t.y))})),this.gfx.clear(),this.gfx.beginFill(16711680,1);for(var a=0;a<200;a++)this.gfx.drawRect(game.math[this.interpolation+"Interpolation"](e,a/200),game.math[this.interpolation+"Interpolation"](s,a/200),3,3)}}},i},e.lineUtils={getWholeDistance:function(t,e){for(var i=0,s=1;s<t.length;s++)i+=game.math.distance(t[s-1],e[s-1],t[s],e[s]);return i},findPointAtDitance:function(t,i,s){for(var a=0,n=1;n<t.length;n++){var o=game.math.distance(t[n-1],i[n-1],t[n],i[n]);if(o+a>s){var r=game.math.angleBetween(t[n-1],i[n-1],t[n],i[n]);return[t[n-1]+e.lengthDirX(r,s-a,!0),i[n-1]+e.lengthDirY(r,s-a,!0)]}a+=o}return[t[t.length-1],i[i.length-1]]},spreadAcrossLine:function(t,e,i,s,a){for(var n=this.getWholeDistance(t,e)/(i.length-1),o=0;o<i.length;o++){var r=this.findPointAtDitance(t,e,n*o);i[o][s||"x"]=r[0],i[o][a||"y"]=r[1]}},spreadOnNodes:function(t,e,i,s,a){for(var n=0;n<t.length;n++){if(void 0===i[n])return;i[n][s||"x"]=t[n],i[n][a||"y"]=e[n]}}},e.changeSecToTimerFormat=function(t){var e=parseInt(t,10),i=Math.floor(e/3600),s=Math.floor((e-3600*i)/60),a=e-3600*i-60*s;return i<10&&(i="0"+i),s<10&&(s="0"+s),a<10&&(a="0"+a),0==i?s+":"+a:i+":"+s+":"+a},e.arrayJoin=function(t,e){return t.reduce((function(t,i){return i?t?t+e+i:i:t}),"")},e.makeTextButton=function(t,e,i,s,a,n){var o=game.make.text(t,e,i,s);return o.inputEnabled=!0,o.input.useHandCursor=!0,o.hitArea=new Phaser.Rectangle(0,0,o.width,o.height),o.events.onInputDown.add(a,n||null),o},e.setObjProp=function(t,e,i){var s=t;"string"==typeof e&&e.split(".");try{for(var a=0;a<this.refreshProp.length-1;a++)s=s[this.refreshProp[a]];s[this.refreshProp[this.refreshProp.length-1]]=i}catch(t){}},e.getObjProp=function(t,e){var i=t;"string"==typeof e&&e.split(".");try{for(var s=0;s<e.length;s++)i=i[e[s]]}catch(t){return}return i},void 0===e&&(e={}),e.Utils={cacheText:function(t,e,i,s,a){(e=game.make.bitmapText(0,0,i,e,s)).tint=a||16777215,e.updateCache(),game.make.renderTexture(e.width,e.height,t,!0).render(e),e.destroy()},lerp:function(t,e,i,s){return s&&Math.abs(t-e)<=s?e:t+i*(e-t)},copyToClipboard:function(t){this.copyArea||(this.copyArea=document.createElement("textarea"),this.copyArea.style.positon="fixed",this.copyArea.style.opacity=0,document.body.appendChild(this.copyArea)),this.copyArea.value=t,this.copyArea.select(),document.execCommand("copy")},getObjProp:function(t,e){var i=t;"string"==typeof e&&(e=e.split("."));try{for(var s=0;s<e.length;s++)i=i[e[s]]}catch(t){return}return i},setObjProp:function(t,e,i){var s=t;"string"==typeof e&&(e=e.split("."));try{for(var a=0;a<e.length-1;a++)s=s[e[a]];s[e[e.length-1]]=i}catch(t){return null}},replaceAll:function(t,e,i){return t.split(e).join(i)},removeDuplicates:function(t){var e=[];return t.forEach((function(t){-1===e.indexOf(t)&&e.push(t)})),e},arraysEqual:function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}},e.lineCircleColl=function(t,e,i){var s=t.start,a=t.end,n=Math.sqrt(Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2)),o=(a.x-s.x)/n,r=(a.y-s.y)/n,h=o*(e.x-s.x)+r*(e.y-s.y),l=h*o+s.x,d=h*r+s.y,u=Math.sqrt(Math.pow(l-e.x,2)+Math.pow(d-e.y,2));if(u<e.radius){var p=Math.sqrt(e.radius*e.radius-u*u),c=(h-p)*o+s.x,g=(h-p)*r+s.y,m=(h+p)*o+s.x,f=(h+p)*r+s.y,y=game.math.distance(s.x,s.y,c,g),b=game.math.distance(s.x,s.y,m,f);return y<b?t.length>y&&(i.setTo(c,g),i):t.length>b&&(i.setTo(m,f),i)}return!1},e.getRT=function(t){var e=game.cache.getRenderTexture(t);return e?e.texture:null},e.numberDot=function(t){for(var e="",i=0,s=(t=t.toString()).length-1;s>=0;s--)e=t[s]+e,3==++i&&0!==s&&(e="."+e,i=0);return e},e.AnimationElement=function(t,i,s,a){e.Image.call(this,t,i,null),this.ANIMATIONELEMENT=!0,this.SPR=new e.Image(0,0,null,.5,this),this.frameCounter=0,this.data=s,this.currentAnimationData=null,this.currentAnimationName=null,this.playing=void 0===a||a},e.AnimationElement.prototype=Object.create(e.Image.prototype),e.AnimationElement.prototype.update=function(){this.currentAnimationName&&this.playing&&(this.frameCounter++,this.updateAnimation(this.frameCounter))},e.AnimationElement.prototype.pause=function(){this.playing=!1},e.AnimationElement.prototype.resume=function(){this.playing=!0},e.AnimationElement.prototype.play=function(){this.playing=!0},e.AnimationElement.prototype.stop=function(){this.playing=!1,this.updateAnimation(0)};e.AnimationElement.prototype.changeAnimationData=function(t){this.data[t]||(t=Object.keys(this.data)[0]),this.eventTL=this.data[t].eventTL,this.frameTL=this.data[t].frameTL,this.propTLS=this.data[t].propTLS,this.propKeys=Object.keys(this.propTLS),this.currentAnimationData=this.data[t],this.currentAnimationName=t,this.updateAnimation(0)},e.AnimationElement.prototype.playAnimation=function(t){this.changeAnimationData(t),this.playing=!0},e.AnimationElement.prototype.getLastKeyFrame=function(t,e){for(var i=t.length,s=0;s<i;s++){if(t[s].f==e||s==i-1)return t[s];if(t[s].f<e&&e<t[s+1].f)return t[s]}},e.AnimationElement.prototype.getNextKeyFrame=function(t,e){for(var i=t.length,s=0;s<i;s++)if(t[s].f>t||s==i-1)return t[s]},e.AnimationElement.prototype.getKeyFrameAt=function(t,e){if(!this.currentAnimationName)return null;for(var i=0;i<t.length;i++){var s=t[i];if(s.f===e)return s}return null},e.AnimationElement.prototype.isAnyKeyFrameAt=function(t){if(!this.currentAnimationName)return!1;if(this.getKeyFrameAt(this.eventTL,t))return!0;if(this.getKeyFrameAt(this.frameTL,t))return!0;for(var e=0;e<this.propKeys.length;e++){var i=this.propKeys[e];if(this.getKeyFrameAt(this.propTLS[i],t))return!0}return!1},e.AnimationElement.prototype.getFrameValue=function(t,e){var i=this.getLastKeyFrame(t,e),s=this.getNextKeyFrame(t,e);if(i.e){var a=s.f-i.f,n=s.v-i.v,o=Phaser.Easing[i.e[0]][i.e[1]]((e-i.f)/a);return i.v+n*o}return i.v},e.AnimationElement.prototype.updateAnimation=function(t){if(this.currentAnimationName){this.frameCounter=t,this.updateFromPropTLS(t);var i=this.getTextureFrameValue(this.frameTL,t);this.SPR.key!=i&&this.SPR.frameName!=i&&e.changeTexture(this.SPR,i)}},e.AnimationElement.prototype.updateFromPropTLS=function(t){for(var e=0;e<this.propKeys.length;e++){var i=this.propKeys[e];this.setProp(i,this.getFrameValue(this.propTLS[i],t))}},e.AnimationElement.prototype.setProp=function(t,e){"scale.x"==t?this.SPR.scale.x=e:"scale.y"==t?this.SPR.scale.y=e:"anchor.x"==t?this.SPR.anchor.x=e:"anchor.y"==t?this.SPR.anchor.y=e:this.SPR[t]=e},e.AnimationElement.prototype.getTextureFrameValue=function(t,e){var i=this.getLastKeyFrame(t,e),s=i.frameSkip||1,a=e-i.f;if(a=Math.floor(a/s),!i.animation)return i.v;var n=i.v.length;return i.loop?i.refraction||i.reverse?i.refraction&&!i.reverse?i.v[Math.min(n-1,a%(n+i.refraction))]:void 0:i.v[a%n]:i.v[Math.min(n-1,a)]},e.GroupColliderLineLine=function(t,i,s,a){e.Image.call(this,0,0,null),this.group1=t,this.group2=i,this.callback=s,this.context=a||null,this.collPoint=new Phaser.Point(0,0)},e.GroupColliderLineLine.prototype=Object.create(e.Image.prototype),e.GroupColliderLineLine.prototype.update=function(){for(var t=this.group1.length,e=this.group2.length,i=0;i<t;i++)for(var s=this.group1.children[i],a=0;a<e;a++){var n=this.group2.children[a];s!==n&&(s.collLine.intersects(n.collLine,!0,this.collPoint)&&this.callback.call(this.context,s,n,this.collPoint,this.group1,this.group2))}},e.GroupColliderLineCircle=function(t,i,s,a){e.Image.call(this,0,0,null),this.group1=t,this.group2=i,this.callback=s,this.context=a||null,this.collPoint=new Phaser.Point(0,0)},e.GroupColliderLineCircle.prototype=Object.create(e.Image.prototype),e.GroupColliderLineCircle.prototype.update=function(){this.group1.length,this.group2.length;for(var t=this.group1.length;t--;)for(var i=this.group1.children[t],s=this.group2.length;s--;){var a=this.group2.children[s];i!==a&&(e.lineCircleColl(i.collLine,a.collCircle,this.collPoint)&&this.callback.call(this.context,i,a,this.collPoint,this.group1,this.group2))}},Phaser.Group.prototype.destroy=function(t,e){null===this.game||this.ignoreDestroy||(void 0===t&&(t=!0),void 0===e&&(e=!1),this.onDestroy.dispatch(this,t,e),this.removeAll(t),this.cursor=null,this.filters=null,this.alive=!1,this.pendingDestroy=!1,e||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))},Phaser.exportChildren=function(t){for(var e=[],i=0;i<t.children.length;i++){var s=t.children[i];s.exportToString&&e.push(s.exportToString())}return e},Phaser.Group.prototype.exportToString=function(){return{type:"GROUP",x:this.x,y:this.y,scale:[this.scale.x,this.scale.y],angle:this.angle,children:Phaser.exportChildren(this)}},Phaser.Image.prototype.exportToString=function(){return exportObj={type:"IMG",x:this.x,y:this.y,frame:this.frameName,anchor:[this.anchor.x,this.anchor.y],scale:[this.scale.x,this.scale.y],angle:this.angle,children:Phaser.exportChildren(this)},exportObj},e.OneLineText=function(t,i,s,a,n,o,r,h,l){if(!l&&"ar"==e.lang)return(a=game.make.text(t,i,a,{fontSize:n,fill:"white"})).anchor.setTo(r,0),o&&(a.width=Math.min(o,a.width)),a;if(Phaser.BitmapText.call(this,game,e.l(t),e.l(i),s,a,e.l(n),e.l(o)),o)for(;this.width>e.l(o)&&(this.fontSize-=2,this.updateText(),!(this.fontSize<5)););this.orgFontSize=e.l(n),this.maxUserWidth=e.l(o),this.skipCaching=e.skipOneLineTextCaching||!1,this.hAnchor=r,this.vAnchor=h,this.anchor.setTo(this.hAnchor,this.vAnchor),this.updateText(),this.insertCoin(this.fontSize),this.skipCaching||(this.cacheAsBitmap=!0,this.updateCache())},e.OneLineText.prototype=Object.create(Phaser.BitmapText.prototype),e.OneLineText.prototype.constructor=e.OneLineText,e.OneLineText.prototype.insertCoin=function(t){-1!=this.text.indexOf("$$")&&this.children.forEach((function(i,s,a){if(i.name&&"$"==i.name&&i.visible&&s+1<=a.length-1&&"$"==a[s].name){var n=i,o=a[s+1];n.visible=!1,o.visible=!1,coin=e.makeImage(n.x+.05*t,n.y-.05*t,"coin"),coin.width=t,coin.height=t,n.parent.addChild(coin)}}))},e.OneLineText.prototype.setText=function(t){Phaser.BitmapText.prototype.setText.call(this,t.toString());var e=this.scale.x,i=this.scale.y,s=this.alpha,a=this.angle;if(this.alpha=1,this.scale.setTo(1),this.maxUserWidth){this.fontSize=this.orgFontSize,this.updateText();for(;this.width>this.maxUserWidth&&(this.fontSize-=1,this.updateText(),!(this.fontSize<5)););}!this.skipCaching&&this.cacheAsBitmap&&this.updateCache(),this.scale.setTo(e,i),this.alpha=s,this.angle=a},e.OneLineText.prototype.popUpAnimation=function(){this.cacheAsBitmap=!1;for(var t=this.children.length,e=[],i=0;i<t;i++)e[i]=i;e=Phaser.ArrayUtils.shuffle(e),delay_index=0,this.activeTweens=0,this.children.forEach((function(t){0==t.anchor.x&&(t.x=t.x+.5*t.width,t.y=t.y+t.height,t.anchor.setTo(.5,1));var i=t.scale.x;t.scale.setTo(0,0),this.activeTweens++;var s=game.add.tween(t.scale).to({x:1.5*i,y:1.5*i},200,Phaser.Easing.Quadratic.In,!1,25*e[delay_index]).to({x:i,y:i},200,Phaser.Easing.Sinusoidal.In);s.onComplete.add((function(){this.activeTweens--,0==this.activeTweens&&this.alive&&!this.skipCaching&&(this.cacheAsBitmap=!0)}),this),s.start(),delay_index++}),this)},e.OneLineText.prototype.scaleOut=function(t,e){this.cacheAsBitmap=!1,this.activeTweens=0,this.children.forEach((function(t,e){0==t.anchor.x&&(t.x=t.x+.5*t.width,t.y=t.y+.5*t.height,t.anchor.setTo(.5,.5)),this.activeTweens++,t.scale.setTo(t.scale.x,t.scale.y);var i=game.add.tween(t.scale).to({x:0,y:0},400,Phaser.Easing.Cubic.In,!1,20*e);i.onComplete.add((function(){this.activeTweens--,0==this.activeTweens&&this.destroy()}),this),i.start()}),this)},e.OneLineCounter=function(t,i,s,a,n,o,r,h,l,d){e.OneLineText.call(this,t,i,s,"",n,o,r,h,!0),this.amount=a,this.amountDisplayed=a,this.amountMaxInterval=5,this.amountMaxNegInterval=-5,this.absoluteDisplay=!1,this.fixedToDecimal=0,this.stepCurrent=0,this.step=0,this.preText=l||"",this.postText=d||"",this.setText(this.preText+a+this.postText)},e.OneLineCounter.prototype=Object.create(e.OneLineText.prototype),e.OneLineCounter.prototype.update=function(){if(this.amountDisplayed!=this.amount&&this.stepCurrent--<=0&&(this.stepCurrent=this.step,this.amountDisplayed!=this.amount)){var t=this.amount-this.amountDisplayed;this.amountDisplayed+=game.math.clamp(t,this.amountMaxNegInterval,this.amountMaxInterval);var e=this.amountDisplayed;this.absoluteDisplay&&(e=Math.abs(e)),0!=this.fixedTo&&(e=e.toFixed(this.fixedToDecimal)),this.setText(this.preText+e+this.postText)}},e.OneLineCounter.prototype.changeAmount=function(t){this.amount=t},e.OneLineCounter.prototype.increaseAmount=function(t){this.amount+=t},e.OneLineCounter.prototype.changeIntervals=function(t,e){void 0===e?(this.amountMaxInterval=t,this.amountMaxNegInterval=-t):(this.amountMaxInterval=t,this.amountMaxNegInterval=e)},void 0===e&&(e={}),e.ASSETS={spritesheets:["bassin","bf_parts","butterflies","butterflies-highlight","butterflies-shadow","buttons","mainmenu","popup","ssheet"],sfx:["bg_noise.mp3","boom.mp3","btn_pressed.mp3","firework2.mp3","game_over.mp3","game_won.mp3","hint.mp3","match.mp3","music.mp3","new_highscore.mp3","new_level.mp3","pop.mp3","score_counter.mp3","shuffle.mp3","stone_selection.mp3","timer.mp3"],images:["game_background.png","game_field_t.png","game_field_t_water.png","game_field_water_highlights.png","main_menu_backgrouind.png","main_menu_logo-ja.png","main_menu_logo.png","pause_background.png"],json:["languages.json","levels.json","settings.json"],fonts:{"font-ja":{data:"font-ja.fnt",frame:"font-ja.png"},font:{data:"font.fnt",frame:"font.png"}}},e.Boot=function(t){},e.Boot.prototype={init:function(){"ja"==e.lang?(e.ASSETS.images.splice(e.ASSETS.images.indexOf("main_menu_logo.png"),1),delete e.ASSETS.fonts.font):(e.ASSETS.images.splice(e.ASSETS.images.indexOf("main_menu_logo-ja.png"),1),delete e.ASSETS.fonts["font-ja"]),game.device.desktop||(e.ASSETS=e.MOBILEASSETS,e.Loader.currentConfig="mobile"),this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.stage.backgroundColor=0,this.input.maxPointers=1,this.stage.disableVisibilityChange=!0,game.tweens.frameBased=!0,game.time.advancedTiming=!0,e.sb=e.SignalBox,e.extLoader=new e.ExtLoader(game),this.scaleGameSizeUpdate=function(){game.device.desktop?game.scale.setGameSize(1400,800):game.scale.setGameSize(540,960),e.sb("onScreenResize").dispatch()},game.resizeGame=this.scaleGameSizeUpdate,this.scale.setResizeCallback((function(){e.old_w==window.innerWidth&&e.old_h==window.innerHeight||(e.old_w=window.innerWidth,e.old_h=window.innerHeight,game.resizeGame(),this.game.device.desktop||(window.innerHeight<window.innerWidth?(e.orientated=!1,document.getElementById("orientation").style.display="block"):(e.orientated=!0,document.getElementById("orientation").style.display="none")))})),game.resizeGame()},preload:function(){},create:function(){this.state.start("Preloader")}},Phaser.Stage.prototype.visibilityChange=function(t){"pagehide"!==t.type&&"blur"!==t.type&&"pageshow"!==t.type&&"focus"!==t.type?document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||"pause"===t.type?(e.muteOnBlur=game.sound.mute,game.sound.mute=!0):game.sound.mute=void 0===e.muteOnBlur||e.muteOnBlur:"pagehide"===t.type||"blur"===t.type?this.game.focusLoss(t):"pageshow"!==t.type&&"focus"!==t.type||this.game.focusGain(t)},e.MainMenuButtons=function(t,i){Phaser.Group.call(this,game),this.position.setTo(t,i),this.playBtn=new e.Button(0,50,"button_play",this.onPlay,this),this.playBtn.setFrames("button_play","button_play_pressed"),this.moreGamesBtn=new e.Button(-200,0,"button_other_games",this.onMoreGames,this),this.moreGamesBtn.setFrames("button_other_games","button_other_games_pressed"),this.moreGamesBtn.visible=!1,this.soundBtn=new e.Button(200,0,game.sound.mute?"button_sound_off":"button_sound_on",this.onSound,this),game.sound.mute?this.soundBtn.setFrames("button_sound_off","button_sound_off_pressed"):this.soundBtn.setFrames("button_sound_on","button_sound_on_pressed"),this.addMultiple([this.playBtn,this.moreGamesBtn,this.soundBtn])},e.MainMenuButtons.prototype=Object.create(Phaser.Group.prototype),e.MainMenuButtons.prototype.onPlay=function(){this.ignoreChildInput=!0,e.sb("onPlayButtonPressed").dispatch()},e.MainMenuButtons.prototype.onMoreGames=function(){window.sdkHandler.trigger("triggerMoreGames")},e.MainMenuButtons.prototype.onSound=function(){game.sound.mute=!game.sound.mute,game.sound.mute?this.soundBtn.setFrames("button_sound_off","button_sound_off_pressed"):this.soundBtn.setFrames("button_sound_on","button_sound_on_pressed")},e.Game=function(t){},e.Game.prototype={init:function(t){this.lvlNr=e.saveState.data.progress[0];var i=e.json.levels.length;if(this.lvlNr<i)this.lvlData=e.json.levels[this.lvlNr];else{var s=this.lvlNr-i,a=["None","Left","Right","LeftRight","Up","Down","UpDown"],n=s%a.length,o=42+s;o>62&&(o=62);var r=[[!1,!1,!1,!1],[!0,!1,!1,!1],[!1,!0,!1,!1],[!1,!1,!0,!1],[!1,!1,!1,!0],[!0,!0,!1,!1],[!0,!1,!0,!1],[!0,!1,!1,!0],[!1,!0,!0,!1],[!1,!0,!1,!0],[!1,!1,!0,!0],[!0,!0,!0,!1],[!0,!0,!1,!0],[!0,!1,!0,!0],[!1,!0,!0,!0],[!0,!0,!0,!0]],h=s%r.length;this.lvlData={nrOfTypes:o,blockedSides:r[h],fallType:a[n]}}this.hintsNr=e.saveState.data.progress[2],this.shuffleNr=e.saveState.data.progress[5],this.pause=!1},create:function(){if(e.sfx.new_level.play(),s=game.state.getCurrentState(),e.sfx.bg_noise.play("",0,.1,!0,!1),this.bg=e.makeImage(0,0,"game_background",0),this.fxLayer=new e.PoolGroup(e.FxPart,null,"fxBg",5),this.waterDropDropper=new e.WaterDropDropper,this.floatingBg=new e.FloatingBg(470,90),this.blockerLayer=new e.BlockerLayer,game.device.desktop?this.ui=new e.GameUI:this.ui=new e.GameUIMobile,this.board=new e.Board(this.lvlData),this.blockerLayer.init(this.board),this.shadows=game.add.group(),this.shadows2=game.add.group(),this.flyAwayGroup=game.add.group(),this.flyAwayGroup.position.setTo(this.board.x+15,this.board.y+17),this.board.flyAwayGroup=this.flyAwayGroup,0===e.saveState.data.progress[0]&&(this.handTut=new e.HandTutorial(this.board)),e.paused=!1,e.sb("onPause").add((function(){e.paused=!0,e.stopTweens(this.shadows2),game.add.tween(this.shadows2).to({alpha:0},300,Phaser.Easing.Sinusoidal.In,!0)}),this),e.sb("onUnpause").add((function(){e.paused=!1,e.stopTweens(this.shadows2),game.add.tween(this.shadows2).to({alpha:1},300,Phaser.Easing.Sinusoidal.Out,!0)}),this),this.uiTargetParticles=new e.UITargetParticles,this.ff=new e.Firefly,this.dragonfly=new e.Dragonfly,this.fxLayer=new e.PoolGroup(e.FxPart,null,"fx",5),this.blockerMsg=new e.BlockerMsg,this.pauseScreen=new e.PauseScreen,this.rewardWindow=new e.RewardWindow,game.camera.flash(0,500,!0),e.sb("onTimesUp").add(this.onTimesUp,this),e.sb("onBoardEmpty").add(this.onBoardEmpty,this),e.sb("onBonusTimeZero").add(this.onBonusTimeZero,this),this.every=30,this.current=30,this.autoSave=!0,game.time.events.add(50,(function(){game.scale.setGameSize(game.width,game.height)})),-1!==window.location.hash.indexOf("DEBUG")){var t=game.input.keyboard.createCursorKeys();t.left.onDown.add((function(){e.saveState.resetProgress(),e.saveState.data.progress[0]=this.lvlNr-1,game.state.start("Game",!0,!1,this.lvlNr-1)}),this),t.right.onDown.add((function(){e.saveState.resetProgress(),e.saveState.data.progress[0]=this.lvlNr+1,game.state.start("Game",!0,!1,this.lvlNr+1)}),this),game.input.onDown.add((function(t){t.x<200&&t.y<200&&(e.saveState.data.highscore=0,s.ui.timeController.timeCurrent=1)})),this.DEBUG=!0}},update:function(){this.autoSave&&this.current--<0&&this.board.idle&&(e.saveState.save(),this.current=this.every)},onTimesUp:function(){e.sfx.game_over.play(),this.autoSave=!1,this.board.update=function(){this.flyAwayGroup.update()};var t=e.saveState.getPoints();e.saveState.resetProgress(),game.time.events.add(500,(function(){new e.GameOverWindow(t)}),this)},onBoardEmpty:function(){e.sfx.game_won.play(),this.autoSave=!1,e.saveState.levelEnd(!0)},onBonusTimeZero:function(){game.time.events.add(500,(function(){e.saveState.savePoints(),new e.LevelPassedWindow}),this)},render:function(){this.DEBUG&&game.debug.text(game.time.fps,10,30,"#ff0000","30px Verdana")},dropArea:function(){var t=[],e=game.add.graphics(),i={};game.input.onDown.add((function(t){i.x=t.x,i.y=t.y})),game.input.onUp.add((function(s){var a=[i.x,i.y,s.x-i.x,s.y-i.y];t.push(a),e.beginFill(16711680,.3),e.drawRect(a[0],a[1],a[2],a[3])})),game.input.keyboard.addKey(Phaser.Keyboard.E).onDown.add((function(){}))}},e.GameProto=function(t){},e.GameProto.prototype={create:function(){s=game.state.getCurrentState(),this.gfx=game.add.graphics(),this.grid=new e.GridArray(10,10,!1),this.grid.loop((function(t,e,i,s){s[e][i]=game.rnd.between(1,10)})),this.drawGfx(),this.keyX=game.input.keyboard.addKey(Phaser.Keyboard.X),this.keyX.onDown.add((function(){var t=game.input.activePointer;xx=Math.floor(t.x/40),yy=Math.floor(t.y/40),this.grid.set(xx,yy,!1),this.drawGfx()}),this)},drawGfx:function(){this.gfx.clear(),this.grid.loop((function(t,e,i){this.gfx.beginFill([0,16711680,10035712,65280,8840,5570815,21879,16711935,6736998,10039903,16724575][t],1),this.gfx.drawRect(40*e,40*i,40,40)}),this)},findMatch:function(t,e,i,s){if(this.grid.get(t,e)!==this.grid.get(i,s))return!1;if(t==i&&e==s)return!1;if(1==this.getDistanceBetweenCells([t,e],[i,s]))return[[t,e],[i,s]];var a=this.getRaysForCell(t,e),n=this.getRaysForCell(i,s),o=this.findRoutes(a,n);return 0!=o.length&&this.getShortestFullRoute([t,e],[i,s],o)},getShortestFullRoute:function(t,e,i){var s=i.filter((function(t){return 1==t.length}));return s[0]?[t,s[0][0],e]:i.filter((function(t){return 2==t.length})).map((function(i){var s=this.getDistanceBetweenCells(t,i[0])+this.getDistanceBetweenCells(i[0],i[1])+this.getDistanceBetweenCells(i[1],e);return{route:[t,i[0],i[1],e],routeLength:s}}),this).sort((function(t,e){return t.routeLength>e.routeLength}))[0].route},getDistanceBetweenCells:function(t,e){return Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])},findRoutes:function(t,i){var s=[];return t.forEach((function(t){i.forEach((function(i){return e.Utils.arraysEqual(t,i)?s.push([t]):this.isSpaceBetweenFree(t,i)?s.push([t,i]):void 0}),this)}),this),s},isSpaceBetweenFree:function(t,e){if(t[0]==e[0]){for(var i=Math.min(t[1],e[1]),s=Math.max(t[1],e[1]),a=i;a<s;a++)if(this.grid.get(t[0],a))return!1;return!0}if(t[1]==e[1]){for(i=Math.min(t[0],e[0]),s=Math.max(t[0],e[0]),a=i;a<s;a++)if(this.grid.get(a,t[1]))return!1;return!0}return!1},getRaysForCell:function(t,e){var i=this.getRayInDir(t,e,0,-1),s=this.getRayInDir(t,e,0,1),a=this.getRayInDir(t,e,-1,0),n=this.getRayInDir(t,e,1,0);return[].concat(i,s,a,n)},getRayInDir:function(t,e,i,s){for(var a=[];!this.grid.get(t+i,e+s)&&(t+=i,e+=s,a.push([t,e]),this.grid.isInGrid(t,e)););return a},getAllPossibleMoves:function(){var t={};this.grid.loop((function(e,i,s){e&&!t[e]&&(t[e]=[],this.grid.loop((function(i,s,a){i===e&&t[e].push([s,a])})))}),this);var e=[];for(val in t)for(var i=t[val],s=i.length,a=0;a<s;a++)for(var n=i[a],o=a+1;o<s;o++){var r=i[o];this.findMatch(n[0],n[1],r[0],r[1])&&e.push([n,r])}return e},render:function(){var t=game.input.activePointer;xx=Math.floor(t.x/40),yy=Math.floor(t.y/40),game.debug.text(xx+"x"+yy,10,10,"#ffffff")}},e.MainMenu=function(t){},e.MainMenu.prototype={create:function(){s=game.state.getCurrentState(),e.sfx.bg_noise.isPlaying&&e.sfx.bg_noise.fadeOut(300),this.bg=e.makeImage(0,0,"main_menu_backgrouind",0),this.fxLayer=new e.PoolGroup(e.FxPart,null,"fx",5),game.device.desktop&&(this.waterDropper=new e.WaterDropDropperMM);for(var t=0;t<20;t++)new e.FireflyMM;game.device.desktop&&(this.butterfly=new e.MainMenuButterfly(1e3,280));var i=game.device.desktop?380:270,a=game.device.desktop?600:630;this.buttons=new e.MainMenuButtons(i,a);var n=game.device.desktop?280:260;this.logo=new e.MainMenuLogo(i,n);var o=game.device.desktop?1030:270,r=game.device.desktop?712:870;this.highscoreShadow=e.makeImage(o,r,"highscore_shadow",.5),this.highscoreShadow.alpha=.8,this.highscore=new e.LabelValue(o,r-32,e.txt(1),e.saveState.data.highscore.toString(),50,70),this.highscoreShadow.width=600,game.camera.flash(0,500,!0),e.sb("onPlayButtonPressed").add(this.onPlay,this),e.FXON=!0,game.time.events.add(50,(function(){game.scale.setGameSize(game.width,game.height)}))},onPlay:function(){e.stopTweens(this.logo),game.add.tween(this.logo).to({alpha:0},500,Phaser.Easing.Sinusoidal.In,!0),game.add.tween(this.buttons).to({alpha:0},500,Phaser.Easing.Sinusoidal.In,!0),game.time.events.add(200,(function(){game.camera.fade(0,300,!0),game.camera.onFadeComplete.addOnce((function(){game.state.start("Game")}),this)}),this)}},void 0===e&&(e={}),e.MOBILEASSETS={spritesheets:["bassin","bf_parts","butterflies","butterflies-highlight","butterflies-shadow","buttons","mainmenu","popup","ssheet"],sfx:["bg_noise.mp3","boom.mp3","btn_pressed.mp3","firework2.mp3","game_over.mp3","game_won.mp3","hint.mp3","match.mp3","music.mp3","new_highscore.mp3","new_level.mp3","pop.mp3","score_counter.mp3","shuffle.mp3","stone_selection.mp3","timer.mp3"],images:["board.png","game_background.png","main_menu_backgrouind.png","main_menu_logo-ja.png","main_menu_logo.png","pause_background.png"],json:["languages.json","levels.json","settings.json"],fonts:{"font-ja":{data:"font-ja.fnt",frame:"font-ja.png"},font:{data:"font.fnt",frame:"font.png"}}},e.Preloader=function(t){this.ready=!1},e.Preloader.prototype={preload:function(){this.loaderGroup=game.add.group(),this.loaderGroup.position.setTo(.5*game.width,.5*game.height),game.load.onFileComplete.add((function(t){window.sdkHandler.trigger("loading.update",{progressPercentage:t})}),this),e.Loader.loadAssets()},create:function(){"ja"==e.lang&&(game.cache._cache.bitmapFont.font=game.cache._cache.bitmapFont["font-ja"]),e.saveState.init(),e.Utils.cacheText("+sec","+"+e.json.settings.bonusPerSecond.toString(),"font",35,7246254),window.sdkHandler.trigger("loading.completed",{callback:function(){e.sfx.music.play("",0,.2,!0),game.state.start("MainMenu")}},this)},update:function(){}},e.Test=function(t){},e.Test.prototype={create:function(){s=game.state.getCurrentState(),this.borders=game.add.group(),this.test_border=e.makeImage(0,0,"gem_test_border",0),this.top=game.add.group(),this.test=e.makeImage(0,0,"gem_test",0),this.test_border.position=this.test.position,this.cursors=game.input.keyboard.createCursorKeys(),this.cursors.right.onDown.add((function(){this.test.x+=25.5}),this),this.cursors.left.onDown.add((function(){this.test.x-=25.5}),this),this.cursors.up.onDown.add((function(){this.test.y-=36}),this),this.cursors.down.onDown.add((function(){this.test.y+=36}),this),this.addRandom()},addRandom:function(){this.grid=new e.GridArray(10,10);for(var t=0;t<50;t++){var i=game.rnd.between(0,9),s=game.rnd.between(0,9);if(!this.grid.get(i,s)){var a=51+51*i,n=72+72*s,o=e.makeImage(a,n,"gem_test_border",0,this.borders),r=e.makeImage(a,n,"gem_test",0,this.top);o.zz=5*a+1e3*n,r.zz=o.zz}}this.borders.sort("zz",Phaser.Group.SORT_ASCENDING),this.top.sort("zz",Phaser.Group.SORT_ASCENDING)}},e.Board=function(t){var i,s;Phaser.Group.call(this,game),game.device.desktop?(this.position.setTo(470,90),i=e.json.settings.boardSize[0],s=e.json.settings.boardSize[1],this.tileSize=e.json.settings.tileSize):(this.position.setTo(58,157),i=e.json.settings.mobileBoardSize[0],s=e.json.settings.mobileBoardSize[1],this.tileSize=e.json.settings.mobileTileSize),this.moves=[],this.grid=new e.GridArray(i,s,!1),this.tileWidth=this.tileSize[0],this.tileHeight=this.tileSize[1],this.blockedTop=t.blockedSides[0]||!1,this.blockedBottom=t.blockedSides[2]||!1,this.blockedLeft=t.blockedSides[3]||!1,this.blockedRight=t.blockedSides[1]||!1,this.inGridBlockers=t.inGridBlockers||[],this.nrOfTypes=t.nrOfTypes,this.gemTypes=this.makeGemArray(),this.cacheGroup=game.make.group(),this.cacheGroup.visible=!1,this.rtLayer=new e.RTLayer(this,this.cacheGroup,!0),this.add(this.rtLayer),this.moveable=game.add.group(),this.add(this.moveable),this.rtLayer.position.setTo(15,17),this.moveable.position.setTo(15,17),e.saveState.data.progress[0]>0?this.fillBoard():this.loadSnapshot(),this.inputMgr=new e.BoardInputMgr(this),this.inputMgr.position.setTo(15,17),this.add(this.inputMgr),this.boardHint=new e.BoardHint(this),this.boardHint.position.setTo(15,17),this.add(this.boardHint),this.matcher=new e.BoardMatcher(this),this.fallMgr=new e.BoardFallMgr(this,t.fallType),this.orderRedraw=!0,e.sb("onMoveStart").add(this.onMoveStart,this),e.sb("onMoveFinish").add(this.onMoveFinish,this),e.sb("onSceenResize").add(this.center,this),e.sb("onPause").add(this.onPause,this),e.sb("onUnpause").add(this.onUnpause,this),this.possibleMoves=null,this.onIdle=new Phaser.Signal,this.idle=!1},e.Board.prototype=Object.create(Phaser.Group.prototype),e.Board.prototype.update=function(){for(var t=this.moves.length-1;t>=0;t--)this.moves[t].update();this.fallMgr.update(),this.inputMgr.update(),0==this.moves.length?this.idle||(this.onIdle.dispatch(),this.idle=!0,this.possibleMoves=this.matcher.getAllPossibleMoves(),0==this.possibleMoves.length&&(this.checkWin()?(e.sb("onBoardEmpty").dispatch(!0),this.EMPTY=!0,this.update=function(){}):this.shuffleBoard())):this.idle=!1},e.Board.prototype.postUpdate=function(){this.orderRedraw&&(this.orderRedraw=!1,this.rtLayer.redrawGroup())},e.Board.prototype.processMatch=function(t){e.sb("onProcessMatch").dispatch();var i=this.grid.get(t[0][0],t[0][1]);i.inputLocked=!0;var s=this.grid.get(t[t.length-1][0],t[t.length-1][1]);s.inputLocked=!0,this.moveable.add(s),game.add.tween(i.anchor).to({x:1},800,Phaser.Easing.Sinusoidal.InOut,!0),game.add.tween(i.scale).to({x:-1},800,Phaser.Easing.Sinusoidal.InOut,!0),game.add.tween(s.anchor).to({x:1},800,Phaser.Easing.Sinusoidal.InOut,!0);var a=new e.BoardMoveObject(this,i,t);a.onFinish.add((function(){e.sfx.match.play(),this.grid.set(t[t.length-1][0],t[t.length-1][1],!1),e.sb("onMatch").dispatch(i,s),s.destroy(),i.destroy();var a=new e.ButterflyFlyaway(i.x,i.y,i.matchType);this.flyAwayGroup.add(a),this.flyAwayGroup.sendToBack(a),a.updateTransform(),a.complete(),this.orderRedraw=!0}),this),a.onTurn.addOnce((function(){this.grid.set(t[0][0],t[0][1],!1)}),this)},e.Board.prototype.onMoveStart=function(t){this.moves.push(t),this.moveable.add(t.gem),this.moveable.updateTransform(),this.orderRedraw=!0,this.possibleMoves=null},e.Board.prototype.onMoveFinish=function(t){this.moves.splice(this.moves.indexOf(t),1),t.FALL?(this.cacheGroup.add(t.gem),e.OBSERVE=t.gem,this.orderRedraw=!0,t.gem.inputLocked=!1):this.flyAwayGroup.add(t.gem)},e.Board.prototype.cellToPx=function(t,e){return[t*this.tileWidth,e*this.tileHeight]},e.Board.prototype.fillBoard=function(){for(var t=this.grid.width*this.grid.height-.5*this.inGridBlockers.length,i=[],s=0;s<this.inGridBlockers.length;s+=2){var a=this.inGridBlockers[s],n=this.inGridBlockers[s+1];this.grid.set(a,n,"BLOCKED")}for(s=0;s<t;s+=2){var o=this.gemTypes[s%this.gemTypes.length];i.push(o,o)}Phaser.ArrayUtils.shuffle(i),this.grid.loop((function(t,s,a,n){"BLOCKED"!==t&&(n[s][a]=new e.Gem(this,s,a,i.pop()),this.cacheGroup.add(n[s][a]))}),this)},e.Board.prototype.center=function(){this.x=Math.floor(.5*(game.width-this.grid.width*this.tileWidth)),this.y=60+.5*(game.height-800)},e.Board.prototype.onPause=function(t){t||(e.stopTweens(this),game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.In,!0))},e.Board.prototype.onUnpause=function(){e.stopTweens(this),game.add.tween(this).to({alpha:1},300,Phaser.Easing.Sinusoidal.Out,!0)},e.Board.prototype.makeGemArray=function(t){for(var e=[],i=1;i<=62;i++)e.push(i<10?"0"+i:i.toString());return Phaser.ArrayUtils.shuffle(e),e.slice(0,t)},e.Board.prototype.putInRect=function(e,i,s,a){if("object"===t(e)){var n=e;e=n.x,i=n.y,s=n.width,a=n.height}var o=this.floorLayer.width,r=this.floorLayer.height,h=Math.min(s/o,a/r,1);this.scale.setTo(h),this.updateTransform(),o=this.floorLayer.width*h,r=this.floorLayer.height*h,this.x=Math.floor(e+.5*s-.5*o),this.y=Math.floor(i+.5*a-.5*r)},e.Board.prototype.loadSnapshot=function(){var t;t=game.device.desktop?[0,0,"17",0,1,"16",0,2,"61",0,3,"52",0,4,"34",0,5,"46",0,6,"49",0,7,"25",0,8,"27",0,9,"02",1,0,"11",1,1,"12",1,2,"33",1,3,"34",1,4,"27",1,5,"48",1,6,"01",1,7,"25",1,8,"02",1,9,"34",2,0,"19",2,1,"19",2,2,"17",2,3,"32",2,4,"25",2,5,"49",2,6,"61",2,7,"22",2,8,"09",2,9,"33",3,0,"03",3,1,"25",3,2,"39",3,3,"57",3,4,"32",3,5,"18",3,6,"49",3,7,"61",3,8,"15",3,9,"12",4,0,"59",4,1,"39",4,2,"61",4,3,"52",4,4,"32",4,5,"49",4,6,"48",4,7,"01",4,8,"22",4,9,"14",5,0,"33",5,1,"11",5,2,"52",5,3,"54",5,4,"02",5,5,"32",5,6,"57",5,7,"54",5,8,"48",5,9,"09",6,0,"22",6,1,"54",6,2,"02",6,3,"46",6,4,"01",6,5,"59",6,6,"23",6,7,"30",6,8,"61",6,9,"11",7,0,"22",7,1,"39",7,2,"52",7,3,"27",7,4,"03",7,5,"14",7,6,"14",7,7,"23",7,8,"16",7,9,"30",8,0,"15",8,1,"33",8,2,"17",8,3,"12",8,4,"15",8,5,"59",8,6,"13",8,7,"14",8,8,"46",8,9,"19",9,0,"43",9,1,"23",9,2,"13",9,3,"30",9,4,"57",9,5,"22",9,6,"34",9,7,"54",9,8,"30",9,9,"25",10,0,"54",10,1,"14",10,2,"02",10,3,"11",10,4,"33",10,5,"43",10,6,"14",10,7,"13",10,8,"18",10,9,"03",11,0,"22",11,1,"43",11,2,"43",11,3,"12",11,4,"13",11,5,"33",11,6,"59",11,7,"34",11,8,"18",11,9,"34",12,0,"01",12,1,"16",12,2,"23",12,3,"19",12,4,"48",12,5,"09",12,6,"03",12,7,"17",12,8,"57",12,9,"02",13,0,"54",13,1,"39",13,2,"25",13,3,"46",13,4,"09",13,5,"16",13,6,"27",13,7,"61",13,8,"18",13,9,"15"]:[0,0,"11",0,1,"59",0,2,"24",0,3,"13",0,4,"52",0,5,"29",0,6,"04",0,7,"39",0,8,"10",0,9,"02",0,10,"18",0,11,"57",0,12,"34",0,13,"09",1,0,"22",1,1,"59",1,2,"35",1,3,"12",1,4,"09",1,5,"51",1,6,"12",1,7,"45",1,8,"54",1,9,"55",1,10,"14",1,11,"22",1,12,"29",1,13,"33",2,0,"33",2,1,"10",2,2,"55",2,3,"14",2,4,"14",2,5,"14",2,6,"13",2,7,"26",2,8,"28",2,9,"25",2,10,"43",2,11,"48",2,12,"43",2,13,"29",3,0,"52",3,1,"54",3,2,"45",3,3,"54",3,4,"43",3,5,"24",3,6,"10",3,7,"48",3,8,"51",3,9,"25",3,10,"08",3,11,"26",3,12,"25",3,13,"09",4,0,"57",4,1,"02",4,2,"57",4,3,"43",4,4,"08",4,5,"04",4,6,"33",4,7,"34",4,8,"12",4,9,"48",4,10,"48",4,11,"39",4,12,"10",4,13,"33",5,0,"08",5,1,"57",5,2,"24",5,3,"04",5,4,"52",5,5,"24",5,6,"11",5,7,"28",5,8,"16",5,9,"11",5,10,"11",5,11,"16",5,12,"13",5,13,"20",6,0,"39",6,1,"29",6,2,"35",6,3,"22",6,4,"51",6,5,"04",6,6,"18",6,7,"51",6,8,"20",6,9,"09",6,10,"28",6,11,"28",6,12,"18",6,13,"25",7,0,"54",7,1,"20",7,2,"12",7,3,"22",7,4,"26",7,5,"18",7,6,"26",7,7,"45",7,8,"45",7,9,"08",7,10,"52",7,11,"13",7,12,"20",7,13,"39"];for(var i=0;i<t.length;i+=3){var s=t[i],a=t[i+1],n=t[i+2];null!=n&&("B"!==n?(this.grid.set(s,a,new e.Gem(this,s,a,n)),this.cacheGroup.add(this.grid.get(s,a))):this.grid.set(s,a,"BLOCKED"))}},e.Board.prototype.checkWin=function(){return allFalse=!0,this.grid.loop((function(t){t&&"BLOCKED"!==t&&(allFalse=!1)})),allFalse},e.Board.prototype.checkIfBlocker=function(t,e){for(var i=0;i<this.inGridBlockers.length;i+=2)if(t==this.inGridBlockers[i]&&e==this.inGridBlockers[i+1])return!0;return!1},e.Board.prototype.shuffleBoard=function(t){var i=[],s=[];this.duringShuffle=!0,game.time.events.add(850,(function(){this.duringShuffle=!1}),this),this.grid.loop((function(t,e,a){t&&"BLOCKED"!==t&&(s.push(t),i.push([e,a]))}));for(var a=0;0==a||0==this.matcher.getAllPossibleMoves().length;)if(Phaser.ArrayUtils.shuffle(s),i.forEach((function(t,e){var i=s[e];this.grid.set(t[0],t[1],i)}),this),a++>20){e.sb("onTimesUp").dispatch();break}this.grid.loop((function(t,e,i){t&&"BLOCKED"!==t&&this.moveGemTo(t,e,i)}),this),this.possibleMoves=this.matcher.getAllPossibleMoves(),this.inputMgr.deselect(),this.orderRedraw=!0},e.Board.prototype.moveGemTo=function(t,e,i){this.moveable.add(t),this.moveable.updateTransform(),this.orderRedraw=!0,t.inputLocked=!0;var s=this.cellToPx(e,i);game.add.tween(t).to({x:s[0],y:s[1]},800,Phaser.Easing.Sinusoidal.InOut,!0).onComplete.add((function(){t.cellX=e,t.cellY=i,this.cacheGroup.add(t),this.orderRedraw=!0,t.inputLocked=!1}),this)},e.BlockerHighlightLayer=function(t,i){Phaser.Group.call(this,game),this.position.setTo(t,i),this.state=game.state.getCurrentState(),this._deadArray=[],e.sb("onHighlightBlockers").add(this.highlightBlockers,this)},e.BlockerHighlightLayer.prototype=Object.create(Phaser.Group.prototype),e.BlockerHighlightLayer.prototype.getBlockerPosition=function(t,e){var i=this.board.cellToPx(t,e);return game.device.desktop?(i[0]-=-1==e||10==e?15:10,14==t&&(i[0]-=10),i[1]-=10):(-1==t&&(i[1]-=10),8==t&&(i[1]-=10,i[0]-=20),-1==e&&(i[0]-=10),14==e&&(i[0]-=10,i[1]-=20),-1!==t&&8!==t&&-1!==e&&14!==e&&(i[0]-=10,i[1]-=10)),i},e.BlockerHighlightLayer.prototype.highlightBlockers=function(t){for(var e=this.children.length;e--;){var i=this.children[e];i&&i.kill()}t.forEach((function(t){var e=this.getBlockerPosition(t[0],t[1]);this.getFreeElement().show(e[0],e[1])}),this)},e.BlockerHighlightLayer.prototype.getFreeElement=function(){var t;return this._deadArray.length>0?t=this._deadArray.pop():(t=new e.BlockerHighlight).events.onKilled.add(this._onElementKilled,this),this.add(t),t},e.BlockerHighlightLayer.prototype._onElementKilled=function(t){this===t.parent&&(this._deadArray.push(t),this.removeChild(t))},e.BlockerHighlight=function(){e.Image.call(this,0,0,"blocker_lotus_red",0,null)},e.BlockerHighlight.prototype=Object.create(e.Image.prototype),e.BlockerHighlight.prototype.show=function(t,i){e.stopTweens(this),this.alpha=1,this.position.setTo(t,i),this.revive(),game.add.tween(this).to({alpha:0},1500,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add(this.kill,this)},e.BlockerLayer=function(){Phaser.Group.call(this,game),game.device.desktop?this.position.setTo(470,90):this.position.setTo(58,157),this.boardSize=e.json.settings[game.device.desktop?"boardSize":"mobileBoardSize"],this.blockerHighlightLayer=new e.BlockerHighlightLayer(this.x,this.y)},e.BlockerLayer.prototype=Object.create(Phaser.Group.prototype),e.BlockerLayer.prototype.getBlockerPosition=function(t,e){var i=this.board.cellToPx(t,e);return game.device.desktop?(i[0]-=-1==e||10==e?15:10,14==t&&(i[0]-=10),i[1]-=10):(-1==t&&(i[1]-=10),8==t&&(i[1]-=10,i[0]-=20),-1==e&&(i[0]-=10),14==e&&(i[0]-=10,i[1]-=20),-1!==t&&8!==t&&-1!==e&&14!==e&&(i[0]-=10,i[1]-=10)),i},e.BlockerLayer.prototype.blockRow=function(t){for(var i=0;i<this.board.grid.width;i++){var s=this.getBlockerPosition(i,t);e.makeImage(s[0],s[1],"blocker_lotus",0,this)}},e.BlockerLayer.prototype.blockCollumn=function(t){for(var i=0;i<this.board.grid.height;i++){var s=this.getBlockerPosition(t,i);e.makeImage(s[0],s[1],"blocker_lotus",0,this)}},e.BlockerLayer.prototype.init=function(t){this.board=t,this.board.blockedTop&&this.blockRow(-1),this.board.blockedBottom&&this.blockRow(this.boardSize[1]),this.board.blockedLeft&&this.blockCollumn(-1),this.board.blockedRight&&this.blockCollumn(this.boardSize[0]),this.board.inGridBlockers.length>0&&this.blockInGrid(this.board.inGridBlockers),this.cacheAsBitmap=!0,this.blockerHighlightLayer.board=t},e.BlockerLayer.prototype.blockInGrid=function(t){for(var i=0;i<t.length;i+=2){var s=t[i],a=t[i+1],n=this.board.cellToPx(s,a);e.makeImage(n[0]-10,n[1]-10,"blocker_lotus",0,this)}},e.BlockerMsg=function(){Phaser.Group.call(this,game),this.position.setTo(900,370),this.bg=e.makeImage(0,0,"blocker_msg_bg",.5,this),this.msg=new e.OneLineText(0,-40,"font",e.txt(27),50,520,.5,.5),this.add(this.msg),this.alpha=0,this.timeEvent=null,e.sb("onHighlightBlockers").add(this.show,this)},e.BlockerMsg.prototype=Object.create(Phaser.Group.prototype),e.BlockerMsg.prototype.show=function(){e.stopTweens(this),this.timeEvent&&game.time.events.remove(this.timeEvent),game.add.tween(this).to({alpha:1},300,Phaser.Easing.Sinusoidal.Out,!0),this.timeEvent=game.time.events.add(1200,(function(){game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.In,!0)}),this)},e.BoardFallMgr=function(t,e){this.board=t,this.grid=t.grid,this.fallType=e,this.update=this["fallUpdate"+e]},e.BoardFallMgr.prototype.makeFall=function(t,i,s,a){var n=this.grid.get(t,i);this.grid.set(s,a,n),this.grid.set(t,i,!1),n.inputLocked=!0;new e.BoardMoveObject(this.board,n,[[t,i],[s,a]],!0)},e.BoardFallMgr.prototype.fallUpdateNone=function(){},e.BoardFallMgr.prototype.fallUpdateDown=function(){for(var t=0;t<this.grid.width;t++)for(var e=this.grid.height-1;e>=0;e--)if(!this.grid.get(t,e))for(var i=e-1;i>=0;i--){var s=this.grid.get(t,i);if(s){s.inputLocked||this.makeFall(t,i,t,e);break}}},e.BoardFallMgr.prototype.fallUpdateUp=function(){for(var t=0;t<this.grid.width;t++)for(var e=0;e<this.grid.height;e++)if(!this.grid.get(t,e))for(var i=e+1;i<this.grid.height;i++){var s=this.grid.get(t,i);if(s){s.inputLocked||this.makeFall(t,i,t,e);break}}},e.BoardFallMgr.prototype.fallUpdateUpDown=function(){for(var t=0;t<this.grid.width;t++){for(var e=0;e<5;e++)if(!this.grid.get(t,e))for(var i=e+1;i<5;i++){if(s=this.grid.get(t,i)){s.inputLocked||this.makeFall(t,i,t,e);break}}for(e=this.grid.height-1;e>=5;e--)if(!this.grid.get(t,e))for(i=e-1;i>=5;i--){var s;if(s=this.grid.get(t,i)){s.inputLocked||this.makeFall(t,i,t,e);break}}}},e.BoardFallMgr.prototype.fallUpdateRight=function(){for(var t=0;t<this.grid.height;t++)for(var e=this.grid.width-1;e>=0;e--)if(!this.grid.get(e,t))for(var i=e-1;i>=0;i--){var s=this.grid.get(i,t);if(s){s.inputLocked||this.makeFall(i,t,e,t);break}}},e.BoardFallMgr.prototype.fallUpdateLeft=function(){for(var t=0;t<this.grid.height;t++)for(var e=0;e<this.grid.width;e++)if(!this.grid.get(e,t))for(var i=e+1;i<this.grid.width;i++){var s=this.grid.get(i,t);if(s){s.inputLocked||this.makeFall(i,t,e,t);break}}},e.BoardFallMgr.prototype.fallUpdateLeftRight=function(){for(var t=0;t<this.grid.height;t++){for(var e=0;e<7;e++)if(!this.grid.get(e,t))for(var i=e+1;i<7;i++){if(s=this.grid.get(i,t)){s.inputLocked||this.makeFall(i,t,e,t);break}}for(e=this.grid.width-1;e>=7;e--)if(!this.grid.get(e,t))for(i=e-1;i>=7;i--){var s;if(s=this.grid.get(i,t)){s.inputLocked||this.makeFall(i,t,e,t);break}}}},e.BoardHint=function(t){Phaser.Group.call(this,game),this.board=t,game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.highlightHint1=e.makeImage(0,0,null,.5,this),this.highlightHint1.tint=65280,game.add.tween(this.highlightHint1.scale).to({x:1.3,y:1.3},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.highlightHint1.visible=!1,this.highlightHint2=e.makeImage(0,0,null,.5,this),this.highlightHint2.tint=4521796,this.highlightHint2.visible=!1,this.highlightHint2.scale=this.highlightHint1.scale,e.sb("onHint").add(this.showHint,this),e.sb("onProcessMatch").add(this.hideHint,this),e.sb("onShuffle").add(this.hideHint,this)},e.BoardHint.prototype=Object.create(Phaser.Group.prototype),e.BoardHint.prototype.showHint=function(){if(!(this.board.moves.length>0)){var t=game.rnd.pick(this.board.possibleMoves),i=this.board.grid.get(t[0][0],t[0][1]),s=this.board.grid.get(t[1][0],t[1][1]);e.changeTexture(this.highlightHint1,"b_"+i.matchType),e.changeTexture(this.highlightHint2,"b_"+i.matchType),this.highlightHint1.position.set(i.x,i.y),this.highlightHint2.position.set(s.x,s.y),this.highlightHint1.visible=!0,this.highlightHint2.visible=!0}},e.BoardHint.prototype.hideHint=function(){this.highlightHint1.visible=!1,this.highlightHint2.visible=!1},e.BoardInputMgr=function(t){Phaser.Group.call(this,game),this.state=game.state.getCurrentState(),this.selection=e.makeImage(0,0,null,.5,this),this.selection.blendMode=1,this.selection.alpha=.5,this.add(this.selection),this.selection.visible=!1,game.add.tween(this.selection).to({alpha:.2},500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.board=t,this.cell1=null,this.tutorialCells=[],this.locked=!1,this.inputOffset={x:18,y:14},game.input.onDown.add(this.onClick,this),this.pause=!1,e.sb("onPause").add((function(){this.pause=!0}),this),e.sb("onUnpause").add((function(){this.pause=!1}),this),e.sb("onTimesUp").add((function(){this.locked=!0,this.deselect()}),this),e.sb("onHint").add(this.deselect,this)},e.BoardInputMgr.prototype=Object.create(Phaser.Group.prototype),e.BoardInputMgr.prototype.update=function(){this.locked&&(this.cell1=null)},e.BoardInputMgr.prototype.pointerToCell=function(){var t=game.input.activePointer;return[Math.floor((t.x-this.board.worldPosition.x+this.inputOffset.x)/this.board.tileWidth),Math.floor((t.y-this.board.worldPosition.y+this.inputOffset.y)/this.board.tileHeight)]},e.BoardInputMgr.prototype.onClick=function(t){if(!this.pause&&!this.locked){var e=Math.floor((t.x-this.board.worldPosition.x+this.inputOffset.x)/this.board.tileWidth),i=Math.floor((t.y-this.board.worldPosition.y+this.inputOffset.y)/this.board.tileHeight),s=this.board.grid.get(e,i);if("BLOCKED"!==s&&s&&!s.inputLocked)if(null==this.cell1)this.selectCell(e,i);else{var a=this.board.grid.get(this.cell1[0],this.cell1[1]);if(!a)return void this.deselect();if(!this.checkTut(e,i))return;if(a.matchType==s.matchType){var n=this.board.matcher.findMatch(this.cell1[0],this.cell1[1],e,i,!0);n&&this.board.processMatch(n),this.deselect()}else this.selectCell(e,i)}}},e.BoardInputMgr.prototype.selectCell=function(t,i){var s=this.board.grid.get(t,i);s&&this.checkTut(t,i)&&(this.deselect(),this.cell1=[t,i],this.selection.visible=!0,this.selection.position.setTo(s.x,s.y),e.changeTexture(this.selection,"b_"+s.matchType+"_h"),e.sfx.stone_selection.play())},e.BoardInputMgr.prototype.checkTut=function(t,i){return!(this.tutorialCells.length>0)||t===this.tutorialCells[0]&&i===this.tutorialCells[1]&&(this.tutorialCells.splice(0,2),e.sb("onTutorialStep").dispatch(),!0)},e.BoardInputMgr.prototype.deselect=function(){var t;null!==this.cell1&&(t=this.board.grid.get(this.cell1[0],this.cell1[1])),t&&t.visible,this.cell1=null,this.selection.visible=!1},e.BoardInputMgr.prototype.debug=function(){var t=game.add.graphics();t.lineStyle(2,16711680,1),GFX=t;for(var e=this.inputOffset.x,i=this.inputOffset.y,s=0;s<14;s++)t.moveTo(-e+this.board.worldPosition.x+this.board.tileWidth*s,-i+this.board.worldPosition.y),t.lineTo(-e+this.board.worldPosition.x+this.board.tileWidth*s,-i+this.board.worldPosition.y+700);for(var a=0;a<10;a++)t.moveTo(-e+this.board.worldPosition.x,-i+this.board.worldPosition.y+a*this.board.tileHeight),t.lineTo(-e+this.board.worldPosition.x+1e3,-i+this.board.worldPosition.y+a*this.board.tileHeight)},e.BoardMatcher=function(t){this.board=t,this.grid=t.grid,this.boardSize=e.json.settings[game.device.desktop?"boardSize":"mobileBoardSize"]},e.BoardMatcher.prototype.findMatch=function(t,e,i,s,a){if(t==i&&e==s)return!1;if(this.grid.get(t,e).matchType!==this.grid.get(i,s).matchType)return!1;if(1==this.getDistanceBetweenCells([t,e],[i,s]))return[[t,e],[i,s]];var n=this.getRaysForCell(t,e),o=this.getRaysForCell(i,s),r=this.findRoutes(n,o);if(a){var h=this.getRaysForCell(t,e,!0),l=this.getRaysForCell(i,s,!0),d=this.findRoutes(h,l,!0);if(0==r.length&&d.length>0){var u=this.getShortestFullRoute([t,e],[i,s],d);this.highlightBlockers(u)}}return 0!=r.length&&this.getShortestFullRoute([t,e],[i,s],r)},e.BoardMatcher.prototype.getShortestFullRoute=function(t,e,i){var s=i.filter((function(t){return 1==t.length}));return s[0]?[t,s[0][0],e]:i.filter((function(t){return 2==t.length})).map((function(i){var s=this.getDistanceBetweenCells(t,i[0])+this.getDistanceBetweenCells(i[0],i[1])+this.getDistanceBetweenCells(i[1],e);return{route:[t,i[0],i[1],e],routeLength:s}}),this).sort((function(t,e){return t.routeLength-e.routeLength}))[0].route},e.BoardMatcher.prototype.getDistanceBetweenCells=function(t,e){return Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])},e.BoardMatcher.prototype.findRoutes=function(t,i,s){var a=[];return t.forEach((function(t){i.forEach((function(i){return e.Utils.arraysEqual(t,i)?a.push([t]):this.isSpaceBetweenFree(t,i,s)?a.push([t,i]):void 0}),this)}),this),a},e.BoardMatcher.prototype.isSpaceBetweenFree=function(t,e,i){if(t[0]==e[0]){for(var s=Math.min(t[1],e[1]),a=Math.max(t[1],e[1]),n=s;n<a;n++){if(i){if((o=this.grid.get(t[0],n))&&"BLOCKED"!==o)return!1}else if(this.grid.get(t[0],n))return!1}return!0}if(t[1]==e[1]){for(s=Math.min(t[0],e[0]),a=Math.max(t[0],e[0]),n=s;n<a;n++){var o;if(i){if((o=this.grid.get(n,t[1]))&&"BLOCKED"!==o)return!1}else if(this.grid.get(n,t[1]))return!1}return!0}return!1},e.BoardMatcher.prototype.getRaysForCell=function(t,e,i){var s=this.getRayInDir(t,e,0,-1,i),a=this.getRayInDir(t,e,0,1,i),n=this.getRayInDir(t,e,-1,0,i),o=this.getRayInDir(t,e,1,0,i);return[].concat(s,a,n,o)},e.BoardMatcher.prototype.getRayInDir=function(t,e,i,s,a){for(var n=[];!this.grid.get(t+i,e+s)||a&&"BLOCKED"==this.grid.get(t+i,e+s);){if(t+=i,e+=s,!a){if(this.board.blockedTop&&-1==e)break;if(this.board.blockedBottom&&e==this.boardSize[1])break;if(this.board.blockedLeft&&-1==t)break;if(this.board.blockedRight&&t==this.boardSize[0])break}if(n.push([t,e]),!this.grid.isInGrid(t,e))break}return n},e.BoardMatcher.prototype.getAllPossibleMoves=function(){var t={};this.grid.loop((function(e,i,s){e&&"BLOCKED"!==e&&!t[e.matchType]&&(t[e.matchType]=[],this.grid.loop((function(i,s,a){i&&i.matchType===e.matchType&&t[e.matchType].push([s,a])})))}),this);var e=[];for(val in t)for(var i=t[val],s=i.length,a=0;a<s;a++)for(var n=i[a],o=a+1;o<s;o++){var r=i[o];this.findMatch(n[0],n[1],r[0],r[1])&&e.push([n,r])}return e},e.BoardMatcher.prototype.isBlocker=function(t,e){return!(!this.board.blockedTop||-1!=e)||(!(!this.board.blockedBottom||e!=this.boardSize[1])||(!(!this.board.blockedLeft||-1!=t)||(!(!this.board.blockedRight||t!=this.boardSize[0])||"BLOCKED"===this.board.grid.get(t,e))))},e.BoardMatcher.prototype.highlightBlockers=function(t){var i=[];t.forEach((function(t,e,s){var a=s[e+1];if(a)if(t[0]==a[0]){var n=Math.min(t[1],a[1]),o=Math.max(t[1],a[1]);for(e=n;e<=o;e++)i.push([t[0],e])}else{n=Math.min(t[0],a[0]),o=Math.max(t[0],a[0]);for(e=n;e<=o;e++)i.push([e,t[1]])}else i.push(t)}));for(var s=[],a=0;a<i.length;a++){for(var n=i[a],o=!0,r=0;r<s.length;r++)e.Utils.arraysEqual(n,s[r])&&(o=!1);o&&s.push(n)}var h=s.filter((function(t){return this.isBlocker(t[0],t[1])}),this);e.sb("onHighlightBlockers").dispatch(h)},e.BoardMoveBackLayer=function(t){Phaser.Group.call(this,game),this.deadArray=[],e.sb("onMoveStart").add(this.onMove,this)},e.BoardMoveBackLayer.prototype=Object.create(Phaser.Group.prototype),e.BoardMoveBackLayer.prototype.getFreePart=function(){var t;return this.deadArray[0]?(t=this.deadArray.pop(),this.add(t)):t=e.makeImage(0,0,null,0,this),this.updateTransform(),t},e.BoardMoveBackLayer.prototype.onMove=function(t){var i=this.getFreePart();e.changeTexture(i,"gem_test_border"),i.position=t.gem.position,t.onFinish.add((function(){this.removeChild(i),this.deadArray.push(i)}),this)},e.BoardMoveObject=function(t,i,s,a){this.board=t,this.gem=i,this.FALL=a||!1,this.beginPos=[this.gem.x,this.gem.y],this.routeRaw=s,this.routeMap=this.processRoute(s),this.moveSpeed=0,this.moveSpeedDelta=1,this.progress=0,this.FALL||game.add.tween(this).to({progress:this.routeMap.len},800,Phaser.Easing.Cubic.InOut,!0),this.onTurn=new Phaser.Signal,this.onFinish=new Phaser.Signal,e.sb("onMoveStart").dispatch(this)},e.BoardMoveObject.prototype.update=function(){if(this.FALL&&(this.moveSpeed+=this.moveSpeedDelta,this.progress+=this.moveSpeed),this.progress>=this.routeMap.len){var t=this.routeMap.nodes[this.routeMap.nodes.length-1];this.gem.x=t.px[0],this.gem.y=t.px[1],e.sb("onMoveFinish").dispatch(this),this.onTurn.dispatch(),this.onFinish.dispatch()}else this.setPosByDistance(this.gem,this.progress,this.routeMap)},e.BoardMoveObject.prototype.processRoute=function(t){for(var e={nodes:[],len:0},i=0;i<t.length;i++){var s={cell:t[i],px:this.board.cellToPx(t[i][0],t[i][1])},a=t[i+1];a&&(t[i][0]==a[0]?(s.lenToNext=Math.abs(t[i][1]-a[1])*this.board.tileWidth,s.ver=!0):(s.lenToNext=Math.abs(t[i][0]-a[0])*this.board.tileHeight,s.ver=!1),e.len+=s.lenToNext),e.nodes.push(s)}return e},e.BoardMoveObject.prototype.setPosByDistance=function(t,e,i){for(var s=0,a=0;a<i.nodes.length-1;a++){var n=i.nodes[a],o=i.nodes[a+1];if(e<s+n.lenToNext){var r=(e-s)/n.lenToNext;if(n.ver){var h=o.px[1]-n.px[1];t.x=n.px[0],t.y=n.px[1]+h*r}else{h=o.px[0]-n.px[0];t.x=n.px[0]+h*r,t.y=n.px[1]}a>0&&this.onTurn.dispatch();break}s+=n.lenToNext}},e.FxPart=function(){e.Image.call(this,0,0,null,.5,null)},e.FxPart.prototype=Object.create(e.Image.prototype),e.FxPart.prototype.updateEmpty=function(){},e.FxPart.prototype.reset=function(t){e.stopTweens(this),t.worldPosition?(this.x=t.worldPosition.x,this.y=t.worldPosition.y):(this.x=t.x,this.y=t.y),this.alpha=1,this.scale.setTo(1),this.blendMode=0,this.angle=0,this.update=this.updateEmpty,this.revive()},e.FxPart.prototype.init=function(t,e){this.reset(e),this[t].apply(this,arguments)},e.FxPart.prototype.waterDrop=function(t,i){e.changeTexture(this,"water_circle"),this.blendMode=1,this.scale.setTo(0),game.add.tween(this).to({width:60,height:40,alpha:0},2e3,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add(this.kill,this)},e.FxPart.prototype.waterDropSmall=function(t,i){e.changeTexture(this,"water_circle_small"),this.blendMode=1,this.alpha=.6,this.scale.setTo(0),game.add.tween(this).to({width:30,height:15,alpha:0},2e3,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add(this.kill,this)},e.FxPart.prototype.dustBig=function(){this.alpha=.4,this.scale.setTo(1),e.changeTexture(this,"dust_part"),this.angle=game.rnd.between(0,360),game.add.tween(this).to({x:this.x+50,width:4*this.width,height:4*this.height,alpha:0},1e3,Phaser.Easing.Sinusoidal.Out,!0).onComplete.add(this.kill,this)},e.FxPart.prototype.firework=function(t,i){e.changeTexture(this,"firework_part_"+i.color),this.blendMode=1;var s=i.spd||4,a=i.angle||game.rnd.between(0,360);this.velX=e.lengthDirX(a,s,!1),this.velY=e.lengthDirY(a,s,!1),this.timer=i.timer||20,this.timer+=game.rnd.between(0,4),this.grav=.05,this.scaleDelta=game.rnd.realInRange(-.02,.005),this.update=this.fireworkUpdate},e.FxPart.prototype.fireworkUpdate=function(){this.x+=this.velX,this.y+=this.velY,this.scale.setTo(this.scale.x+this.scaleDelta),this.velX*=.95,this.velY*=.95,this.velY+=this.grav,this.timer--<0&&(this.alpha-=.02,this.alpha<=0&&this.kill())},e.Gem=function(t,i,s,a){var n=t.cellToPx(i,s);e.Image.call(this,n[0],n[1],"b_"+a,0,null),this.anchor.setTo(.5),this.cellX=i,this.cellY=s,this.board=t,this.matchType=a,this.inputLocked=!1},e.Gem.prototype=Object.create(e.Image.prototype),e.RTLayer=function(t,i,s){Phaser.Group.call(this,game),this.group=i;var a=(t.grid.width+2)*t.tileWidth,n=(t.grid.height+2)*t.tileHeight;this.rt=game.make.renderTexture(a,n),this.img=game.add.image(-40,-40,this.rt),this.topLayer=s||!1,this.marker=e.makeImage(0,0,this.topLayer?null:"gem_test_border",.5,null),this.add(this.img)},e.RTLayer.prototype=Object.create(Phaser.Group.prototype),e.RTLayer.prototype.redrawGroup=function(){this.rt.clear();for(var t=0,e=this.group.length;t<e;t++){var i=this.group.children[t];this.drawGem(i)}},e.RTLayer.prototype.drawGem=function(t){t.visible&&(e.changeTexture(this.marker,t.frameName),this.rt.renderRawXY(this.marker,t.x+40,t.y+40))},e.WaterDropDropper=function(){this.rects=[[463.0769230769231,3.076923076923077,923.0769230769231,70.76923076923077],[1352.3076923076924,83.07692307692308,35.38461538461547,707.6923076923077],[460,741.5384615384615,880,50.76923076923083],[296.92307692307696,261.53846153846155,138.46153846153845,146.1538461538462],[401.53846153846155,543.0769230769231,43.076923076923094,166.1538461538462],[401.53846153846155,141.53846153846155,40,63.076923076923066]],game.time.events.loop(500,this.drop,this),game.input.onDown.add(this.onClick,this),this.readyForClick=!0},e.WaterDropDropper.prototype.drop=function(){var t=game.rnd.pick(this.rects),i=t[0]+Math.random()*t[2],s=t[1]+Math.random()*t[3];e.sb("fxBg").dispatch("waterDrop",{x:i,y:s})},e.WaterDropDropper.prototype.onClick=function(t){this.readyForClick&&(t.worldX>454&&t.worldX<1351&&t.worldY>79&&t.worldY<725||(e.sb("fxBg").dispatch("waterDrop",{x:t.worldX,y:t.worldY}),this.readyForClick=!1,game.time.events.add(300,this.makeReady,this)))},e.WaterDropDropper.prototype.makeReady=function(){this.readyForClick=!0},e.Basin=function(t,i){Phaser.Group.call(this,game),this.waterfallSplash=e.makeImage(198,215,"water_splash",[.5,0],this),this.basin=e.makeImage(0,0,"bassin",0,this),this.waterlineSide=e.makeImage(446,0,"waterline_side",[1,0],this),this.waterlineFront=e.makeImage(197,214,"waterline_front",.5,this),this.waterDark=e.makeImage(198,173,"water_dark",[.5,1],this),this.waterLight=e.makeImage(198,173,"water_light",[.5,1],this),this.waterfall=e.makeImage(198,173,"basin_waterfall_hl",[.5,0],this);var s=[-114,-38,-21,-25,34,-43,80,-21,-67,-15];this.glares=this.add(game.make.group()),this.glares.position.setTo(198,173);for(var a=1,n=0;n<s.length;n+=2){var o=s[n],r=s[n+1],h=e.makeImage(o,r,"bassin_water_glare_"+a++,0,this.glares);game.add.tween(h).to({x:o+5},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0).timeline[0].dt=56*a}this.foliageR=e.makeImage(330,20,"foliage_r",[.42,.28],this),this.foliageL=e.makeImage(80,0,"foliage_l",[.64,.275],this),this.fillRate=1,this.cursors=game.input.keyboard.createCursorKeys(),this.startMovement()},e.Basin.prototype=Object.create(Phaser.Group.prototype),e.Basin.prototype.update=function(){this.cursors.down.isDown&&(this.fillRate-=.01),this.cursors.up.isDown&&(this.fillRate+=.01),this.fillRate=game.math.clamp(this.fillRate,0,1),this.waterDark.scale.setTo(.4+this.fillRate/1*.6),this.waterLight.scale.setTo(this.fillRate),this.glares.scale.setTo(this.fillRate),this.waterfall.alpha=Math.min(1,this.fillRate/.3),this.waterfallSplash.alpha=this.waterfall.alpha},e.Basin.prototype.startMovement=function(){game.add.tween(this.foliageR).to({angle:3},3e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),game.add.tween(this.foliageL).to({angle:3},3e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),game.add.tween(this.waterfall.scale).to({x:1.02,y:1.02},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),game.add.tween(this.waterlineSide).to({y:-2},1500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),game.add.tween(this.waterlineFront).to({y:211},1500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),game.add.tween(this.waterfallSplash.scale).to({x:1.02,y:1.02},300,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},e.BasinMobile=function(t,i){Phaser.Group.call(this,game),this.waterfallSplash=e.makeImage(271,100,"waterfall_waves",[.5,0],this),game.add.tween(this.waterfallSplash.scale).to({x:.9,y:.9},500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.basin=e.makeImage(0,0,"bassin",0,this),this.water=e.makeImage(272,64,"water",[.5,1],this),this.waterfall=e.makeImage(271,63,"waterfall",[.5,0],this),this.leaves=e.makeImage(270,0,"leaves",[.5,0],this),this.fillRate=1,this.cursors=game.input.keyboard.createCursorKeys()},e.BasinMobile.prototype=Object.create(Phaser.Group.prototype),e.BasinMobile.prototype.update=function(){this.cursors.down.isDown&&(this.fillRate-=.01),this.cursors.up.isDown&&(this.fillRate+=.01),this.fillRate=game.math.clamp(this.fillRate,0,1),this.water.scale.setTo(this.fillRate),this.waterfall.alpha=Math.min(1,this.fillRate/.3),this.waterfallSplash.alpha=this.waterfall.alpha},e.ButterflyFlyaway=function(t,i,s){Phaser.Group.call(this,game),this.state=game.state.getCurrentState(),this.position.setTo(t,i),this.flyAwaySpeed=e.json.settings.butterflyAnimation.flyAwaySpeed,this.flyAwayRotationLerp=e.json.settings.butterflyAnimation.flyAwayRotationLerp,this.wingTweenDuration=e.json.settings.butterflyAnimation.wingTweenDuration,this.shadowGroup=this.state.shadows2.add(game.make.group()),this.bodyShadow=e.makeImage(0,0,"butterfly_body_shadow",.5,this.shadowGroup),this.wingShadow=e.makeImage(0,0,"b_"+s+"_s",[1,.5],this.shadowGroup),this.wing2Shadow=e.makeImage(0,0,"b_"+s+"_s",[1,.5],this.shadowGroup),this.wing2Shadow.scale.x=-1,this.shadowGroup.alpha=0,this.butterflyGroup=this.add(game.make.group()),this.body=e.makeImage(0,-2,"butterfly_body",.5,this.butterflyGroup),this.body.scale.setTo(0),this.wing=e.makeImage(0,0,"b_"+s,[1,.5],this.butterflyGroup),this.wingTween=game.add.tween(this.wing.scale).to({x:.3,y:1.05},this.wingTweenDuration,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.wing2=e.makeImage(0,0,"b_"+s,[1,.5],this.butterflyGroup),this.wing2.scale.x=-1,this.wingShadow.position=this.wing.position,this.wing2Shadow.position=this.wing2.position,this.wingShadow.scale=this.wing.scale,this.wing2Shadow.scale=this.wing2.scale,this.zz=0,this.flyingAway=!1,this.onDestroy.add((function(){this.shadowGroup.destroy()}),this)},e.ButterflyFlyaway.prototype=Object.create(Phaser.Group.prototype),e.ButterflyFlyaway.prototype.update=function(){if(this.wing2.scale.x=-1*this.wing.scale.x,this.butterflyGroup.y=-this.zz,this.flyingAway){this.x+=e.lengthDirX(this.butterflyGroup.rotation-1.5708,this.flyAwaySpeed,!0),this.y+=e.lengthDirY(this.butterflyGroup.rotation-1.5708,this.flyAwaySpeed,!0);var t=game.math.angleBetweenPoints(this.worldPosition,this.targetPoint);this.butterflyGroup.rotation=game.math.rotateToAngle(this.butterflyGroup.rotation,t+1.5708,this.flyAwayRotationLerp),this.shadowGroup.rotation=this.butterflyGroup.rotation,game.math.distance(this.worldPosition.x,this.worldPosition.y,this.targetPoint.x,this.targetPoint.y)<10&&this.destroy()}this.shadowGroup.x=this.worldPosition.x,this.shadowGroup.y=this.worldPosition.y},e.ButterflyFlyaway.prototype.complete=function(){this.flyAway()},e.ButterflyFlyaway.prototype.flyAway=function(){game.time.events.add(300,(function(){this.flyingAway=!0}),this),game.add.tween(this.shadowGroup).to({alpha:.5},1e3,Phaser.Easing.Sinusoidal.Out,!0),game.add.tween(this).to({zz:120},4e3,Phaser.Easing.Sinusoidal.Out,!0),game.add.tween(this.wing).to({x:-2},300,Phaser.Easing.Sinusoidal.Out,!0),game.add.tween(this.wing2).to({x:2},300,Phaser.Easing.Sinusoidal.Out,!0),game.add.tween(this.body.scale).to({x:1,y:1},400,Phaser.Easing.Sinusoidal.Out,!0),Math.random()<.5?this.targetPoint=new Phaser.Point(Math.random()<.5?-400:game.width+400,Math.random()*game.height):this.targetPoint=new Phaser.Point(Math.random()*game.width,Math.random()<.5?-400:game.height+400)},e.ButterflySelection=function(t,i,s){Phaser.Group.call(this,game),this.position.setTo(t,i),this.wingTweenDuration=e.json.settings.butterflyAnimation.wingTweenDuration,this.body=e.makeImage(0,0,"butterfly_body",.5,this),this.wing=e.makeImage(-2,0,"b_"+s,[1,.5],this),this.wingTween=game.add.tween(this.wing.scale).to({x:.2},this.wingTweenDuration,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},e.ButterflySelection.prototype=Object.create(Phaser.Group.prototype),e.ButterflySelection.prototype.changeWing=function(t){e.changeTexture(this.wing,"b_"+t)},void 0===e&&(e={}),e.Button=function(t,i,s,a,n){Phaser.Button.call(this,game,e.l(t),e.l(i),null),this.state=game.state.getCurrentState(),e.changeTexture(this,s),this.anchor.setTo(.5),this.sfx=e.sfx.btn_pressed,this.active=!0,this.onClick=new Phaser.Signal,a&&this.onClick.add(a,n||this),this.onInputDown.add(this.click,this),this.terms=[],this.IMMEDIATE=!1,this.scaleOnClick=!0,this.targetAlphaTermsNotFulfilled=.5,this.targetAlpha=1,this.pulsing=!1},e.Button.prototype=Object.create(Phaser.Button.prototype),e.Button.constructor=e.Button,e.Button.prototype.setFrames=function(t,e){this.framesSet=!0,this.frameUp=t,this.frameDown=e},e.Button.prototype.pulse=function(t){this.pulsing=!0,this.pulsingTween=game.add.tween(this.scale).to({x:t||1.1,y:t||1.1},500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},e.Button.prototype.stopPulse=function(t){this.pulsingTween&&this.pulsingTween.stop(),this.scale.setTo(t||1),this.pulsing=!1},e.Button.prototype.click=function(){if(this.active&&this.checkTerms()){this.active=!1,this.onClick.dispatch(),this.sfx.play();this.scale.x,this.scale.y;this.IMMEDIATE?this.active=!0:(this.framesSet&&(e.changeTexture(this,this.frameDown),this.label&&(this.label.y+=6)),game.time.events.add(150,(function(){this.framesSet&&(e.changeTexture(this,this.frameUp),this.label&&(this.label.y-=6)),this.active=!0}),this))}},e.Button.prototype.checkTerms=function(){for(var t=0;t<this.terms.length;t++)if(!this.terms[t][0].call(this.terms[t][1]))return!1;return!0},e.Button.prototype.addTerm=function(t,e){this.terms.push([t,e])},e.Button.prototype.addImageLabel=function(t){this.label=game.make.image(0,0,"ssheet",t),this.label.anchor.setTo(.5),this.addChild(this.label)},e.Button.prototype.addTextLabel=function(t,i,s){var a=1/e.Loader.currentConfigMulti;this.label=new e.OneLineText(-7,-6,t,i,s||Math.floor(this.height*a*.7),.8*this.width,.5,.5),this.addChild(this.label)},e.Button.prototype.addTextLabelMultiline=function(t,i){var s=1/e.Loader.currentConfigMulti;this.label=new e.MultiLineText(0,0,t,i,Math.floor(this.height*s*.5),this.width*s*.8,this.height*s*.7,"center",.5,.5),this.addChild(this.label)},e.Button.prototype.stopTweens=function(){e.stopTweens(this)},e.Button.prototype.changeTexture=function(t){e.changeTexture(this,t)},e.Button.prototype.add=function(t){return this.addChild(t)},e.Button.prototype.updateChildren=function(){for(var t=this.children.length;t--;)this.children[t].update()},e.Dragonfly=function(){Phaser.Group.call(this,game),this.state=game.state.getCurrentState(),this.x=-999,this.y=-999,this.body=e.makeImage(0,0,"dragonfly_body",.5,this),this.wingL=e.makeImage(0,-28,"Dragonfly_leftwing",[1,.5],this),this.wingL.angle=3,this.wingR=e.makeImage(0,-28,"Dragonfly_rightwing",[0,.5],this),this.wingR.angle=-3,game.add.tween(this.wingL).to({angle:-3},3,Phaser.Easing.Linear.None,!0,0,-1,!0),game.add.tween(this.wingR).to({angle:3},3,Phaser.Easing.Linear.None,!0,0,-1,!0),this.shadow=e.makeImage(-1e3,-1e3,"dragonfly_shadow",.5,this.state.shadows),this.flyAwaySpeed=4,this.flyAwayRotationLerp=.01,this.flying=!1,this.visible=!1,this.shadow.visible=!1,this.flyAwaySpeed=8,game.time.events.add(game.rnd.between(1500,3e3),this.makeFlight,this)},e.Dragonfly.prototype=Object.create(Phaser.Group.prototype),e.Dragonfly.prototype.update=function(){this.flying?(this.x+=e.lengthDirX(this.rotation-1.5708,this.flyAwaySpeed,!0),this.y+=e.lengthDirY(this.rotation-1.5708,this.flyAwaySpeed,!0),game.math.distance(this.worldPosition.x,this.worldPosition.y,this.targetPoint.x,this.targetPoint.y)<10&&(this.flying=!1,this.visible=!1,this.shadow.visible=!1,game.time.events.add(game.rnd.between(15e3,3e4),this.makeFlight,this)),this.shadow.x=this.x,this.shadow.y=this.y+120,this.shadow.angle=this.angle,this.shadow.visible=!0):this.shadow.visible=!1},e.Dragonfly.prototype.makeFlight=function(){this.x=Math.random()*game.width,Math.random()<.5?(this.y=-400,this.targetPoint=new Phaser.Point(Math.random()*game.width,game.height+400)):(this.y=game.height+400,this.targetPoint=new Phaser.Point(Math.random()*game.width,-400)),this.rotation=game.math.angleBetweenPoints(this.position,this.targetPoint)+1.5708,this.updateTransform(),this.shadow.x=this.x,this.shadow.y=this.y+120,this.shadow.angle=this.angle,this.flying=!0,this.visible=!0},e.Firefly=function(){Phaser.Group.call(this,game),this.state=game.state.getCurrentState(),this.wingL=e.makeImage(0,-10,"firefly_wing2",[1,0],this),this.wingL.angle=20,this.wingR=e.makeImage(0,-10,"firefly_wing1",0,this),this.wingR.angle=-20,this.body=e.makeImage(0,0,"firefly_body",.5,this),game.add.tween(this.wingL).to({angle:-20},20,Phaser.Easing.Linear.None,!0,0,-1,!0),game.add.tween(this.wingR).to({angle:20},20,Phaser.Easing.Linear.None,!0,0,-1,!0),this.light=e.makeImage(0,15,"firefly_light",.5,this),this.light.blendMode=1,this.flying=!1,this.targetPoints=[],this.flyAwaySpeed=4,this.flyAwayRotationLerp=.01,this.visible=!1,game.time.events.add(game.rnd.between(2e3,5e3),this.makeFlight,this),this.shadow=e.makeImage(-1e4,-1e4,"firefly_shadow",.5,this.state.shadows),this.shadow.visible=!1},e.Firefly.prototype=Object.create(Phaser.Group.prototype),e.Firefly.prototype.update=function(){if(this.light.scale.setTo(game.rnd.realInRange(1.5,1.7)),this.light.alpha=game.rnd.realInRange(.2,.5),this.flying){this.targetPoint=this.targetPoints[0],this.x+=e.lengthDirX(this.rotation-1.5708,this.flyAwaySpeed,!0),this.y+=e.lengthDirY(this.rotation-1.5708,this.flyAwaySpeed,!0);var t=game.math.angleBetweenPoints(this.worldPosition,this.targetPoint);this.rotation=game.math.rotateToAngle(this.rotation,t+1.5708,this.flyAwayRotationLerp),(game.math.distance(this.worldPosition.x,this.worldPosition.y,this.targetPoint.x,this.targetPoint.y)<10||1==this.dir&&this.x>this.targetPoint.x||-1==this.dir&&this.x<this.targetPoint.x)&&(this.targetPoints.shift(),0==this.targetPoints.length&&(this.flying=!1,this.visible=!1,this.shadow.visible=!1,game.time.events.add(game.rnd.between(5e3,1e4),this.makeFlight,this))),this.shadow.x=this.x,this.shadow.y=this.y+70,this.shadow.angle=this.angle,this.shadow.visible=!0}else this.shadow.visible=!1},e.Firefly.prototype.makeFlight=function(){this.startPoint=new Phaser.Point(Math.random()<.5?-400:game.width+400,Math.random()*game.height),this.makeHorFlyPoints(this.startPoint),this.position.setTo(this.startPoint.x,this.startPoint.y),this.angle=game.math.angleBetweenPoints(this.position,this.targetPoints[0])+1.5708,this.flying=!0,this.visible=!0,this.shadow.visible=!0},e.Firefly.prototype.makeHorFlyPoints=function(t){var e=t.y;if(this.targetPoints=[],t.x<0)for(var i=-200;i<=game.width+400;i+=Math.floor(50*game.rnd.realInRange(.8,1.2))){var s=new Phaser.Point(i,e+game.rnd.realInRange(-50,50));this.targetPoints.push(s),e=s.y,this.dir=1}else for(i=game.width+200;i>=-400;i-=Math.floor(50*game.rnd.realInRange(.8,1.2))){s=new Phaser.Point(i,e+game.rnd.realInRange(-50,50));this.targetPoints.push(s),e=s.y,this.dir=-1}},e.Firefly.prototype.makeVerFlyPoints=function(t){},e.FireflyMM=function(){var t=game.rnd.pick(this.goToTargets),i=t[0]+Math.random()*t[2],s=t[1]+Math.random()*t[3];e.Image.call(this,i,s,"firefly_light",.5),this.scale.setTo(.15),this.blendMode=1,this.spherePos=new Phaser.Point(i,s),this.sphereOffset=new Phaser.Point(-10,-10),this.sphereOffset2=new Phaser.Point(-10,5),this.onMoveComplete=new Phaser.Signal,this.sphereTweens=[],game.add.tween(this.sphereOffset).to({x:10},1333+game.rnd.between(-200,1e3),Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0).timeline[0].dt=game.rnd.between(0,500),game.add.tween(this.sphereOffset).to({y:10},777+game.rnd.between(-200,1e3),Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0).timeline[0].dt=game.rnd.between(0,400),game.add.tween(this.sphereOffset2).to({x:10},1e3+game.rnd.between(-200,1e3),Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0).timeline[0].dt=game.rnd.between(0,500),game.add.tween(this.sphereOffset2).to({x:-5},1500+game.rnd.between(-200,1e3),Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0).timeline[0].dt=game.rnd.between(0,500),this.alphaTween=game.add.tween(this).to({alpha:.4},1e3+game.rnd.between(-200,200),Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.alphaTween.timeline[0].dt=game.rnd.between(0,300),this.onMoveComplete.add((function(){game.time.events.add(game.rnd.between(100,1e3),this.goToRandom,this)}),this),game.time.events.add(game.rnd.between(100,1e3),this.goToRandom,this)},e.FireflyMM.prototype=Object.create(e.Image.prototype),e.FireflyMM.prototype.goToTargets=[[15,266,753,283]],e.FireflyMM.prototype.update=function(){this.x=this.spherePos.x+this.sphereOffset.x+this.sphereOffset2.x,this.y=this.spherePos.y+this.sphereOffset.y+this.sphereOffset2.y},e.FireflyMM.prototype.goTo=function(t,e){var i=Phaser.Point.distance(this.spherePos,{x:t,y:e});game.add.tween(this.spherePos).to({x:t,y:e},50*i,Phaser.Easing.Sinusoidal.InOut,!0).onComplete.add(this.onMoveComplete.dispatch,this.onMoveComplete)},e.FireflyMM.prototype.goToRandom=function(){var t=game.rnd.pick(this.goToTargets),e=t[0]+Math.random()*t[2],i=t[1]+Math.random()*t[3];this.goTo(e,i)},e.FloatingBg=function(){Phaser.Group.call(this,game),game.device.desktop?(this.waterHighlight=e.makeImage(863,426,"game_field_water_highlights",.5,this),game.add.tween(this.waterHighlight).to({alpha:0},2e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),game.add.tween(this.waterHighlight.scale).to({x:1.02,y:1.02},2e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.gameField=e.makeImage(435,70,"game_field_t",0,this),this.gameFieldWater=e.makeImage(435,this.gameField.bottom-56,"game_field_t_water",this),game.add.tween(this.gameFieldWater).to({y:this.gameFieldWater.y+4},2e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.lily3=new e.FloatingElement(900,760,"blocker_lotus",["lotus_w0","lotus_w1"]),[[111,264],[320,282],[350,388],[329,603],[413,756]].forEach((function(t,i){this.add(new e.FloatingElement(t[0],t[1],"leaf_"+(i+1)))}),this),this.addMultiple([this.gameField,this.gameFieldWater])):this.gameField=e.makeImage(270,145,"board",[.5,0],this)},e.FloatingBg.prototype=Object.create(Phaser.Group.prototype),e.FloatingBg.prototype.addLeaves=function(t){t.for},e.FloatingElement=function(t,i,s,a){e.Image.call(this,t,i,s,.5,this),this.motionTween=game.add.tween(this).to({y:this.y-4,angle:-3},1500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.motionTween.timeline[0].dt=game.rnd.between(0,1400)},e.FloatingElement.prototype=Object.create(e.Image.prototype),e.GameOverWindow=function(t,i){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.gfx=this.add(game.add.graphics()),this.state=game.state.getCurrentState(),this.bg=e.makeImage(0,0,"gameover_bg",.5,this),this.points=t;var s=e.saveState.data.highscore<t;this.pauseTxt=new e.OneLineText(0,-200,"font",i?e.txt(13):e.txt(8),55,game.device.desktop?700:410,.5,0),this.pauseTxt.tint=13578512,this.pauseTxt.updateCache(),this.add(this.pauseTxt),this.textBg=e.makeImage(0,-30,"scores_bg",.5,this),s?(this.yourScore=new e.LabelValue(0,-70,e.txt(5),t.toString(),60,60),this.add(this.yourScore),this.yourScore.x-=60,this.yourScore.label.cacheAsBitmap=!1,this.yourScore.value.cacheAsBitmap=!1,this.bestLabel=e.makeImage(this.yourScore.right+75,-33,"new_highscore_bg",.5,this),this.bestLabelTxt=new e.OneLineText(0,-23,"font",e.txt(10),40,100,.5,.5),this.bestLabelTxt.tint=13345819,this.bestLabelTxt.updateCache(),this.bestLabel.addChild(this.bestLabelTxt),this.bestLabel.scale.setTo(0),game.add.tween(this.bestLabel.scale).to({x:1,y:1},300,Phaser.Easing.Elastic.Out,!0,350)):(this.yourScore=new e.LabelValue(0,-100,e.txt(5),t.toString(),60,70),this.add(this.yourScore),this.bestScore=new e.LabelValue(0,-25,e.txt(1),e.saveState.data.highscore.toString(),45,70),this.add(this.bestScore)),game.add.tween(this).from({alpha:0},300,Phaser.Easing.Sinusoidal.In,!0),this.newGameBtn=new e.Button(0,135,"button_resume",this.newGame,this),this.newGameBtn.setFrames("button_resume","button_resume_pressed"),this.newGameBtn.addTextLabel("font",e.txt(9),50),this.newGameBtn.label.x=4,this.newGameBtn.label.y=-35,this.add(this.newGameBtn),e.sb("openOverlay").dispatch(),e.sb("onPause").dispatch(),s&&(e.sfx.new_highscore.play(),e.saveState.data.highscore=t,this.fxLayer=new e.PoolGroup(e.FxPart,[],"fw"),this.add(this.fxLayer),this.shootFireworks()),e.saveState.resetProgress(),e.sb("onScreenResize").add(this.onResize,this),this.onResize()},e.GameOverWindow.prototype=Object.create(Phaser.Group.prototype),e.GameOverWindow.prototype.onResize=function(){this.cameraOffset.x=.5*game.width,this.cameraOffset.y=.5*game.height,this.gfx.clear(),this.gfx.beginFill(0,.6),this.gfx.drawRect(-.5*game.width,-.5*game.height,game.width,game.height)},e.GameOverWindow.prototype.close=function(){this.ignoreChildInput=!0,e.sb("closeOverlay").dispatch(),e.sb("onUnpause").dispatch(),game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.In,!0).onComplete.add((function(){this.destroy()}),this)},e.GameOverWindow.prototype.goToMainMenu=function(){this.ignoreChildInput=!0,game.camera.fade(0,300,!0),game.camera.onFadeComplete.add((function(){game.state.start("MainMenu")}))},e.GameOverWindow.prototype.newGame=function(){window.sdkHandler.trigger("interstitialAd",{callback:function(){this.ignoreChildInput=!0,game.camera.fade(0,300,!0),game.camera.onFadeComplete.add((function(){game.state.start("Game")}))}},this)},e.GameOverWindow.prototype.center=function(t,e){var i=-.5*(t.width+70+e.width);t.left=i,e.left=t.right+70},e.GameOverWindow.prototype.shootFireworks=function(){[[-228,-174,500],[295,-318,1e3],[360,88,1500],[-185,256,2e3],[0,-30,2500]].forEach((function(t,e){game.time.events.add(t[2],(function(){this.shootFirework(t[0],t[1],e+1)}),this)}),this)},e.GameOverWindow.prototype.shootFirework=function(t,i,s){e.sb("fw").dispatch("dustBig",{x:t,y:i}),e.sfx.firework2.play();for(var a=0;a<10;a++)e.sb("fw").dispatch("firework",{x:t,y:i,spd:12+game.rnd.realInRange(-4,4),angle:a/10*360+game.rnd.realInRange(-5,5),timer:game.rnd.between(1,8),color:s});for(a=0;a<5;a++)new e.LightButterfly(this.x+t,this.y+i,72*a,game.rnd.realInRange(3,6))},e.GameUI=function(){Phaser.Group.call(this,game),this.state=game.state.getCurrentState(),this.basin=this.add(new e.Basin),this.rocks=this.add(new e.Rocks);var t=325;this.levelTxt=new e.OneLineText(140,t,"font",e.txt(4),50,110,1,0),this.levelTxt.tint=16760123,this.levelTxt.updateCache(),this.add(this.levelTxt),this.levelTxt.y=t+(36-this.levelTxt.height+2),this.levelNr=new e.OneLineText(this.levelTxt.x+20,this.levelTxt.y,"font",this.state.lvlNr+1,50,90,0,0),this.add(this.levelNr),this.levelNr.y=t+(36-this.levelNr.height+2),this.timeController=new e.TimeController(195,30,this.basin),this.add(this.timeController),this.scoreTxt=new e.OneLineText(this.levelTxt.x,380,"font",e.txt(5),50,110,1,.5),this.scoreTxt.tint=16760123,this.scoreTxt.updateCache(),this.add(this.scoreTxt),this.scoreTxt.y=36-this.scoreTxt.height+2+380,this.pointController=new e.PointController(this.scoreTxt.x+20,380),this.add(this.pointController),this.hintBtn=new e.HintBtn(70,580),this.add(this.hintBtn),this.shuffleBtn=new e.ShuffleBtn(182,580),this.add(this.shuffleBtn),this.pauseBtn=new e.PauseBtn(126,720),this.add(this.pauseBtn),0===e.saveState.data.progress[0]&&(this.hintBtn.input.enabled=!1,this.shuffleBtn.input.enabled=!1,this.hintBtn.alpha=.5,this.shuffleBtn.alpha=.5,e.sb("tutorialComplete").addOnce(this.onTutorialComplete,this)),e.sb("onScreenResize").add(this.onResize,this),this.onResize()},e.GameUI.prototype=Object.create(Phaser.Group.prototype),e.GameUI.prototype.onResize=function(){},e.GameUI.prototype.onTutorialComplete=function(){this.hintBtn.input.enabled=!0,this.shuffleBtn.input.enabled=!0,this.hintBtn.alpha=1,this.shuffleBtn.alpha=1},e.GameUIMobile=function(){Phaser.Group.call(this,game),this.state=game.state.getCurrentState(),this.basin=this.add(new e.BasinMobile);this.levelTxt=new e.OneLineText(30,16,"font",e.txt(4),25,55,0,0),this.levelTxt.tint=16760123,this.levelTxt.updateCache(),this.add(this.levelTxt),this.levelTxt.y=18-this.levelTxt.height+2+16,this.levelNr=new e.OneLineText(155,16,"font",this.state.lvlNr+1,25,55,1,0),this.add(this.levelNr),this.levelNr.y=18-this.levelNr.height+2+16,this.timeController=new e.TimeController(270,17,this.basin),this.add(this.timeController),this.scoreTxt=new e.OneLineText(this.levelTxt.x,42,"font",e.txt(5),25,55,0,.5),this.scoreTxt.tint=16760123,this.scoreTxt.updateCache(),this.add(this.scoreTxt),this.scoreTxt.y=18-this.scoreTxt.height+2+42,this.pointController=new e.PointController(155,42),this.add(this.pointController),this.hintBtn=new e.HintBtn(385,40),this.add(this.hintBtn),this.shuffleBtn=new e.ShuffleBtn(445,40),this.add(this.shuffleBtn),this.pauseBtn=new e.PauseBtn(505,40),this.add(this.pauseBtn),0===e.saveState.data.progress[0]&&(this.hintBtn.input.enabled=!1,this.shuffleBtn.input.enabled=!1,this.hintBtn.alpha=.5,this.shuffleBtn.alpha=.5,e.sb("tutorialComplete").addOnce(this.onTutorialComplete,this)),e.sb("onScreenResize").add(this.onResize,this),this.onResize()},e.GameUIMobile.prototype=Object.create(Phaser.Group.prototype),e.GameUIMobile.prototype.onResize=function(){},e.GameUIMobile.prototype.onTutorialComplete=function(){this.hintBtn.input.enabled=!0,this.shuffleBtn.input.enabled=!0,this.hintBtn.alpha=1,this.shuffleBtn.alpha=1},e.HandTutorial=function(t){e.Image.call(this,0,0,"tut_hand",0),this.board=t,this.inputMgr=t.inputMgr,game.device.desktop?this.tutorialCells=[6,0,7,0,6,1,10,0]:this.tutorialCells=[1,1,0,1,2,1,0,8],this.inputMgr.tutorialCells=this.tutorialCells;var i=this.board.cellToPx(this.tutorialCells[0],this.tutorialCells[1]);this.x=this.board.x+i[0],this.y=this.board.y+i[1],this.anchor.setTo(-.25),game.add.tween(this.anchor).to({x:-.4,y:-.45},500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),e.sb("onTutorialStep").add(this.doStep,this)},e.HandTutorial.prototype=Object.create(e.Image.prototype),e.HandTutorial.prototype.doStep=function(){if(0==this.tutorialCells.length)game.add.tween(this).to({alpha:0},500,Phaser.Easing.Sinusoidal.In,!0).onComplete.add((function(){this.destroy()}),this),e.sb("tutorialComplete").dispatch();else{var t=this.board.cellToPx(this.tutorialCells[0],this.tutorialCells[1]);game.add.tween(this).to({x:this.board.x+t[0],y:this.board.y+t[1]},200,Phaser.Easing.Sinusoidal.InOut,!0)}},e.HintBtn=function(t,i){e.Button.call(this,t,i,"button_tips",this.onClick,this),this.setFrames("button_tips","button_tips_pressed"),this.targetAlphaTermsNotFulfilled=1,this.state=game.state.getCurrentState(),game.device.desktop?(this.counter=e.makeImage(40,34,"game_number_field",.5,this),this.counter.text=new e.OneLineText(0,-18,"font",this.state.hintsNr.toString(),30,35,.5,0),this.counter.addChild(this.counter.text)):(this.counter=e.makeImage(18,20,"game_number_field",.5,this),this.counter.text=new e.OneLineText(0,-12,"font",this.state.hintsNr.toString(),22,18,.5,0),this.counter.addChild(this.counter.text)),this.updateCounterTextY(),this.addTerm((function(){return 0==this.state.board.moves.length&&!this.state.pause&&!this.state.board.duringShuffle}),this),e.sb("onBoardEmpty").add((function(){this.inputEnabled=!1}),this),e.sb("onTimesUp").add((function(){this.inputEnabled=!1}),this),game.add.existing(this)},e.HintBtn.prototype=Object.create(e.Button.prototype),e.HintBtn.prototype.updateCounterTextY=function(){game.device.desktop?this.counter.text.y=22-this.counter.text.height-18:this.counter.text.y=15-this.counter.text.height-12},e.HintBtn.prototype.onClick=function(){var t=this;this.state.hintsNr<=0?e.sb("reward").dispatch((function(e){return t.updateCounter(e)})):(e.sfx.hint.play("",0,.4),this.updateCounter(-1),e.sb("onHint").dispatch())},e.HintBtn.prototype.updateCounter=function(t){this.state.hintsNr+=t,this.counter.text.setText(this.state.hintsNr.toString()),this.updateCounterTextY(),e.saveState.useHint(this.state.hintsNr)},e.LabelValue=function(t,i,s,a,n,o){Phaser.Group.call(this,game),this.position.setTo(t,i),this.label=new e.OneLineText(0,0,"font",s,n,350,0,0),this.label.tint=13345819,this.label.updateCache(),this.add(this.label),this.value=new e.OneLineText(0,0,"font",a,n,350,0,0),this.add(this.value),this.center(this.label,this.value,o),game.device.desktop?this.width=Math.min(this.width,600):this.width=Math.min(this.width,280)},e.LabelValue.prototype=Object.create(Phaser.Group.prototype),e.LabelValue.prototype.center=function(t,e,i){var s=-.5*(t.width+i+e.width);t.left=s,e.left=t.right+i},e.LevelPassedWindow=function(){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.gfx=this.add(game.add.graphics()),this.state=game.state.getCurrentState(),this.bg=e.makeImage(0,0,"gameover_bg",.5,this),this.pauseTxt=new e.OneLineText(0,-200,"font",e.txt(6),55,game.device.desktop?700:410,.5,0),this.pauseTxt.tint=4765259,this.pauseTxt.updateCache(),this.add(this.pauseTxt),this.hintIcon=e.makeImage(-140,-30,"button_tips",.5,this),this.hintTxt=new e.OneLineText(-80,-65,"font","+"+e.json.settings.extraHintsAtLevelFinished,60,100,0,.5),this.hintTxt.tint=4765259,this.hintTxt.updateCache(),this.add(this.hintTxt),e.saveState.data.progress[2]+=e.json.settings.extraHintsAtLevelFinished,this.shuffleIcon=e.makeImage(80,-30,"button_refresh",.5,this),this.shuffleTxt=new e.OneLineText(140,-65,"font","+"+e.json.settings.extraShuffleAtLevelFinished,60,100,0,.5),this.shuffleTxt.tint=4765259,this.shuffleTxt.updateCache(),this.add(this.shuffleTxt),e.saveState.data.progress[5]+=e.json.settings.extraShuffleAtLevelFinished,e.saveState.save(),game.device.desktop||(this.hintIcon.x-=20,this.hintTxt.x-=20,this.shuffleIcon.x-=20,this.shuffleTxt.x-=20),game.add.tween(this).from({alpha:0},300,Phaser.Easing.Sinusoidal.In,!0),this.newGameBtn=new e.Button(0,135,"button_resume",this.goToNext,this),this.newGameBtn.setFrames("button_resume","button_resume_pressed"),this.newGameBtn.addTextLabel("font",e.txt(7),50),this.newGameBtn.label.x=4,this.newGameBtn.label.y=-35,this.add(this.newGameBtn),e.sb("onScreenResize").add(this.onResize,this),this.onResize(),e.sb("openOverlay").dispatch(),e.sb("onPause").dispatch()},e.LevelPassedWindow.prototype=Object.create(Phaser.Group.prototype),e.LevelPassedWindow.prototype.onResize=function(){this.cameraOffset.x=.5*game.width,this.cameraOffset.y=.5*game.height,this.gfx.clear(),this.gfx.beginFill(0,.6),this.gfx.drawRect(-.5*game.width,-.5*game.height,game.width,game.height)},e.LevelPassedWindow.prototype.close=function(){this.ignoreChildInput=!0,e.sb("closeOverlay").dispatch(),e.sb("onUnpause").dispatch(),game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.In,!0).onComplete.add((function(){this.destroy()}),this)},e.LevelPassedWindow.prototype.goToNext=function(){window.sdkHandler.trigger("interstitialAd",{callback:function(){game.camera.fade(0,300,!0),game.camera.onFadeComplete.add((function(){game.state.start("Game")}),this)}},this)},e.LightButterfly=function(t,i,s,a){this.animIndex=game.rnd.between(1,11),this.animDir=Math.random()<.5?1:-1,this.blendMode=1,this.bfNr=[1,2,3,44,54,47][e.LightButterfly.instanceNr++%6],e.Image.call(this,t,i,"bf_"+this.bfNr+"_part_"+this.animIndex,.5);var n=game.rnd.realInRange(10,20);this.moveDir=s-n,this.moveTween=game.add.tween(this).to({moveDir:s+n},game.rnd.between(500,1200),Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.moveTween.timeline[0].dt=game.rnd.between(0,500),this.moveSpd=a,this.velX=e.lengthDirX(this.moveDir,this.moveSpd,!1),this.velY=e.lengthDirY(this.moveDir,this.moveSpd,!1),this.angle=s+90},e.LightButterfly.prototype=Object.create(e.Image.prototype),e.LightButterfly.prototype.update=function(){this.x+=e.lengthDirX(this.moveDir,this.moveSpd,!1),this.y+=e.lengthDirY(this.moveDir,this.moveSpd,!1),this.angle=this.moveDir+90,this.animIndex+=this.animDir,e.changeTexture(this,"bf_"+this.bfNr+"_part_"+this.animIndex),0!=this.animIndex&&12!=this.animIndex||(this.animDir*=-1),this.y<-100&&this.destroy()},e.LightButterfly.instanceNr=0,e.MainMenuButterfly=function(t,i){Phaser.Group.call(this,game),this.position.setTo(t,i),this.wingB=e.makeImage(75,190,"main_menu_butterfly_wing_back",[.98,.73],this),game.add.tween(this.wingB).to({angle:-3},1500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.butterfly=e.makeImage(0,0,"main_menu_butterfly_body",0,this),this.wingF=e.makeImage(85,190,"main_menu_butterfly_wing_front",[.98,.73],this),game.add.tween(this.wingF).to({angle:3},1500,Phaser.Easing.Sinusoidal.InOut,!0,150,-1,!0)},e.MainMenuButterfly.prototype=Object.create(Phaser.Group.prototype),e.MainMenuLogo=function(t,i){e.Image.call(this,t,i,"ja"==e.lang?"main_menu_logo-ja":"main_menu_logo",.5),this.scale.x=1.5,this.alpha=0,game.add.tween(this.scale).to({x:1},1500,Phaser.Easing.Sinusoidal.Out,!0,300),game.add.tween(this).to({alpha:1},1500,Phaser.Easing.Sinusoidal.Out,!0,300),game.add.tween(this).to({y:this.y+20},5e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},e.MainMenuLogo.prototype=Object.create(e.Image.prototype),e.PauseBtn=function(t,i){e.Button.call(this,t,i,"button_pause",this.onClick,this),this.setFrames("button_pause","button_pause_pressed"),this.state=game.state.getCurrentState(),e.sb("onBoardEmpty").add((function(){this.inputEnabled=!1}),this),e.sb("onTimesUp").add((function(){this.inputEnabled=!1}),this),game.add.existing(this)},e.PauseBtn.prototype=Object.create(e.Button.prototype),e.PauseBtn.prototype.onClick=function(){e.sb("pause").dispatch(),this.state.pause=!0},e.PauseNotificator=function(){Phaser.Group.call(this,game),this.pauseShadowTxt=new e.OneLineText(-5,-2,"font","Pause",90,500,.5,.5),this.pauseShadowTxt.tint=0,this.pauseShadowTxt.updateCache(),this.add(this.pauseShadowTxt),game.add.tween(this.pauseShadowTxt).to({x:5},8e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),game.add.tween(this.pauseShadowTxt).to({y:8},8e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.pauseTxt=new e.OneLineText(0,0,"font","Pause",90,500,.5,.5),this.add(this.pauseTxt),this.pauseTxt.angle=-5,game.add.tween(this.pauseTxt).to({angle:5},8e3,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0),this.alpha=0,e.sb("onScreenResize").add(this.onResize,this),e.sb("onPause").add(this.show,this),e.sb("onUnpause").add(this.hide,this)},e.PauseNotificator.prototype=Object.create(Phaser.Group.prototype),e.PauseNotificator.prototype.update=function(){this.pauseShadowTxt.angle=this.pauseTxt.angle},e.PauseNotificator.prototype.onResize=function(){this.x=.5*game.width,this.y=.4*game.height},e.PauseNotificator.prototype.show=function(){e.stopTweens(this),game.add.tween(this).to({alpha:1},300,Phaser.Easing.Sinusoidal.Out,!0)},e.PauseNotificator.prototype.hide=function(){e.stopTweens(this),game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.Out,!0)},e.PauseScreen=function(){Phaser.Group.call(this,game),this.state=game.state.getCurrentState(),this.bg=e.makeImage(0,0,"pause_background",0,this),this.bg.inputEnabled=!0,this.lantern=e.makeImage(700,230,"pause_lantern",.5,this),this.lanternLight=e.makeImage(0,47,"pause_lantern_light",.5,this.lantern),this.lanternLight.blendMode=1,this.lanternLight.targetAlpha=.7,this.lanternLight.update=function(){this.targetAlpha=game.rnd.realInRange(.5,1),this.alpha=e.lerp(this.alpha,this.targetAlpha,.4)},this.buttonGroup=this.add(game.make.group()),this.buttonGroup.position.setTo(700,530),this.mainMenuBtn=new e.Button(-250,-10,"button_home",this.onMainMenu,this),this.mainMenuBtn.setFrames("button_home","button_home_pressed"),this.resumeBtn=new e.Button(0,-10,"button_resume",this.onResume,this),this.resumeBtn.setFrames("button_resume","button_resume_pressed"),this.resumeBtn.addTextLabel("font",e.txt(11),50),this.resumeBtn.label.x=4,this.resumeBtn.label.y=-35,this.resetBtn=new e.Button(0,150,"button_submit_reset",this.onReset,this),this.resetBtn.setFrames("button_submit_reset","button_submit_reset_pressed"),this.resetBtn.addTextLabel("font",e.txt(26),50),this.resetBtn.label.x=4,this.resetBtn.label.y=-35,this.soundBtn=new e.Button(250,-10,game.sound.mute?"button_sound_off":"button_sound_on",this.onSound,this),game.sound.mute?this.soundBtn.setFrames("button_sound_off","button_sound_off_pressed"):this.soundBtn.setFrames("button_sound_on","button_sound_on_pressed"),this.buttonGroup.addMultiple([this.mainMenuBtn,this.resumeBtn,this.resetBtn,this.soundBtn]),this.visible=!1,game.device.desktop||(this.lantern.x=270,this.lantern.y=290,this.buttonGroup.x=270,this.buttonGroup.y=600,this.mainMenuBtn.x=-210,this.soundBtn.x=210),e.sb("pause").add(this.show,this),game.onPause.add(this.show,this)},e.PauseScreen.prototype=Object.create(Phaser.Group.prototype),e.PauseScreen.prototype.show=function(){!0!==e.paused&&!0!==this.visible&&(e.stopTweens(this),this.alpha=0,this.visible=!0,game.add.tween(this).to({alpha:1},400,Phaser.Easing.Sinusoidal.Out,!0),e.sb("onPause").dispatch())},e.PauseScreen.prototype.update=function(){this.lanternLight.update()},e.PauseScreen.prototype.onSound=function(){game.sound.mute=!game.sound.mute,game.sound.mute?this.soundBtn.setFrames("button_sound_off","button_sound_off_pressed"):this.soundBtn.setFrames("button_sound_on","button_sound_on_pressed")},e.PauseScreen.prototype.onReset=function(){window.sdkHandler.trigger("interstitialAd",{callback:function(){game.add.tween(this).to({alpha:0},400,Phaser.Easing.Sinusoidal.In,!0).onComplete.add((function(){this.visible=!1,this.state.pause=!1}),this),e.sb("onUnpause").dispatch(),e.sb("onTimesUp").dispatch()}},this)},e.PauseScreen.prototype.onResume=function(){window.sdkHandler.trigger("interstitialAd",{callback:function(){game.add.tween(this).to({alpha:0},400,Phaser.Easing.Sinusoidal.In,!0).onComplete.add((function(){this.visible=!1,this.state.pause=!1}),this),e.sb("onUnpause").dispatch()}},this)},e.PauseScreen.prototype.onMainMenu=function(){window.sdkHandler.trigger("interstitialAd",{callback:function(){this.ignoreChildInput=!0,game.add.tween(this.lantern).to({alpha:0},500,Phaser.Easing.Sinusoidal.In,!0),game.add.tween(this.buttonGroup).to({alpha:0},500,Phaser.Easing.Sinusoidal.In,!0),game.time.events.add(200,(function(){game.camera.fade(0,300,!0),game.camera.onFadeComplete.addOnce((function(){game.state.start("MainMenu")}),this)}),this)}},this)},e.PauseScreen.prototype.destroy=function(){game.onPause.remove(this.show,this),Phaser.Group.prototype.destroy.call(this)},e.RewardWindow=function(){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.gfx=this.add(game.add.graphics()),this.gfx.inputEnabled=!0,this.state=game.state.getCurrentState(),this.bg=e.makeImage(0,0,"gameover_bg",.5,this),this.txt1=new e.OneLineText(0,-155,"font",e.txt(33),55,game.device.desktop?700:410,.5,0),this.txt1.tint=13578512,this.txt1.updateCache(),this.add(this.txt1),this.txt2=new e.OneLineText(0,0,"font",e.txt(34),55,game.device.desktop?700:410,.5,0),this.txt2.tint=13578512,this.txt2.updateCache(),this.add(this.txt2),this.btnCancel=new e.Button(0,130,"button_resume",this.closeAd,this),this.btnCancel.tint=16729156,this.btnCancel.setFrames("button_resume","button_resume_pressed"),this.btnCancel.addTextLabel("font",e.txt(32),50),this.btnCancel.label.x=4,this.btnCancel.label.y=-35,this.add(this.btnCancel),this.btnConfitm=new e.Button(0,130,"button_resume",this.closeRewardAd,this),this.btnConfitm.setFrames("button_resume","button_resume_pressed"),this.btnConfitm.addTextLabel("font",e.txt(31),50),this.btnConfitm.label.x=4,this.btnConfitm.label.y=-35,this.add(this.btnConfitm),game.device.desktop?(this.bg.scale.x=1.3,this.btnCancel.x=-200,this.btnConfitm.x=200):(this.bg.scale.y=1.3,this.btnConfitm.y=40,this.btnCancel.y=200,this.txt1.y=-250),this.txt2.y=this.txt1.y+70,e.sb("onScreenResize").add(this.onResize,this),this.onResize(),this.visible=!1,this.timeToReset=6e5,this.timer=0,e.sb("reward").add(this.show,this)},e.RewardWindow.prototype=Object.create(Phaser.Group.prototype),e.RewardWindow.prototype.timerDecorator=function(t){var e=Math.floor(t/1e3%60),i=e.toString();e<10&&(i="0"+i);var s=Math.floor(t/1e3/60%60),a=s.toString();s<10&&(a="0"+a);var n=Math.floor(t/1e3/60/60|0),o=n.toString();return n<10&&(o="0"+o),"".concat(o,":").concat(a,":").concat(i)},e.RewardWindow.prototype.updateTimer=function(){var t=this.timer-Date.now();return t>0?(this.btnConfitm.input.enabled=!1,this.btnConfitm.tint=10066329,this.btnConfitm.label.text=this.timerDecorator(t),this.btnConfitm.label.updateCache(),!0):(this.activateBtnConfirm(),!1)},e.RewardWindow.prototype.show=function(t){var i=this;this.btnConfitm.scale.setTo(1,1),e.stopTweens(this),this.visible=!0,e.sb("onPause").dispatch(),this.rewardCallBack=t,!0===this.updateTimer()&&(this.timerInterval=setInterval((function(){i.updateTimer()}),1e3))},e.RewardWindow.prototype.activateBtnConfirm=function(){clearInterval(this.timerInterval),this.btnConfitm.input.enabled=!0,this.btnConfitm.tint=16777215,this.btnConfitm.label.text=e.txt(31),this.btnConfitm.label.updateCache(),this.game.add.tween(this.btnConfitm.scale).to({x:1.1,y:1.1},500,Phaser.Easing.Linear.None,!0,0,-1,!0)},e.RewardWindow.prototype.onResize=function(){this.cameraOffset.x=.5*game.width,this.cameraOffset.y=.5*game.height,this.gfx.clear(),this.gfx.beginFill(0,.6),this.gfx.drawRect(-.5*game.width,-.5*game.height,game.width,game.height)},e.RewardWindow.prototype.closeRewardAd=function(){window.sdkHandler.trigger("interstitialAd",{callback:function(){this.timer=Date.now()+this.timeToReset,this.rewardCallBack(1),this.close()}},this)},e.RewardWindow.prototype.closeAd=function(){this.close()},e.RewardWindow.prototype.close=function(){clearInterval(this.timerInterval),this.game.tweens.removeFrom(this.btnConfitm.scale),this.visible=!1,e.sb("onUnpause").dispatch()},e.PointController=function(t,i){Phaser.Group.call(this,game),this.position.setTo(t,i),this.points=e.saveState.getPoints(),game.device.desktop?this.counter=new e.OneLineCounter(0,0,"font",e.saveState.getPoints(),50,110,0,0):this.counter=new e.OneLineCounter(0,0,"font",e.saveState.getPoints(),25,55,1,0),this.counter.changeIntervals(1),this.add(this.counter),this.forMatch=e.json.settings.pointsForMatch,this.forHint=e.json.settings.hintPenalty,this.desktop=game.device.desktop,e.sb("onMatch").add(this.onMatch,this),e.sb("onHint").add(this.onHint,this),e.sb("onTimeBonus").add(this.onTimeBonus,this)},e.PointController.prototype=Object.create(Phaser.Group.prototype),e.PointController.prototype.update=function(){this.counter.update(),this.desktop?this.counter.y=36-this.counter.height+2:this.counter.y=18-this.counter.height+2},e.PointController.prototype.onMatch=function(){this.points+=this.forMatch,this.counter.changeAmount(this.points),e.saveState.changePoints(this.points),e.sfx.score_counter.play("",0,.1)},e.PointController.prototype.onHint=function(){this.points-=this.forHint,this.counter.changeAmount(this.points),e.saveState.changePoints(this.points)},e.PointController.prototype.onTimeBonus=function(){this.points+=e.json.settings.bonusPerSecond,this.counter.changeAmount(this.points),e.saveState.changePoints(this.points),e.sfx.pop.play()},e.Rocks=function(){Phaser.Group.call(this,game),this.position.setTo(0,800),this.rocks=e.makeImage(0,0,"game_rocks2",[0,1],this),this.waterOutline=e.makeImage(194,-212,"game_rocks_outline",0,this),this.waterOutline.orgY=-212,this.waterOutline2=e.makeImage(285,-293,"game_rocks_outline_2",0,this),this.waterOutline2.orgY=-293,this.waterOutline3=e.makeImage(258,-390,"game_rocks_outline_3",0,this),this.waterOutline3.orgY=-390,this.waterOffset=0,game.add.tween(this).to({waterOffset:-5},1500,Phaser.Easing.Sinusoidal.InOut,!0,0,-1,!0)},e.Rocks.prototype=Object.create(Phaser.Group.prototype),e.Rocks.prototype.update=function(){this.waterOutline.y=this.waterOutline.orgY+this.waterOffset,this.waterOutline2.y=this.waterOutline2.orgY+this.waterOffset,this.waterOutline3.y=this.waterOutline3.orgY+this.waterOffset},e.saveState={makeNewDataObject:function(){return{mute:!1,progress:[0,0,e.json.settings.hintsNr,null,null,e.json.settings.shuffleNr],highscore:0,desktop:game.device.desktop}},save:function(){this.data.mute=game.sound.mute;try{localStorage.setItem("7butterfly-kyodai-hd",JSON.stringify(this.data))}catch(t){}},init:function(){var t=null;try{t=localStorage.getItem("7butterfly-kyodai-hd")}catch(t){}t?(this.data=JSON.parse(t),this.data.desktop!==game.device.desktop&&(this.resetProgress(),this.data.desktop=game.device.desktop),game.sound.mute=this.data.mute):(this.data=this.makeNewDataObject(),this.resetProgress()),this.points=this.data.progress[1]},resetProgress:function(){this.changePoints(0),this.data.progress=[0,0,e.json.settings.hintsNr,null,null,e.json.settings.shuffleNr],this.save()},levelEnd:function(t){t&&(this.data.progress[0]++,this.data.progress[1]=this.points,this.data.progress[3]=null,this.data.progress[4]=null)},skipLevelWithBanner:function(t){this.data.progress[0]=t,this.data.progress[1]=this.points,this.data.progress[3]=null,this.data.progress[4]=null,this.save()},useHint:function(t){this.data.progress[2]=t,this.save()},useShuffle:function(t){this.data.progress[5]=t,this.save()},changePoints:function(t){this.points=t},savePoints:function(){this.data.progress[1]=this.points,this.save()},getPoints:function(){return this.points}},e.ShuffleBtn=function(t,i){e.Button.call(this,t,i,"button_refresh",this.onClick,this),this.setFrames("button_refresh","button_refresh_pressed"),this.targetAlphaTermsNotFulfilled=1,this.state=game.state.getCurrentState(),game.device.desktop?(this.counter=e.makeImage(40,34,"game_number_field",.5,this),this.counter.text=new e.OneLineText(0,-18,"font",this.state.shuffleNr.toString(),30,35,.5,0),this.counter.addChild(this.counter.text)):(this.counter=e.makeImage(18,20,"game_number_field",.5,this),this.counter.text=new e.OneLineText(0,-12,"font",this.state.shuffleNr.toString(),22,18,.5,0),this.counter.addChild(this.counter.text)),this.updateCounterTextY(),this.addTerm((function(){return 0==this.state.board.moves.length&&!this.state.pause&&!this.state.board.duringShuffle}),this),e.sb("onBoardEmpty").add((function(){this.inputEnabled=!1}),this),e.sb("onTimesUp").add((function(){this.inputEnabled=!1}),this),game.add.existing(this)},e.ShuffleBtn.prototype=Object.create(e.Button.prototype),e.ShuffleBtn.prototype.updateCounterTextY=function(){game.device.desktop?this.counter.text.y=22-this.counter.text.height-18:this.counter.text.y=15-this.counter.text.height-12},e.ShuffleBtn.prototype.onClick=function(){var t=this;this.state.shuffleNr<=0?e.sb("reward").dispatch((function(e){return t.updateCounter(e)})):(e.sfx.shuffle.play(),this.state.board.shuffleBoard(),this.updateCounter(-1),e.sb("onShuffle").dispatch())},e.ShuffleBtn.prototype.updateCounter=function(t){this.state.shuffleNr+=t,this.counter.text.setText(this.state.shuffleNr.toString()),this.updateCounterTextY(),e.saveState.useShuffle(this.state.shuffleNr)},e.TimeController=function(t,i,s){Phaser.BitmapText.call(this,game,t,i,"font","",38),this.anchor.setTo(.5),this.state=game.state.getCurrentState(),this.basin=s,this.timeMax=e.json.settings.timeSec,this.timeCurrent=this.timeMax,this.timeCurrentLerp=this.timeCurrent,this.lastFullSec=Math.ceil(this.timeCurrent),this.setText(this.lastFullSec),this.secForMatch=e.json.settings.secForMatch,this.paused=!1,e.sb("onPause").add((function(){this.paused=!0}),this),e.sb("onUnpause").add((function(){this.paused=!1}),this),e.sb("onBoardEmpty").add((function(){this.update=this.onWinEmptyUpdate}),this),e.sb("onMatch").add(this.onMatch,this)},e.TimeController.prototype=Object.create(Phaser.BitmapText.prototype),e.TimeController.prototype.update=function(){this.paused||(this.timeCurrent-=.0166,this.timeCurrentLerp=e.lerp(this.timeCurrentLerp,this.timeCurrent,.05),this.basin.fillRate=this.timeCurrentLerp/this.timeMax,this.lastFullSec!==Math.ceil(this.timeCurrent)&&(this.lastFullSec<=10&&e.sfx.timer.play(),this.lastFullSec=Math.ceil(this.timeCurrent),this.setText(this.lastFullSec.toString())),this.timeCurrent<=0&&0==this.state.board.moves.length&&(this.update=function(){},e.sb("onTimesUp").dispatch()))},e.TimeController.prototype.onMatch=function(){this.timeCurrent=game.math.clamp(this.timeCurrent+this.secForMatch,0,this.timeMax)},e.TimeController.prototype.onWinEmptyUpdate=function(){if(this.timeCurrent-=.5,this.timeCurrentLerp=e.lerp(this.timeCurrentLerp,this.timeCurrent,.25),this.basin.fillRate=this.timeCurrentLerp/this.timeMax,this.lastFullSec!==Math.ceil(this.timeCurrent)){this.lastFullSec=Math.ceil(this.timeCurrent),this.setText(this.lastFullSec.toString());var t=this.state.uiTargetParticles.init(game.device.desktop?198:270,game.device.desktop?173:30,game.cache.getRenderTexture("+sec").texture,this.state.ui.pointController);t.onStart.add(this.bonusOnStart,t),t.onFinish.add(this.bonusOnFinish),t.start()}this.timeCurrent<=0&&(e.sb("onBonusTimeZero").dispatch(),this.update=function(){})},e.TimeController.prototype.bonusOnStart=function(){this.vel.x=game.rnd.realInRange(-10,10),this.vel.y=game.rnd.realInRange(-10,10)},e.TimeController.prototype.bonusOnFinish=function(){e.sb("onTimeBonus").dispatch()},e.TutorialWindow=function(){Phaser.Group.call(this,game),this.fixedToCamera=!0,this.gfx=this.add(game.add.graphics()),this.state=game.state.getCurrentState(),TW=this,this.bg=e.makeImage(0,0,"gameover_bg",.5,this),this.popupBg=e.makeImage(0,-70,"tut_bg",.5,this),this.tut1=e.makeImage(0,-70,"tut1",.5,this),this.tut2=e.makeImage(0,-70,"tut2",.5,this),this.tut3=e.makeImage(0,-70,"tut3",.5,this),this.tut2.alpha=0,this.tut3.alpha=0,this.currentTut=1,this.newGameBtn=new e.Button(0,135,"button_resume",this.close,this),this.newGameBtn.setFrames("button_resume","button_resume_pressed"),this.newGameBtn.addTextLabel("font",e.txt(23),50),this.newGameBtn.label.x=4,this.newGameBtn.label.y=-35,this.timerEvt=game.time.events.loop(2e3,this.changeTut,this),this.add(this.newGameBtn),e.sb("onScreenResize").add(this.onResize,this),this.onResize(),e.sb("openOverlay").dispatch(),e.sb("onPause").dispatch(!0)},e.TutorialWindow.prototype=Object.create(Phaser.Group.prototype),e.TutorialWindow.prototype.onResize=function(){this.cameraOffset.x=.5*game.width,this.cameraOffset.y=.5*game.height,this.gfx.clear(),this.gfx.beginFill(0,.6),this.gfx.drawRect(-.5*game.width,-.5*game.height,game.width,game.height)},e.TutorialWindow.prototype.close=function(){game.time.events.remove(this.timerEvt),this.ignoreChildInput=!0,e.sb("closeOverlay").dispatch(),game.add.tween(this).to({alpha:0},300,Phaser.Easing.Sinusoidal.In,!0).onComplete.add((function(){this.destroy(),e.sb("onUnpause").dispatch()}),this)},e.TutorialWindow.prototype.changeTut=function(){1==this.currentTut?(this.currentTut=2,this.bringToTop(this.tut2),this.tut2.alpha=0,game.add.tween(this.tut2).to({alpha:1},600,Phaser.Easing.Sinusoidal.InOut,!0)):2==this.currentTut?(this.currentTut=3,this.bringToTop(this.tut3),this.tut3.alpha=0,game.add.tween(this.tut3).to({alpha:1},600,Phaser.Easing.Sinusoidal.InOut,!0)):(this.currentTut=1,this.bringToTop(this.tut1),this.tut1.alpha=0,game.add.tween(this.tut1).to({alpha:1},600,Phaser.Easing.Sinusoidal.InOut,!0))},e.WaterDropDropperMM=function(){this.rects=[[16,623,249,148],[265,715,177,64],[443,710,88,34],[531,707,30,13],[593,653,73,30],[543,613,100,39],[452,593,33,15],[200,594,107,29,1188,-210]],game.time.events.loop(500,this.drop,this)},e.WaterDropDropperMM.prototype.drop=function(){var t=game.rnd.pick(this.rects),i=t[0]+Math.random()*t[2],s=t[1]+Math.random()*t[3];e.sb("fx").dispatch("waterDropSmall",{x:i,y:s})},window.initGame=function(){var t=new Phaser.Game(1400,800,Phaser.CANVAS,"content",null,!0);window.game=t,t.state.add("Boot",e.Boot),t.state.add("Preloader",e.Preloader),t.state.add("MainMenu",e.MainMenu),t.state.add("Game",e.Game),t.state.add("GameProto",e.GameProto),t.state.add("Test",e.Test),sgSdk.initialize(["basic","scoreGame"],{id:"butterfly-kyodai-hd",build:"1.0.0",supportedLanguages:["en","de","es","fr","it","pt","ru","tr","nl","pl","ar","ja"]},(function(i,s,a){i||(window.sgSettings=s,window.sdkHandler=a,e.lang=window.sgSettings.config.env.locale,t.state.start("Boot"))}))}}()})();